<!doctype html>
<html>    
<head>
	<script data-src="del-operaLib.js">
	function _(obj) {
	var array = []
 for (var key in obj) {
   array.push(key + ' = ' + obj[key]);
 }
 return array;
}
function debug(text) {
  opera.postError('popup.html: ' + text);
}
function receiver(e) {
	var response = e.data;
	debug('response.action = ' + response.action);
//	debug('response = \n' + _(response).join('\n'));
	switch (e.data.action) {
		case 'page-details':
			// put these values into the form
			Dom.get('url').value = response.url;
			Dom.get('title').value = response.title;

			break;
		case 'login-required':
		case 'last-bookmark-status':
		case 'pre-flight-check':
			debug('typeof response.status = ' + typeof(response.status) + ' / ' + response.status);
			if (response.status === true) {
				// removing loading stuff
				Dom.removeClass('chrome', 'loadingPage');
				var loadingMsg = Dom.get('loadingMsg')
				if (loadingMsg)
						loadingMsg.parentNode.removeChild(loadingMsg);
				// initialize all JS on the page
				Delicious.Opera.init();
				//New
				Dom.get('titleAction').innerHTML = "Delicious";
				displayAddError();
				sendRequest('reset-add-failed');//				DelXT.resetAddBookmarkFailed();
				return;
			}
			else if (response.status === null) {
				
			}
			break;
		case 'delicious-data':
			break;
		case 'init':
			Delicious.Opera.init();
			break;
		case 'xhr-Success':
		case 'xhr-Failure':
			debug('Delicious.OperaUI.getChrome' + response.action.substr(4));
			Delicious.OperaUI['getChrome' + response.action.substr(4)](response);
			break;
		case 'stop-loading':
			// removing loading stuff
			Dom.removeClass('chrome', 'loadingPage');
			var loadingMsg = Dom.get('loadingMsg')
			if (loadingMsg)
				loadingMsg.parentNode.removeChild(loadingMsg);

			break;
		case 'print-msg':
			    // print error message
			    Delicious.OperaUI.printMsg(response.type, response.message, response.isNew || 0); 
			break;
		case 'display-login':
			Delicious.OperaUI.displayLogin();
			break;
		case 'focus-tags':
			Dom.get(response.action.substr(6)).focus();
			break;
		case 'getChromeSuccess':
			Delicious.OperaUI.getChromeSuccess();
			break;
		case 'chrome-callback-save-success':
			Delicious.Opera.callbackSaveSuccess(response.data);
			break;
		case 'display-login':
			Delicious.OperaUI.displayLogin();
			break;
		case 'update-fields':
            var loginName = EM({}, [
                'signed in as ',
                STRONG({}, [response.login])
              ]), regex = /^(?:action|login)$/;
            Dom.get('signedInAs').appendChild(loginName);
		for (var key in response) {
			if (regex.test(key)) {
				continue;
			}
			if (key == 'share') {
				Dom.get(key).checked = response[key];
			}
			else {
				Dom.get(key).value = response[key];
			}
		}
/*
            var addError = false;//turn it to true for testing
            if(addError) {
                Dom.get('titleAction').innerHTML = "Delicious";
                this.displayAddError();
                
                return;
            }
            // print signin name
            var loginName = EM({}, [
                'signed in as ',
                STRONG({}, [results.login])
              ])
            Dom.get('signedInAs').appendChild(loginName);
                        
            // take contents of return, and place on page
            Dom.get('key').value = results.crumb;
            Dom.get('url').value = results.url;
            Dom.get('title').value = results.title;
            if(results.type == "edit") {
                Dom.get('titleAction').innerHTML = "Edit a Bookmark";
                Dom.get('notes').value = results.note;
                Dom.get('tags').value = results.tags;
                if (results.isPrivate)
                    Dom.get('share').checked = true;
            }
            Dom.get('tags').focus();
						
						//if notes are supplied by selecting text on page. put them to notes field. Override exisitng notes
						if(o.argument[3]) {
								Dom.get('notes').value = o.argument[3];
						}
*/

			break;
		case 'save-Success':
		case 'save-Failure':
			debug('Delicious.OperaUI.callbackSave' + response.action.substr(6));
			Delicious.OperaUI['callbackSave' + response.action.substr(6)](response);
			break;

	};
}
document.addEventListener('domcontentloaded',function() {
	opera.extension.addEventListener('message', receiver, false);
	Delicious.OperaUI.init();
}, false);
function sendRequest(object) {
	opera.extension.postMessage(object);  
}
function displayAddError() {
	Dom.get('saveFields').innerHTML = '';
	var div = DIV({'class':'Note'}, ['Oops. Your last bookmark was not saved to delicious.com.']);
	Dom.get('msgs').appendChild(div);
}
</script>
	<!--
	
	<link rel="stylesheet" type="text/css" href="del-opera.css"/> 
	-->
	<style type="text/css" data-href="del-opera.css">
	/*
Copyright (c) 2007, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.3.1
*/
body{color:#000;background:#FFF;}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td{margin:0;padding:0;}table{border-collapse:collapse;border-spacing:0;}fieldset,img{border:0;}address,caption,cite,code,dfn,em,strong,th,var{font-style:normal;font-weight:normal;}li{list-style:none;}caption,th{text-align:left;}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal;}q:before,q:after{content:'';}abbr,acronym{border:0;font-variant:normal;}sup,sub{line-height:-1px;vertical-align:text-top;}sub{vertical-align:text-bottom;}input, textarea, select{font-family:inherit;font-size:inherit;font-weight:inherit;}/*
Copyright (c) 2007, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.3.1
*/
body {font:13px/1.22 arial,helvetica,clean,sans-serif;}table {font-size:inherit;font-size:100%;}pre,code,kbd,samp,tt{font-family:monospace;line-height:99%;}
/* @group globalElements */
#sfWebDebug {display:none}

#chrome {width:361px; height:auto; overflow:hidden; margin:0 auto; text-align:left}
#doc {margin:0; width:100%; min-width:0}

.clr {clear:both; height:0; font-size:1px;}
a {text-decoration:none; color:#1462C1}
a:hover {text-decoration:underline}

strong {font-weight:bold}
em {font-style:italic}
/* @end */


/* @group loading & messages */
.loadingError {margin:1em; font-weight:bold}
.loadingError {color:#9E1919}

#msgs div {display:block; margin:.6em 0 .8em 0; padding-left:20px; color:#333; font-size:92%; font-weight:normal}
#msgs div.login,
#msgs div.note {background: url(skin/icon_note.gif) no-repeat 0 0}
#msgs div.error {color:#9E1919; background: url(skin/icon_error.gif) no-repeat 0 0}
#msgs strong { font-weight:bold; padding-right:5px}
#msgs div a {font-weight:bold}

#loadingMsg {position:absolute; top:40%; left:25%; width:50%; padding:10px 0; background:#fff; font-weight:bold; font-size:120%; color:#7A7A7A; z-index:1000}
#loadingMsg span {padding-left:24px; background:url(skin/busyarr_1.gif) no-repeat 0 2px }
.loadingPage {opacity:.5}
/* @end */


/* @group buttons */
.btn {display:block; float:left; margin-right:5px}
.btn-cancel {margin:0;}
.btn input,
.btn a {display:block; padding:2px 15px; color:#fff; font-weight:bold; font-size:100%; background:#aaa; border:1px solid #c1c1c1; border-radius:12px}
.btn input:hover,
.btn a:hover {color:#000; text-decoration:none; cursor:pointer}

.btn-save input, .btn-save a {background-color:#7cba0f; border-color:#7cba0f}

.is_firefox .btn input {padding:1px 15px}

.bttns .loading {width:70px; height:24px;
    background: url(skin/waitingDelicious01.gif) no-repeat center center}
.bttns .loading input {display:none;}
/* @end */


/* @group header */
#hd {position:relative; background:#fff; border-top:1px solid #fff; padding:8px}
#hd h1 {padding:2px 0 0 21px; font-weight:bold; color:#000; background:url('data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///zJ00NPS0iH5BAAAAAAALAAAAAAQABAAAAIqjG+iq4jM3IFLJipswNly/XkYQJbkgKaoaaoqW7opfMoDDdg3reM9bysAADs=') no-repeat 0 0}
#hd span {position:absolute; top:12px; right:7px; color:#666; font-size:84%}
#hd span em {font-weight:normal; color:#333; font-style:normal}
/* @end */


/* @group saveForm */
.saveForm {padding:4px 13px 11px 8px; margin-bottom:10px; border-top:1px solid #F3F3F3}
.saveForm li.field {clear:both; position:relative; margin:0 0 10px}
.saveForm label {display:block; font-weight:bold; color:#666; padding-left:2px; font-size:92%}
.saveForm input.text,
.saveForm input.newTagInput,
.saveForm textarea {width:100%; display:block; border:1px solid #ccc; border-color:#ccc #aaa #aaa #ccc; padding:1px 2px; color:#000}
.saveForm textarea {height:2.4em}
.saveForm .footer {height:2em; padding-top:7px}
.saveForm .remember {padding:4px 0 0 4px; float:left}
.saveForm .remember input {float:left; margin-top:1px}
.saveForm .remember label {font-weight:normal; padding-left:18px; color:#333}
.saveForm .bttns {position:absolute; right:-6px}


.loadingPage .saveForm input.text,
.loadingPage .saveForm input.newTagInput,
.loadingPage .saveForm textarea {background:#F3F3F3}


.saveForm .info {position:absolute; top:2px; right:0; color:#aaa; font-size:76%}
.saveForm .info .counter em {font-weight:bold}
.saveForm .info .active em {color:#3274D0}
.saveForm .info .error {color:#9e1919}

.saveForm li.msg {margin-top:-8px; padding-top:8px; padding-left:30px; display:none;
    background:url(skin/chrome_msg.gif) no-repeat 15px -10px}
.saveForm li.msg .info {top:10px}

.saveForm li.error label,
.saveForm li.error .info {color:#9e1919}
.saveForm li.error input,
.saveForm li.error textarea {border-color:#9e1919; background-color:#ffeeee}
/* @end */


/* @group tagLines */
.tagLines {overflow:hidden; width:100%; background:white; border:1px solid #ccc; border-color:#ccc #aaa #aaa #ccc; padding:1px 3px 0 2px}
.error .tagLines {border-color:#9e1919; background:#ffeeee}
.tagLines li.newTagItem {float:left; position:relative; height:17px; margin:0 3px 2px 0; padding:0; background:#e8f1f7; border-radius:3px;  }
.tagLines li.newTagItem a {display:block; position:relative; padding:1px 18px 0 5px; color:#000; cursor:pointer; height:16px}
.tagLines li.newTagItem:hover a {color:#005dc9;}
.tagLines li.newTagItem a:hover {text-decoration:none}
.tagLines li.newTagItem span {position:absolute; top:2px; right:2px; height:14px; width:13px; opacity:0.2;
    background:transparent url('skin/delAC.png') no-repeat 0 -60px}
.tagLines li.newTagItem span:hover { opacity:1}
.tagLines li em {font-style:normal}

.tagLines li.flash {background:#C5D5E0}
.tagLines li.flash a {color:#000}

.tagLinesEnabled {margin-bottom:1em; width:100%; height:auto !important}
.tagLinesEnabled .info {bottom:auto !important}
.newTagsEditor {position:relative; width:100%; background:transparent}
.tagLines li.newTagInputWrapper {width:100px; float:left; display:block; height:17px; margin:0 0 2px 0; padding:0; background:none}
.tagLines li.newTagInputWrapper input {position:static !important; border:none !important; background:#fff; padding:1px !important}
.error li.newTagInputWrapper input {background:#ffeeee}
.tagLines li.clr {float:none; clear:both; height:0; margin:0; padding:0; position:static}

.clearNewTags {position:absolute; left:3.6em; top:0; cursor:pointer; padding:0; font-size:84%}
.clearNewTags span {color:#3274D0}
.clearNewTags span {text-decoration:underline}
/* @end */


/* @group AutoComplete */
.yui-ac-container {position:absolute !important; width:16em; margin:19px 0 0; font-size:100%}
.yui-ac-container .yui-ac-content {position:absolute; width:100%; background-color:#fff; border:1px solid #565656; overflow:hidden; z-index:100}
.yui-ac-container ul {padding:0; width:100%}
.yui-ac-container li {display:block; position:relative; float:none !important; padding:0 !important; margin:0 !important; cursor:default;
    white-space:nowrap; min-height:0 !important;
    padding-right:2em; color:#565656}
.yui-ac-container li span {display:block; padding:0; margin:0}
.yui-ac-container li strong {display:block; padding:1px 2px}
.yui-ac-container li strong.for {color:#2261A0}
.yui-ac-container li.yui-ac-highlight,
.yui-ac-container li.yui-ac-prehighlight {cursor:pointer}
.yui-ac-container li.yui-ac-highlight strong {background-color:#8F8F8F; color:#fff}
.yui-ac-container li.yui-ac-highlight:hover strong,
.yui-ac-container li.yui-ac-prehighlight strong {background-color:#6C6C6C; color:#fff}
.send .yui-ac-container li.yui-ac-highlight strong,
.yui-ac-container li.yui-ac-highlight strong.for {background-color:#7591BA; color:#fff}
.send .yui-ac-container li:hover strong,
.send .yui-ac-container li.yui-ac-prehighlight strong,
.yui-ac-container li.yui-ac-highlight:hover strong.for,
.yui-ac-container li.yui-ac-prehighlight strong.for {background-color:#5F7CA7; color:#fff}
.yui-ac-container li em.numSaves {position:absolute; top:0; right:0; padding:1px 5px 0 0; font-weight:bold}


.yui-ac-container li strong.del,
.yui-ac-container li strong.delicious,
.yui-ac-container li strong.twitter,
.yui-ac-container li strong.email {
	padding-left:20px;
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAABQCAYAAADC+/9VAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAANsSURBVHja7FZbSBRhFP5mdt11TTPDu2lsaBcIjAyql6IErcfC3spIMLo9FFFURC9FBCFkBUWQIVIR3aConuwiBBFd1FLC0s0UXW+la152192/c36dcWdci+qt9sBh5j//+c7tP/+ZUYQQWLz3jXDYVJSsScJ0dKm6G2NjAu/OLFWsLNhdmCI3Wnt9OLXFaVAOBgWOXP2M7fnJukzVXnauz8DcRBsOVbngGwtK2dBoQAJYzvtTQEylBelS4dj1VrT3eXH85he53rEuw+DdALJaFB14/mHHhId0KIoxP6s5YQZyKJ3fvEhLsIctigT1ePxSyUxmmat7dBL04uMwmrs+41fUNTAmnwqf0++Sij+gCOg/AhUSXyQu+SmKe2+Ci0YCQjzqE8LtFUwnQ/YMHLp4fq5diOTnQuxpkqB+4jziXOJFxFGabugldHT4gFgL3S8/QLcgnmy+4o0oBcEZFryl1018rUJBQStdaxuxi+5aUcNE+LwhoB7KQl7BbBzkGWQNl6ePhpHLP7keCgCNwwCBksPOCJqHyIwGtqVOuKd1NNV4bYJc+s0gNUAKZBQJJN2QGL7YZpA7i4YPTysaGXjQBzjJI49NO3nKcUwqhs6IzW4fqrgAXD0uClVNmuYcD2cBxam4Tcui0I64kWrD4/JsYHHMeBWlVd38eIrmjmCOJa70B8XIhyEh6r8LUTcoBL8T9RKvYL3ICPuHQVZzB4dS3oG6KYDXp3OVf7oQivkPg+hdff1/0xGR6x4BmTrCLGjp9Ii2r0G093oxJ9GOzNkq5qXNVMKCWPnEnS7UuoanWF7ijMHRjSk6WNEAJRe+SAXPcCBsSDNjLKjYmSWBMif2wDQvxY5b+51SQVPk9dZVs6QxNswOLM8a+kXlk17Yo1TcObgQCbF2rF7kQBN9gMuKM+BMjcPyBfF4+WkQ3+iHIjneBrW2eUAP6+z98RBZ8fKubPlkqmkcQEuXV+pUv/dArWvz6XFX1vTjWk23IRcG7LvSqufKhVJzM22GZFfOdxhAXHItR01HTYyPNlRHC8nlHtRDZbkG3LAsDqrZshZSUZnLkCNXlomdyHMqv9cq7r4at1yan4Sy+27dAJeb8+Zc+JArducoyq+6QQudPWldYegpeWZPewxgBrB3TsPQRtM1bbhmjcy9vwX9EGAA/mC3tNiVJAkAAAAASUVORK5CYII=) no-repeat 0 0;
}
		
.yui-ac-container li strong.del,
.yui-ac-container li strong.delicious { background-position:3px -36px}
.yui-ac-container li strong.twitter { background-position:3px -16px}
.yui-ac-container li strong.email { background-position:3px 4px}
/* @end */


	</style>
	<title>test</title>
</head>
<body style="height:30px;" class="debug">

<div id="loadingMsg"><span>Loading...</span></div>

<div id="chrome" class="loadingPage">

<div id="hd">
    <h1 id="titleAction">Save a Bookmark</h1>
    <div class="options">
        <span id="signedInAs"></span>
    </div>
</div>

<form method="post" id="saveitem" class="saveForm">
    <input name="key" id="key" class="hidden" type="hidden" value="">

    <fieldset>
        <div id="msgs"></div>
		<div id="datesaved"></div>
        <ul id="saveFields">
            <li id="urlfield" class="field url">
                <label for="url">URL</label>
                <span class="info">required</span>
                <input id="url" type="text" class="text" name="url" required="required">
            </li>
            <li id="titlefield" class="field title">
                <label for="title">TITLE</label>
                <span class="info">required</span>
                <input id="title" type="text" class="text" name="title" value="">
            </li>
            <li id="notesfield" class="field note">
                <label for="notes">NOTES</label>
                <span class="info"><span id="notescount" class="counter"><em>1000</em> characters left</span></span>
                <textarea id="notes" class="text" name="notes"></textarea>
            </li>
            <li id="tagfield" class="field tags">
                <label for="tags">TAGS</label>
                <span class="info">space separated</span>
                <input id="tags" type="text" class="text" name="tags" value="">
            </li>
            <li id="sendfield" class="field send">
                <label for="send">SEND</label>
                <span class="info">space separated</span>
                <input id="send" type="text" class="text" name="send" value="">
            </li>
            <li id="messageField" class="field msg">
                <label for="message">MESSAGE</label>
                <span class="info"><span id="messagecount" class="counter"><em>116</em> characters left</span></span>
                <input type="text" class="text" name="message" id="message" autocomplete="off" value="">
            </li>
            <li id="whatthef" class="field footer">
                <div class="remember">
                    <input type="checkbox" id="share" name="share" value="no"  >
                    <label for="share">Mark as private</label>
                </div>
                <div class="bttns">
                    <div class="btn btn-save">
			<input id="save" name="submit" type="submit" value="Save" onclick="Delicious.Opera.handleSave">
		    </div>
                    <div class="btn btn-cancel"><a id="cancel" href="#" onclick="window.blur();window.close();">Cancel</a></div>
                </div>
            </li>
        </ul>

    </fieldset>
</form>



</div>
<script>

	/* 
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
if(typeof YAHOO=="undefined"||!YAHOO){var YAHOO={};}YAHOO.namespace=function(){var A=arguments,E=null,C,B,D;for(C=0;C<A.length;C=C+1){D=(""+A[C]).split(".");E=YAHOO;for(B=(D[0]=="YAHOO")?1:0;B<D.length;B=B+1){E[D[B]]=E[D[B]]||{};E=E[D[B]];}}return E;};YAHOO.log=function(D,A,C){var B=YAHOO.widget.Logger;if(B&&B.log){return B.log(D,A,C);}else{return false;}};YAHOO.register=function(A,E,D){var I=YAHOO.env.modules,B,H,G,F,C;if(!I[A]){I[A]={versions:[],builds:[]};}B=I[A];H=D.version;G=D.build;F=YAHOO.env.listeners;B.name=A;B.version=H;B.build=G;B.versions.push(H);B.builds.push(G);B.mainClass=E;for(C=0;C<F.length;C=C+1){F[C](B);}if(E){E.VERSION=H;E.BUILD=G;}else{YAHOO.log("mainClass is undefined for module "+A,"warn");}};YAHOO.env=YAHOO.env||{modules:[],listeners:[]};YAHOO.env.getVersion=function(A){return YAHOO.env.modules[A]||null;};YAHOO.env.ua=function(){var C={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,caja:0},B=navigator.userAgent,A;if((/KHTML/).test(B)){C.webkit=1;}A=B.match(/AppleWebKit\/([^\s]*)/);if(A&&A[1]){C.webkit=parseFloat(A[1]);if(/ Mobile\//.test(B)){C.mobile="Apple";}else{A=B.match(/NokiaN[^\/]*/);if(A){C.mobile=A[0];}}A=B.match(/AdobeAIR\/([^\s]*)/);if(A){C.air=A[0];}}if(!C.webkit){A=B.match(/Opera[\s\/]([^\s]*)/);if(A&&A[1]){C.opera=parseFloat(A[1]);A=B.match(/Opera Mini[^;]*/);if(A){C.mobile=A[0];}}else{A=B.match(/MSIE\s([^;]*)/);if(A&&A[1]){C.ie=parseFloat(A[1]);}else{A=B.match(/Gecko\/([^\s]*)/);if(A){C.gecko=1;A=B.match(/rv:([^\s\)]*)/);if(A&&A[1]){C.gecko=parseFloat(A[1]);}}}}}A=B.match(/Caja\/([^\s]*)/);if(A&&A[1]){C.caja=parseFloat(A[1]);}return C;}();(function(){YAHOO.namespace("util","widget","example");if("undefined"!==typeof YAHOO_config){var B=YAHOO_config.listener,A=YAHOO.env.listeners,D=true,C;if(B){for(C=0;C<A.length;C=C+1){if(A[C]==B){D=false;break;}}if(D){A.push(B);}}}})();YAHOO.lang=YAHOO.lang||{};(function(){var B=YAHOO.lang,F="[object Array]",C="[object Function]",A=Object.prototype,E=["toString","valueOf"],D={isArray:function(G){return A.toString.apply(G)===F;},isBoolean:function(G){return typeof G==="boolean";},isFunction:function(G){return A.toString.apply(G)===C;},isNull:function(G){return G===null;},isNumber:function(G){return typeof G==="number"&&isFinite(G);},isObject:function(G){return(G&&(typeof G==="object"||B.isFunction(G)))||false;},isString:function(G){return typeof G==="string";},isUndefined:function(G){return typeof G==="undefined";},_IEEnumFix:(YAHOO.env.ua.ie)?function(I,H){var G,K,J;for(G=0;G<E.length;G=G+1){K=E[G];J=H[K];if(B.isFunction(J)&&J!=A[K]){I[K]=J;}}}:function(){},extend:function(J,K,I){if(!K||!J){throw new Error("extend failed, please check that "+"all dependencies are included.");}var H=function(){},G;H.prototype=K.prototype;J.prototype=new H();J.prototype.constructor=J;J.superclass=K.prototype;if(K.prototype.constructor==A.constructor){K.prototype.constructor=K;}if(I){for(G in I){if(B.hasOwnProperty(I,G)){J.prototype[G]=I[G];}}B._IEEnumFix(J.prototype,I);}},augmentObject:function(K,J){if(!J||!K){throw new Error("Absorb failed, verify dependencies.");}var G=arguments,I,L,H=G[2];if(H&&H!==true){for(I=2;I<G.length;I=I+1){K[G[I]]=J[G[I]];}}else{for(L in J){if(H||!(L in K)){K[L]=J[L];}}B._IEEnumFix(K,J);}},augmentProto:function(J,I){if(!I||!J){throw new Error("Augment failed, verify dependencies.");}var G=[J.prototype,I.prototype],H;for(H=2;H<arguments.length;H=H+1){G.push(arguments[H]);}B.augmentObject.apply(this,G);},dump:function(G,L){var I,K,N=[],O="{...}",H="f(){...}",M=", ",J=" => ";if(!B.isObject(G)){return G+"";}else{if(G instanceof Date||("nodeType" in G&&"tagName" in G)){return G;}else{if(B.isFunction(G)){return H;}}}L=(B.isNumber(L))?L:3;if(B.isArray(G)){N.push("[");for(I=0,K=G.length;I<K;I=I+1){if(B.isObject(G[I])){N.push((L>0)?B.dump(G[I],L-1):O);}else{N.push(G[I]);}N.push(M);}if(N.length>1){N.pop();}N.push("]");}else{N.push("{");for(I in G){if(B.hasOwnProperty(G,I)){N.push(I+J);if(B.isObject(G[I])){N.push((L>0)?B.dump(G[I],L-1):O);}else{N.push(G[I]);}N.push(M);}}if(N.length>1){N.pop();}N.push("}");}return N.join("");},substitute:function(V,H,O){var L,K,J,R,S,U,Q=[],I,M="dump",P=" ",G="{",T="}",N;for(;;){L=V.lastIndexOf(G);if(L<0){break;}K=V.indexOf(T,L);if(L+1>=K){break;}I=V.substring(L+1,K);R=I;U=null;J=R.indexOf(P);if(J>-1){U=R.substring(J+1);R=R.substring(0,J);}S=H[R];if(O){S=O(R,S,U);}if(B.isObject(S)){if(B.isArray(S)){S=B.dump(S,parseInt(U,10));}else{U=U||"";N=U.indexOf(M);if(N>-1){U=U.substring(4);}if(S.toString===A.toString||N>-1){S=B.dump(S,parseInt(U,10));}else{S=S.toString();}}}else{if(!B.isString(S)&&!B.isNumber(S)){S="~-"+Q.length+"-~";Q[Q.length]=I;}}V=V.substring(0,L)+S+V.substring(K+1);}for(L=Q.length-1;L>=0;L=L-1){V=V.replace(new RegExp("~-"+L+"-~"),"{"+Q[L]+"}","g");}return V;},trim:function(G){try{return G.replace(/^\s+|\s+$/g,"");}catch(H){return G;}},merge:function(){var J={},H=arguments,G=H.length,I;for(I=0;I<G;I=I+1){B.augmentObject(J,H[I],true);}return J;},later:function(N,H,O,J,K){N=N||0;H=H||{};var I=O,M=J,L,G;if(B.isString(O)){I=H[O];}if(!I){throw new TypeError("method undefined");}if(!B.isArray(M)){M=[J];}L=function(){I.apply(H,M);};G=(K)?setInterval(L,N):setTimeout(L,N);return{interval:K,cancel:function(){if(this.interval){clearInterval(G);}else{clearTimeout(G);}}};},isValue:function(G){return(B.isObject(G)||B.isString(G)||B.isNumber(G)||B.isBoolean(G));}};B.hasOwnProperty=(A.hasOwnProperty)?function(G,H){return G&&G.hasOwnProperty(H);}:function(G,H){return !B.isUndefined(G[H])&&G.constructor.prototype[H]!==G[H];};D.augmentObject(B,D,true);YAHOO.util.Lang=B;B.augment=B.augmentProto;YAHOO.augment=B.augmentProto;YAHOO.extend=B.extend;})();YAHOO.register("yahoo",YAHOO,{version:"2.7.0",build:"1799"});(function(){YAHOO.env._id_counter=YAHOO.env._id_counter||0;var E=YAHOO.util,L=YAHOO.lang,m=YAHOO.env.ua,A=YAHOO.lang.trim,d={},h={},N=/^t(?:able|d|h)$/i,X=/color$/i,K=window.document,W=K.documentElement,e="ownerDocument",n="defaultView",v="documentElement",t="compatMode",b="offsetLeft",P="offsetTop",u="offsetParent",Z="parentNode",l="nodeType",C="tagName",O="scrollLeft",i="scrollTop",Q="getBoundingClientRect",w="getComputedStyle",a="currentStyle",M="CSS1Compat",c="BackCompat",g="class",F="className",J="",B=" ",s="(?:^|\\s)",k="(?= |$)",U="g",p="position",f="fixed",V="relative",j="left",o="top",r="medium",q="borderLeftWidth",R="borderTopWidth",D=m.opera,I=m.webkit,H=m.gecko,T=m.ie;E.Dom={CUSTOM_ATTRIBUTES:(!W.hasAttribute)?{"for":"htmlFor","class":F}:{"htmlFor":"for","className":g},get:function(y){var AA,Y,z,x,G;if(y){if(y[l]||y.item){return y;}if(typeof y==="string"){AA=y;y=K.getElementById(y);if(y&&y.id===AA){return y;}else{if(y&&K.all){y=null;Y=K.all[AA];for(x=0,G=Y.length;x<G;++x){if(Y[x].id===AA){return Y[x];}}}}return y;}if(y.DOM_EVENTS){y=y.get("element");}if("length" in y){z=[];for(x=0,G=y.length;x<G;++x){z[z.length]=E.Dom.get(y[x]);}return z;}return y;}return null;},getComputedStyle:function(G,Y){if(window[w]){return G[e][n][w](G,null)[Y];}else{if(G[a]){return E.Dom.IE_ComputedStyle.get(G,Y);}}},getStyle:function(G,Y){return E.Dom.batch(G,E.Dom._getStyle,Y);},_getStyle:function(){if(window[w]){return function(G,y){y=(y==="float")?y="cssFloat":E.Dom._toCamel(y);var x=G.style[y],Y;if(!x){Y=G[e][n][w](G,null);if(Y){x=Y[y];}}return x;};}else{if(W[a]){return function(G,y){var x;switch(y){case"opacity":x=100;try{x=G.filters["DXImageTransform.Microsoft.Alpha"].opacity;}catch(z){try{x=G.filters("alpha").opacity;}catch(Y){}}return x/100;case"float":y="styleFloat";default:y=E.Dom._toCamel(y);x=G[a]?G[a][y]:null;return(G.style[y]||x);}};}}}(),setStyle:function(G,Y,x){E.Dom.batch(G,E.Dom._setStyle,{prop:Y,val:x});},_setStyle:function(){if(T){return function(Y,G){var x=E.Dom._toCamel(G.prop),y=G.val;if(Y){switch(x){case"opacity":if(L.isString(Y.style.filter)){Y.style.filter="alpha(opacity="+y*100+")";if(!Y[a]||!Y[a].hasLayout){Y.style.zoom=1;}}break;case"float":x="styleFloat";default:Y.style[x]=y;}}else{}};}else{return function(Y,G){var x=E.Dom._toCamel(G.prop),y=G.val;if(Y){if(x=="float"){x="cssFloat";}Y.style[x]=y;}else{}};}}(),getXY:function(G){return E.Dom.batch(G,E.Dom._getXY);},_canPosition:function(G){return(E.Dom._getStyle(G,"display")!=="none"&&E.Dom._inDoc(G));},_getXY:function(){if(K[v][Q]){return function(y){var z,Y,AA,AF,AE,AD,AC,G,x,AB=Math.floor,AG=false;if(E.Dom._canPosition(y)){AA=y[Q]();AF=y[e];z=E.Dom.getDocumentScrollLeft(AF);Y=E.Dom.getDocumentScrollTop(AF);AG=[AB(AA[j]),AB(AA[o])];if(T&&m.ie<8){AE=2;AD=2;AC=AF[t];G=S(AF[v],q);x=S(AF[v],R);if(m.ie===6){if(AC!==c){AE=0;AD=0;}}if((AC==c)){if(G!==r){AE=parseInt(G,10);}if(x!==r){AD=parseInt(x,10);}}AG[0]-=AE;AG[1]-=AD;}if((Y||z)){AG[0]+=z;AG[1]+=Y;}AG[0]=AB(AG[0]);AG[1]=AB(AG[1]);}else{}return AG;};}else{return function(y){var x,Y,AA,AB,AC,z=false,G=y;if(E.Dom._canPosition(y)){z=[y[b],y[P]];x=E.Dom.getDocumentScrollLeft(y[e]);Y=E.Dom.getDocumentScrollTop(y[e]);AC=((H||m.webkit>519)?true:false);while((G=G[u])){z[0]+=G[b];z[1]+=G[P];if(AC){z=E.Dom._calcBorders(G,z);}}if(E.Dom._getStyle(y,p)!==f){G=y;while((G=G[Z])&&G[C]){AA=G[i];AB=G[O];if(H&&(E.Dom._getStyle(G,"overflow")!=="visible")){z=E.Dom._calcBorders(G,z);}if(AA||AB){z[0]-=AB;z[1]-=AA;}}z[0]+=x;z[1]+=Y;}else{if(D){z[0]-=x;z[1]-=Y;}else{if(I||H){z[0]+=x;z[1]+=Y;}}}z[0]=Math.floor(z[0]);z[1]=Math.floor(z[1]);}else{}return z;};}}(),getX:function(G){var Y=function(x){return E.Dom.getXY(x)[0];};return E.Dom.batch(G,Y,E.Dom,true);},getY:function(G){var Y=function(x){return E.Dom.getXY(x)[1];};return E.Dom.batch(G,Y,E.Dom,true);},setXY:function(G,x,Y){E.Dom.batch(G,E.Dom._setXY,{pos:x,noRetry:Y});},_setXY:function(G,z){var AA=E.Dom._getStyle(G,p),y=E.Dom.setStyle,AD=z.pos,Y=z.noRetry,AB=[parseInt(E.Dom.getComputedStyle(G,j),10),parseInt(E.Dom.getComputedStyle(G,o),10)],AC,x;if(AA=="static"){AA=V;y(G,p,AA);}AC=E.Dom._getXY(G);if(!AD||AC===false){return false;}if(isNaN(AB[0])){AB[0]=(AA==V)?0:G[b];}if(isNaN(AB[1])){AB[1]=(AA==V)?0:G[P];}if(AD[0]!==null){y(G,j,AD[0]-AC[0]+AB[0]+"px");}if(AD[1]!==null){y(G,o,AD[1]-AC[1]+AB[1]+"px");}if(!Y){x=E.Dom._getXY(G);if((AD[0]!==null&&x[0]!=AD[0])||(AD[1]!==null&&x[1]!=AD[1])){E.Dom._setXY(G,{pos:AD,noRetry:true});}}},setX:function(Y,G){E.Dom.setXY(Y,[G,null]);},setY:function(G,Y){E.Dom.setXY(G,[null,Y]);},getRegion:function(G){var Y=function(x){var y=false;if(E.Dom._canPosition(x)){y=E.Region.getRegion(x);}else{}return y;};return E.Dom.batch(G,Y,E.Dom,true);},getClientWidth:function(){return E.Dom.getViewportWidth();},getClientHeight:function(){return E.Dom.getViewportHeight();},getElementsByClassName:function(AB,AF,AC,AE,x,AD){AB=L.trim(AB);AF=AF||"*";AC=(AC)?E.Dom.get(AC):null||K;if(!AC){return[];}var Y=[],G=AC.getElementsByTagName(AF),z=E.Dom.hasClass;for(var y=0,AA=G.length;y<AA;++y){if(z(G[y],AB)){Y[Y.length]=G[y];}}if(AE){E.Dom.batch(Y,AE,x,AD);}return Y;},hasClass:function(Y,G){return E.Dom.batch(Y,E.Dom._hasClass,G);},_hasClass:function(x,Y){var G=false,y;if(x&&Y){y=E.Dom.getAttribute(x,F)||J;if(Y.exec){G=Y.test(y);}else{G=Y&&(B+y+B).indexOf(B+Y+B)>-1;}}else{}return G;},addClass:function(Y,G){return E.Dom.batch(Y,E.Dom._addClass,G);},_addClass:function(x,Y){var G=false,y;if(x&&Y){y=E.Dom.getAttribute(x,F)||J;if(!E.Dom._hasClass(x,Y)){E.Dom.setAttribute(x,F,A(y+B+Y));G=true;}}else{}return G;},removeClass:function(Y,G){return E.Dom.batch(Y,E.Dom._removeClass,G);},_removeClass:function(y,x){var Y=false,AA,z,G;if(y&&x){AA=E.Dom.getAttribute(y,F)||J;E.Dom.setAttribute(y,F,AA.replace(E.Dom._getClassRegex(x),J));z=E.Dom.getAttribute(y,F);if(AA!==z){E.Dom.setAttribute(y,F,A(z));Y=true;if(E.Dom.getAttribute(y,F)===""){G=(y.hasAttribute&&y.hasAttribute(g))?g:F;y.removeAttribute(G);}}}else{}return Y;},replaceClass:function(x,Y,G){return E.Dom.batch(x,E.Dom._replaceClass,{from:Y,to:G});
},_replaceClass:function(y,x){var Y,AB,AA,G=false,z;if(y&&x){AB=x.from;AA=x.to;if(!AA){G=false;}else{if(!AB){G=E.Dom._addClass(y,x.to);}else{if(AB!==AA){z=E.Dom.getAttribute(y,F)||J;Y=(B+z.replace(E.Dom._getClassRegex(AB),B+AA)).split(E.Dom._getClassRegex(AA));Y.splice(1,0,B+AA);E.Dom.setAttribute(y,F,A(Y.join(J)));G=true;}}}}else{}return G;},generateId:function(G,x){x=x||"yui-gen";var Y=function(y){if(y&&y.id){return y.id;}var z=x+YAHOO.env._id_counter++;if(y){if(y[e].getElementById(z)){return E.Dom.generateId(y,z+x);}y.id=z;}return z;};return E.Dom.batch(G,Y,E.Dom,true)||Y.apply(E.Dom,arguments);},isAncestor:function(Y,x){Y=E.Dom.get(Y);x=E.Dom.get(x);var G=false;if((Y&&x)&&(Y[l]&&x[l])){if(Y.contains&&Y!==x){G=Y.contains(x);}else{if(Y.compareDocumentPosition){G=!!(Y.compareDocumentPosition(x)&16);}}}else{}return G;},inDocument:function(G,Y){return E.Dom._inDoc(E.Dom.get(G),Y);},_inDoc:function(Y,x){var G=false;if(Y&&Y[C]){x=x||Y[e];G=E.Dom.isAncestor(x[v],Y);}else{}return G;},getElementsBy:function(Y,AF,AB,AD,y,AC,AE){AF=AF||"*";AB=(AB)?E.Dom.get(AB):null||K;if(!AB){return[];}var x=[],G=AB.getElementsByTagName(AF);for(var z=0,AA=G.length;z<AA;++z){if(Y(G[z])){if(AE){x=G[z];break;}else{x[x.length]=G[z];}}}if(AD){E.Dom.batch(x,AD,y,AC);}return x;},getElementBy:function(x,G,Y){return E.Dom.getElementsBy(x,G,Y,null,null,null,true);},batch:function(x,AB,AA,z){var y=[],Y=(z)?AA:window;x=(x&&(x[C]||x.item))?x:E.Dom.get(x);if(x&&AB){if(x[C]||x.length===undefined){return AB.call(Y,x,AA);}for(var G=0;G<x.length;++G){y[y.length]=AB.call(Y,x[G],AA);}}else{return false;}return y;},getDocumentHeight:function(){var Y=(K[t]!=M||I)?K.body.scrollHeight:W.scrollHeight,G=Math.max(Y,E.Dom.getViewportHeight());return G;},getDocumentWidth:function(){var Y=(K[t]!=M||I)?K.body.scrollWidth:W.scrollWidth,G=Math.max(Y,E.Dom.getViewportWidth());return G;},getViewportHeight:function(){var G=self.innerHeight,Y=K[t];if((Y||T)&&!D){G=(Y==M)?W.clientHeight:K.body.clientHeight;}return G;},getViewportWidth:function(){var G=self.innerWidth,Y=K[t];if(Y||T){G=(Y==M)?W.clientWidth:K.body.clientWidth;}return G;},getAncestorBy:function(G,Y){while((G=G[Z])){if(E.Dom._testElement(G,Y)){return G;}}return null;},getAncestorByClassName:function(Y,G){Y=E.Dom.get(Y);if(!Y){return null;}var x=function(y){return E.Dom.hasClass(y,G);};return E.Dom.getAncestorBy(Y,x);},getAncestorByTagName:function(Y,G){Y=E.Dom.get(Y);if(!Y){return null;}var x=function(y){return y[C]&&y[C].toUpperCase()==G.toUpperCase();};return E.Dom.getAncestorBy(Y,x);},getPreviousSiblingBy:function(G,Y){while(G){G=G.previousSibling;if(E.Dom._testElement(G,Y)){return G;}}return null;},getPreviousSibling:function(G){G=E.Dom.get(G);if(!G){return null;}return E.Dom.getPreviousSiblingBy(G);},getNextSiblingBy:function(G,Y){while(G){G=G.nextSibling;if(E.Dom._testElement(G,Y)){return G;}}return null;},getNextSibling:function(G){G=E.Dom.get(G);if(!G){return null;}return E.Dom.getNextSiblingBy(G);},getFirstChildBy:function(G,x){var Y=(E.Dom._testElement(G.firstChild,x))?G.firstChild:null;return Y||E.Dom.getNextSiblingBy(G.firstChild,x);},getFirstChild:function(G,Y){G=E.Dom.get(G);if(!G){return null;}return E.Dom.getFirstChildBy(G);},getLastChildBy:function(G,x){if(!G){return null;}var Y=(E.Dom._testElement(G.lastChild,x))?G.lastChild:null;return Y||E.Dom.getPreviousSiblingBy(G.lastChild,x);},getLastChild:function(G){G=E.Dom.get(G);return E.Dom.getLastChildBy(G);},getChildrenBy:function(Y,y){var x=E.Dom.getFirstChildBy(Y,y),G=x?[x]:[];E.Dom.getNextSiblingBy(x,function(z){if(!y||y(z)){G[G.length]=z;}return false;});return G;},getChildren:function(G){G=E.Dom.get(G);if(!G){}return E.Dom.getChildrenBy(G);},getDocumentScrollLeft:function(G){G=G||K;return Math.max(G[v].scrollLeft,G.body.scrollLeft);},getDocumentScrollTop:function(G){G=G||K;return Math.max(G[v].scrollTop,G.body.scrollTop);},insertBefore:function(Y,G){Y=E.Dom.get(Y);G=E.Dom.get(G);if(!Y||!G||!G[Z]){return null;}return G[Z].insertBefore(Y,G);},insertAfter:function(Y,G){Y=E.Dom.get(Y);G=E.Dom.get(G);if(!Y||!G||!G[Z]){return null;}if(G.nextSibling){return G[Z].insertBefore(Y,G.nextSibling);}else{return G[Z].appendChild(Y);}},getClientRegion:function(){var x=E.Dom.getDocumentScrollTop(),Y=E.Dom.getDocumentScrollLeft(),y=E.Dom.getViewportWidth()+Y,G=E.Dom.getViewportHeight()+x;return new E.Region(x,y,G,Y);},setAttribute:function(Y,G,x){G=E.Dom.CUSTOM_ATTRIBUTES[G]||G;Y.setAttribute(G,x);},getAttribute:function(Y,G){G=E.Dom.CUSTOM_ATTRIBUTES[G]||G;return Y.getAttribute(G);},_toCamel:function(Y){var x=d;function G(y,z){return z.toUpperCase();}return x[Y]||(x[Y]=Y.indexOf("-")===-1?Y:Y.replace(/-([a-z])/gi,G));},_getClassRegex:function(Y){var G;if(Y!==undefined){if(Y.exec){G=Y;}else{G=h[Y];if(!G){Y=Y.replace(E.Dom._patterns.CLASS_RE_TOKENS,"\\$1");G=h[Y]=new RegExp(s+Y+k,U);}}}return G;},_patterns:{ROOT_TAG:/^body|html$/i,CLASS_RE_TOKENS:/([\.\(\)\^\$\*\+\?\|\[\]\{\}])/g},_testElement:function(G,Y){return G&&G[l]==1&&(!Y||Y(G));},_calcBorders:function(x,y){var Y=parseInt(E.Dom[w](x,R),10)||0,G=parseInt(E.Dom[w](x,q),10)||0;if(H){if(N.test(x[C])){Y=0;G=0;}}y[0]+=G;y[1]+=Y;return y;}};var S=E.Dom[w];if(m.opera){E.Dom[w]=function(Y,G){var x=S(Y,G);if(X.test(G)){x=E.Dom.Color.toRGB(x);}return x;};}if(m.webkit){E.Dom[w]=function(Y,G){var x=S(Y,G);if(x==="rgba(0, 0, 0, 0)"){x="transparent";}return x;};}})();YAHOO.util.Region=function(C,D,A,B){this.top=C;this.y=C;this[1]=C;this.right=D;this.bottom=A;this.left=B;this.x=B;this[0]=B;this.width=this.right-this.left;this.height=this.bottom-this.top;};YAHOO.util.Region.prototype.contains=function(A){return(A.left>=this.left&&A.right<=this.right&&A.top>=this.top&&A.bottom<=this.bottom);};YAHOO.util.Region.prototype.getArea=function(){return((this.bottom-this.top)*(this.right-this.left));};YAHOO.util.Region.prototype.intersect=function(E){var C=Math.max(this.top,E.top),D=Math.min(this.right,E.right),A=Math.min(this.bottom,E.bottom),B=Math.max(this.left,E.left);if(A>=C&&D>=B){return new YAHOO.util.Region(C,D,A,B);
}else{return null;}};YAHOO.util.Region.prototype.union=function(E){var C=Math.min(this.top,E.top),D=Math.max(this.right,E.right),A=Math.max(this.bottom,E.bottom),B=Math.min(this.left,E.left);return new YAHOO.util.Region(C,D,A,B);};YAHOO.util.Region.prototype.toString=function(){return("Region {"+"top: "+this.top+", right: "+this.right+", bottom: "+this.bottom+", left: "+this.left+", height: "+this.height+", width: "+this.width+"}");};YAHOO.util.Region.getRegion=function(D){var F=YAHOO.util.Dom.getXY(D),C=F[1],E=F[0]+D.offsetWidth,A=F[1]+D.offsetHeight,B=F[0];return new YAHOO.util.Region(C,E,A,B);};YAHOO.util.Point=function(A,B){if(YAHOO.lang.isArray(A)){B=A[1];A=A[0];}YAHOO.util.Point.superclass.constructor.call(this,B,A,B,A);};YAHOO.extend(YAHOO.util.Point,YAHOO.util.Region);(function(){var B=YAHOO.util,A="clientTop",F="clientLeft",J="parentNode",K="right",W="hasLayout",I="px",U="opacity",L="auto",D="borderLeftWidth",G="borderTopWidth",P="borderRightWidth",V="borderBottomWidth",S="visible",Q="transparent",N="height",E="width",H="style",T="currentStyle",R=/^width|height$/,O=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i,M={get:function(X,Z){var Y="",a=X[T][Z];if(Z===U){Y=B.Dom.getStyle(X,U);}else{if(!a||(a.indexOf&&a.indexOf(I)>-1)){Y=a;}else{if(B.Dom.IE_COMPUTED[Z]){Y=B.Dom.IE_COMPUTED[Z](X,Z);}else{if(O.test(a)){Y=B.Dom.IE.ComputedStyle.getPixel(X,Z);}else{Y=a;}}}}return Y;},getOffset:function(Z,e){var b=Z[T][e],X=e.charAt(0).toUpperCase()+e.substr(1),c="offset"+X,Y="pixel"+X,a="",d;if(b==L){d=Z[c];if(d===undefined){a=0;}a=d;if(R.test(e)){Z[H][e]=d;if(Z[c]>d){a=d-(Z[c]-d);}Z[H][e]=L;}}else{if(!Z[H][Y]&&!Z[H][e]){Z[H][e]=b;}a=Z[H][Y];}return a+I;},getBorderWidth:function(X,Z){var Y=null;if(!X[T][W]){X[H].zoom=1;}switch(Z){case G:Y=X[A];break;case V:Y=X.offsetHeight-X.clientHeight-X[A];break;case D:Y=X[F];break;case P:Y=X.offsetWidth-X.clientWidth-X[F];break;}return Y+I;},getPixel:function(Y,X){var a=null,b=Y[T][K],Z=Y[T][X];Y[H][K]=Z;a=Y[H].pixelRight;Y[H][K]=b;return a+I;},getMargin:function(Y,X){var Z;if(Y[T][X]==L){Z=0+I;}else{Z=B.Dom.IE.ComputedStyle.getPixel(Y,X);}return Z;},getVisibility:function(Y,X){var Z;while((Z=Y[T])&&Z[X]=="inherit"){Y=Y[J];}return(Z)?Z[X]:S;},getColor:function(Y,X){return B.Dom.Color.toRGB(Y[T][X])||Q;},getBorderColor:function(Y,X){var Z=Y[T],a=Z[X]||Z.color;return B.Dom.Color.toRGB(B.Dom.Color.toHex(a));}},C={};C.top=C.right=C.bottom=C.left=C[E]=C[N]=M.getOffset;C.color=M.getColor;C[G]=C[P]=C[V]=C[D]=M.getBorderWidth;C.marginTop=C.marginRight=C.marginBottom=C.marginLeft=M.getMargin;C.visibility=M.getVisibility;C.borderColor=C.borderTopColor=C.borderRightColor=C.borderBottomColor=C.borderLeftColor=M.getBorderColor;B.Dom.IE_COMPUTED=C;B.Dom.IE_ComputedStyle=M;})();(function(){var C="toString",A=parseInt,B=RegExp,D=YAHOO.util;D.Dom.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(E){if(!D.Dom.Color.re_RGB.test(E)){E=D.Dom.Color.toHex(E);}if(D.Dom.Color.re_hex.exec(E)){E="rgb("+[A(B.$1,16),A(B.$2,16),A(B.$3,16)].join(", ")+")";}return E;},toHex:function(H){H=D.Dom.Color.KEYWORDS[H]||H;if(D.Dom.Color.re_RGB.exec(H)){var G=(B.$1.length===1)?"0"+B.$1:Number(B.$1),F=(B.$2.length===1)?"0"+B.$2:Number(B.$2),E=(B.$3.length===1)?"0"+B.$3:Number(B.$3);H=[G[C](16),F[C](16),E[C](16)].join("");}if(H.length<6){H=H.replace(D.Dom.Color.re_hex3,"$1$1");}if(H!=="transparent"&&H.indexOf("#")<0){H="#"+H;}return H.toLowerCase();}};}());YAHOO.register("dom",YAHOO.util.Dom,{version:"2.7.0",build:"1799"});YAHOO.util.CustomEvent=function(D,C,B,A){this.type=D;this.scope=C||window;this.silent=B;this.signature=A||YAHOO.util.CustomEvent.LIST;this.subscribers=[];if(!this.silent){}var E="_YUICEOnSubscribe";if(D!==E){this.subscribeEvent=new YAHOO.util.CustomEvent(E,this,true);}this.lastError=null;};YAHOO.util.CustomEvent.LIST=0;YAHOO.util.CustomEvent.FLAT=1;YAHOO.util.CustomEvent.prototype={subscribe:function(A,B,C){if(!A){throw new Error("Invalid callback for subscriber to '"+this.type+"'");}if(this.subscribeEvent){this.subscribeEvent.fire(A,B,C);}this.subscribers.push(new YAHOO.util.Subscriber(A,B,C));},unsubscribe:function(D,F){if(!D){return this.unsubscribeAll();}var E=false;for(var B=0,A=this.subscribers.length;B<A;++B){var C=this.subscribers[B];if(C&&C.contains(D,F)){this._delete(B);E=true;}}return E;},fire:function(){this.lastError=null;var K=[],E=this.subscribers.length;if(!E&&this.silent){return true;}var I=[].slice.call(arguments,0),G=true,D,J=false;if(!this.silent){}var C=this.subscribers.slice(),A=YAHOO.util.Event.throwErrors;for(D=0;D<E;++D){var M=C[D];if(!M){J=true;}else{if(!this.silent){}var L=M.getScope(this.scope);if(this.signature==YAHOO.util.CustomEvent.FLAT){var B=null;if(I.length>0){B=I[0];}try{G=M.fn.call(L,B,M.obj);}catch(F){this.lastError=F;if(A){throw F;}}}else{try{G=M.fn.call(L,this.type,I,M.obj);}catch(H){this.lastError=H;if(A){throw H;}}}if(false===G){if(!this.silent){}break;}}}return(G!==false);},unsubscribeAll:function(){var A=this.subscribers.length,B;for(B=A-1;B>-1;B--){this._delete(B);}this.subscribers=[];return A;},_delete:function(A){var B=this.subscribers[A];if(B){delete B.fn;delete B.obj;}this.subscribers.splice(A,1);},toString:function(){return"CustomEvent: "+"'"+this.type+"', "+"context: "+this.scope;}};YAHOO.util.Subscriber=function(A,B,C){this.fn=A;this.obj=YAHOO.lang.isUndefined(B)?null:B;this.overrideContext=C;};YAHOO.util.Subscriber.prototype.getScope=function(A){if(this.overrideContext){if(this.overrideContext===true){return this.obj;}else{return this.overrideContext;}}return A;};YAHOO.util.Subscriber.prototype.contains=function(A,B){if(B){return(this.fn==A&&this.obj==B);}else{return(this.fn==A);}};YAHOO.util.Subscriber.prototype.toString=function(){return"Subscriber { obj: "+this.obj+", overrideContext: "+(this.overrideContext||"no")+" }";};if(!YAHOO.util.Event){YAHOO.util.Event=function(){var H=false;var I=[];var J=[];var G=[];var E=[];var C=0;var F=[];var B=[];var A=0;var D={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9};var K=YAHOO.env.ua.ie?"focusin":"focus";var L=YAHOO.env.ua.ie?"focusout":"blur";return{POLL_RETRYS:2000,POLL_INTERVAL:20,EL:0,TYPE:1,FN:2,WFN:3,UNLOAD_OBJ:3,ADJ_SCOPE:4,OBJ:5,OVERRIDE:6,lastError:null,isSafari:YAHOO.env.ua.webkit,webkit:YAHOO.env.ua.webkit,isIE:YAHOO.env.ua.ie,_interval:null,_dri:null,DOMReady:false,throwErrors:false,startInterval:function(){if(!this._interval){var M=this;var N=function(){M._tryPreloadAttach();};this._interval=setInterval(N,this.POLL_INTERVAL);}},onAvailable:function(S,O,Q,R,P){var M=(YAHOO.lang.isString(S))?[S]:S;for(var N=0;N<M.length;N=N+1){F.push({id:M[N],fn:O,obj:Q,overrideContext:R,checkReady:P});}C=this.POLL_RETRYS;this.startInterval();},onContentReady:function(P,M,N,O){this.onAvailable(P,M,N,O,true);},onDOMReady:function(M,N,O){if(this.DOMReady){setTimeout(function(){var P=window;if(O){if(O===true){P=N;}else{P=O;}}M.call(P,"DOMReady",[],N);},0);}else{this.DOMReadyEvent.subscribe(M,N,O);}},_addListener:function(O,M,Y,S,W,b){if(!Y||!Y.call){return false;}if(this._isValidCollection(O)){var Z=true;for(var T=0,V=O.length;T<V;++T){Z=this.on(O[T],M,Y,S,W)&&Z;}return Z;}else{if(YAHOO.lang.isString(O)){var R=this.getEl(O);if(R){O=R;}else{this.onAvailable(O,function(){YAHOO.util.Event.on(O,M,Y,S,W);});return true;}}}if(!O){return false;}if("unload"==M&&S!==this){J[J.length]=[O,M,Y,S,W];return true;}var N=O;if(W){if(W===true){N=S;}else{N=W;}}var P=function(c){return Y.call(N,YAHOO.util.Event.getEvent(c,O),S);};var a=[O,M,Y,P,N,S,W];var U=I.length;I[U]=a;if(this.useLegacyEvent(O,M)){var Q=this.getLegacyIndex(O,M);if(Q==-1||O!=G[Q][0]){Q=G.length;B[O.id+M]=Q;G[Q]=[O,M,O["on"+M]];E[Q]=[];O["on"+M]=function(c){YAHOO.util.Event.fireLegacyEvent(YAHOO.util.Event.getEvent(c),Q);};}E[Q].push(a);}else{try{this._simpleAdd(O,M,P,b);}catch(X){this.lastError=X;this.removeListener(O,M,Y);return false;}}return true;},addListener:function(N,Q,M,O,P){return this._addListener(N,Q,M,O,P,false);},addFocusListener:function(N,M,O,P){return this._addListener(N,K,M,O,P,true);},removeFocusListener:function(N,M){return this.removeListener(N,K,M);},addBlurListener:function(N,M,O,P){return this._addListener(N,L,M,O,P,true);},removeBlurListener:function(N,M){return this.removeListener(N,L,M);},fireLegacyEvent:function(R,P){var T=true,M,V,U,N,S;V=E[P].slice();for(var O=0,Q=V.length;O<Q;++O){U=V[O];if(U&&U[this.WFN]){N=U[this.ADJ_SCOPE];S=U[this.WFN].call(N,R);T=(T&&S);}}M=G[P];if(M&&M[2]){M[2](R);}return T;},getLegacyIndex:function(N,O){var M=this.generateId(N)+O;if(typeof B[M]=="undefined"){return -1;}else{return B[M];}},useLegacyEvent:function(M,N){return(this.webkit&&this.webkit<419&&("click"==N||"dblclick"==N));},removeListener:function(N,M,V){var Q,T,X;if(typeof N=="string"){N=this.getEl(N);}else{if(this._isValidCollection(N)){var W=true;for(Q=N.length-1;Q>-1;Q--){W=(this.removeListener(N[Q],M,V)&&W);}return W;}}if(!V||!V.call){return this.purgeElement(N,false,M);}if("unload"==M){for(Q=J.length-1;Q>-1;Q--){X=J[Q];if(X&&X[0]==N&&X[1]==M&&X[2]==V){J.splice(Q,1);return true;}}return false;}var R=null;var S=arguments[3];if("undefined"===typeof S){S=this._getCacheIndex(N,M,V);}if(S>=0){R=I[S];}if(!N||!R){return false;}if(this.useLegacyEvent(N,M)){var P=this.getLegacyIndex(N,M);var O=E[P];if(O){for(Q=0,T=O.length;Q<T;++Q){X=O[Q];if(X&&X[this.EL]==N&&X[this.TYPE]==M&&X[this.FN]==V){O.splice(Q,1);break;}}}}else{try{this._simpleRemove(N,M,R[this.WFN],false);}catch(U){this.lastError=U;return false;}}delete I[S][this.WFN];delete I[S][this.FN];
I.splice(S,1);return true;},getTarget:function(O,N){var M=O.target||O.srcElement;return this.resolveTextNode(M);},resolveTextNode:function(N){try{if(N&&3==N.nodeType){return N.parentNode;}}catch(M){}return N;},getPageX:function(N){var M=N.pageX;if(!M&&0!==M){M=N.clientX||0;if(this.isIE){M+=this._getScrollLeft();}}return M;},getPageY:function(M){var N=M.pageY;if(!N&&0!==N){N=M.clientY||0;if(this.isIE){N+=this._getScrollTop();}}return N;},getXY:function(M){return[this.getPageX(M),this.getPageY(M)];},getRelatedTarget:function(N){var M=N.relatedTarget;if(!M){if(N.type=="mouseout"){M=N.toElement;}else{if(N.type=="mouseover"){M=N.fromElement;}}}return this.resolveTextNode(M);},getTime:function(O){if(!O.time){var N=new Date().getTime();try{O.time=N;}catch(M){this.lastError=M;return N;}}return O.time;},stopEvent:function(M){this.stopPropagation(M);this.preventDefault(M);},stopPropagation:function(M){if(M.stopPropagation){M.stopPropagation();}else{M.cancelBubble=true;}},preventDefault:function(M){if(M.preventDefault){M.preventDefault();}else{M.returnValue=false;}},getEvent:function(O,M){var N=O||window.event;if(!N){var P=this.getEvent.caller;while(P){N=P.arguments[0];if(N&&Event==N.constructor){break;}P=P.caller;}}return N;},getCharCode:function(N){var M=N.keyCode||N.charCode||0;if(YAHOO.env.ua.webkit&&(M in D)){M=D[M];}return M;},_getCacheIndex:function(Q,R,P){for(var O=0,N=I.length;O<N;O=O+1){var M=I[O];if(M&&M[this.FN]==P&&M[this.EL]==Q&&M[this.TYPE]==R){return O;}}return -1;},generateId:function(M){var N=M.id;if(!N){N="yuievtautoid-"+A;++A;M.id=N;}return N;},_isValidCollection:function(N){try{return(N&&typeof N!=="string"&&N.length&&!N.tagName&&!N.alert&&typeof N[0]!=="undefined");}catch(M){return false;}},elCache:{},getEl:function(M){return(typeof M==="string")?document.getElementById(M):M;},clearCache:function(){},DOMReadyEvent:new YAHOO.util.CustomEvent("DOMReady",this),_load:function(N){if(!H){H=true;var M=YAHOO.util.Event;M._ready();M._tryPreloadAttach();}},_ready:function(N){var M=YAHOO.util.Event;if(!M.DOMReady){M.DOMReady=true;M.DOMReadyEvent.fire();M._simpleRemove(document,"DOMContentLoaded",M._ready);}},_tryPreloadAttach:function(){if(F.length===0){C=0;if(this._interval){clearInterval(this._interval);this._interval=null;}return;}if(this.locked){return;}if(this.isIE){if(!this.DOMReady){this.startInterval();return;}}this.locked=true;var S=!H;if(!S){S=(C>0&&F.length>0);}var R=[];var T=function(V,W){var U=V;if(W.overrideContext){if(W.overrideContext===true){U=W.obj;}else{U=W.overrideContext;}}W.fn.call(U,W.obj);};var N,M,Q,P,O=[];for(N=0,M=F.length;N<M;N=N+1){Q=F[N];if(Q){P=this.getEl(Q.id);if(P){if(Q.checkReady){if(H||P.nextSibling||!S){O.push(Q);F[N]=null;}}else{T(P,Q);F[N]=null;}}else{R.push(Q);}}}for(N=0,M=O.length;N<M;N=N+1){Q=O[N];T(this.getEl(Q.id),Q);}C--;if(S){for(N=F.length-1;N>-1;N--){Q=F[N];if(!Q||!Q.id){F.splice(N,1);}}this.startInterval();}else{if(this._interval){clearInterval(this._interval);this._interval=null;}}this.locked=false;},purgeElement:function(Q,R,T){var O=(YAHOO.lang.isString(Q))?this.getEl(Q):Q;var S=this.getListeners(O,T),P,M;if(S){for(P=S.length-1;P>-1;P--){var N=S[P];this.removeListener(O,N.type,N.fn);}}if(R&&O&&O.childNodes){for(P=0,M=O.childNodes.length;P<M;++P){this.purgeElement(O.childNodes[P],R,T);}}},getListeners:function(O,M){var R=[],N;if(!M){N=[I,J];}else{if(M==="unload"){N=[J];}else{N=[I];}}var T=(YAHOO.lang.isString(O))?this.getEl(O):O;for(var Q=0;Q<N.length;Q=Q+1){var V=N[Q];if(V){for(var S=0,U=V.length;S<U;++S){var P=V[S];if(P&&P[this.EL]===T&&(!M||M===P[this.TYPE])){R.push({type:P[this.TYPE],fn:P[this.FN],obj:P[this.OBJ],adjust:P[this.OVERRIDE],scope:P[this.ADJ_SCOPE],index:S});}}}}return(R.length)?R:null;},_unload:function(T){var N=YAHOO.util.Event,Q,P,O,S,R,U=J.slice(),M;for(Q=0,S=J.length;Q<S;++Q){O=U[Q];if(O){M=window;if(O[N.ADJ_SCOPE]){if(O[N.ADJ_SCOPE]===true){M=O[N.UNLOAD_OBJ];}else{M=O[N.ADJ_SCOPE];}}O[N.FN].call(M,N.getEvent(T,O[N.EL]),O[N.UNLOAD_OBJ]);U[Q]=null;}}O=null;M=null;J=null;if(I){for(P=I.length-1;P>-1;P--){O=I[P];if(O){N.removeListener(O[N.EL],O[N.TYPE],O[N.FN],P);}}O=null;}G=null;N._simpleRemove(window,"unload",N._unload);},_getScrollLeft:function(){return this._getScroll()[1];},_getScrollTop:function(){return this._getScroll()[0];},_getScroll:function(){var M=document.documentElement,N=document.body;if(M&&(M.scrollTop||M.scrollLeft)){return[M.scrollTop,M.scrollLeft];}else{if(N){return[N.scrollTop,N.scrollLeft];}else{return[0,0];}}},regCE:function(){},_simpleAdd:function(){if(window.addEventListener){return function(O,P,N,M){O.addEventListener(P,N,(M));};}else{if(window.attachEvent){return function(O,P,N,M){O.attachEvent("on"+P,N);};}else{return function(){};}}}(),_simpleRemove:function(){if(window.removeEventListener){return function(O,P,N,M){O.removeEventListener(P,N,(M));};}else{if(window.detachEvent){return function(N,O,M){N.detachEvent("on"+O,M);};}else{return function(){};}}}()};}();(function(){var EU=YAHOO.util.Event;EU.on=EU.addListener;EU.onFocus=EU.addFocusListener;EU.onBlur=EU.addBlurListener;
/* DOMReady: based on work by: Dean Edwards/John Resig/Matthias Miller */
if(EU.isIE){YAHOO.util.Event.onDOMReady(YAHOO.util.Event._tryPreloadAttach,YAHOO.util.Event,true);var n=document.createElement("p");EU._dri=setInterval(function(){try{n.doScroll("left");clearInterval(EU._dri);EU._dri=null;EU._ready();n=null;}catch(ex){}},EU.POLL_INTERVAL);}else{if(EU.webkit&&EU.webkit<525){EU._dri=setInterval(function(){var rs=document.readyState;if("loaded"==rs||"complete"==rs){clearInterval(EU._dri);EU._dri=null;EU._ready();}},EU.POLL_INTERVAL);}else{EU._simpleAdd(document,"DOMContentLoaded",EU._ready);}}EU._simpleAdd(window,"load",EU._load);EU._simpleAdd(window,"unload",EU._unload);EU._tryPreloadAttach();})();}YAHOO.util.EventProvider=function(){};YAHOO.util.EventProvider.prototype={__yui_events:null,__yui_subscribers:null,subscribe:function(A,C,F,E){this.__yui_events=this.__yui_events||{};var D=this.__yui_events[A];if(D){D.subscribe(C,F,E);
}else{this.__yui_subscribers=this.__yui_subscribers||{};var B=this.__yui_subscribers;if(!B[A]){B[A]=[];}B[A].push({fn:C,obj:F,overrideContext:E});}},unsubscribe:function(C,E,G){this.__yui_events=this.__yui_events||{};var A=this.__yui_events;if(C){var F=A[C];if(F){return F.unsubscribe(E,G);}}else{var B=true;for(var D in A){if(YAHOO.lang.hasOwnProperty(A,D)){B=B&&A[D].unsubscribe(E,G);}}return B;}return false;},unsubscribeAll:function(A){return this.unsubscribe(A);},createEvent:function(G,D){this.__yui_events=this.__yui_events||{};var A=D||{};var I=this.__yui_events;if(I[G]){}else{var H=A.scope||this;var E=(A.silent);var B=new YAHOO.util.CustomEvent(G,H,E,YAHOO.util.CustomEvent.FLAT);I[G]=B;if(A.onSubscribeCallback){B.subscribeEvent.subscribe(A.onSubscribeCallback);}this.__yui_subscribers=this.__yui_subscribers||{};var F=this.__yui_subscribers[G];if(F){for(var C=0;C<F.length;++C){B.subscribe(F[C].fn,F[C].obj,F[C].overrideContext);}}}return I[G];},fireEvent:function(E,D,A,C){this.__yui_events=this.__yui_events||{};var G=this.__yui_events[E];if(!G){return null;}var B=[];for(var F=1;F<arguments.length;++F){B.push(arguments[F]);}return G.fire.apply(G,B);},hasEvent:function(A){if(this.__yui_events){if(this.__yui_events[A]){return true;}}return false;}};(function(){var A=YAHOO.util.Event,C=YAHOO.lang;YAHOO.util.KeyListener=function(D,I,E,F){if(!D){}else{if(!I){}else{if(!E){}}}if(!F){F=YAHOO.util.KeyListener.KEYDOWN;}var G=new YAHOO.util.CustomEvent("keyPressed");this.enabledEvent=new YAHOO.util.CustomEvent("enabled");this.disabledEvent=new YAHOO.util.CustomEvent("disabled");if(C.isString(D)){D=document.getElementById(D);}if(C.isFunction(E)){G.subscribe(E);}else{G.subscribe(E.fn,E.scope,E.correctScope);}function H(O,N){if(!I.shift){I.shift=false;}if(!I.alt){I.alt=false;}if(!I.ctrl){I.ctrl=false;}if(O.shiftKey==I.shift&&O.altKey==I.alt&&O.ctrlKey==I.ctrl){var J,M=I.keys,L;if(YAHOO.lang.isArray(M)){for(var K=0;K<M.length;K++){J=M[K];L=A.getCharCode(O);if(J==L){G.fire(L,O);break;}}}else{L=A.getCharCode(O);if(M==L){G.fire(L,O);}}}}this.enable=function(){if(!this.enabled){A.on(D,F,H);this.enabledEvent.fire(I);}this.enabled=true;};this.disable=function(){if(this.enabled){A.removeListener(D,F,H);this.disabledEvent.fire(I);}this.enabled=false;};this.toString=function(){return"KeyListener ["+I.keys+"] "+D.tagName+(D.id?"["+D.id+"]":"");};};var B=YAHOO.util.KeyListener;B.KEYDOWN="keydown";B.KEYUP="keyup";B.KEY={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38};})();YAHOO.register("event",YAHOO.util.Event,{version:"2.7.0",build:"1799"});YAHOO.register("yahoo-dom-event", YAHOO, {version: "2.7.0", build: "1799"});

/*
Copyright (c) 2008, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.5.0
*/
YAHOO.util.Connect={_msxml_progid:["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],_http_headers:{},_has_http_headers:false,_use_default_post_header:true,_default_post_header:"application/x-www-form-urlencoded; charset=UTF-8",_default_form_header:"application/x-www-form-urlencoded",_use_default_xhr_header:true,_default_xhr_header:"XMLHttpRequest",_has_default_headers:true,_default_headers:{},_isFormSubmit:false,_isFileUpload:false,_formNode:null,_sFormData:null,_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,_submitElementValue:null,_hasSubmitListener:(function(){if(YAHOO.util.Event){YAHOO.util.Event.addListener(document,"click",function(B){var A=YAHOO.util.Event.getTarget(B);if(A.nodeName.toLowerCase()=="input"&&(A.type&&A.type.toLowerCase()=="submit")){YAHOO.util.Connect._submitElementValue=encodeURIComponent(A.name)+"="+encodeURIComponent(A.value);}});return true;}return false;})(),startEvent:new YAHOO.util.CustomEvent("start"),completeEvent:new YAHOO.util.CustomEvent("complete"),successEvent:new YAHOO.util.CustomEvent("success"),failureEvent:new YAHOO.util.CustomEvent("failure"),uploadEvent:new YAHOO.util.CustomEvent("upload"),abortEvent:new YAHOO.util.CustomEvent("abort"),_customEvents:{onStart:["startEvent","start"],onComplete:["completeEvent","complete"],onSuccess:["successEvent","success"],onFailure:["failureEvent","failure"],onUpload:["uploadEvent","upload"],onAbort:["abortEvent","abort"]},setProgId:function(A){this._msxml_progid.unshift(A);},setDefaultPostHeader:function(A){if(typeof A=="string"){this._default_post_header=A;}else{if(typeof A=="boolean"){this._use_default_post_header=A;}}},setDefaultXhrHeader:function(A){if(typeof A=="string"){this._default_xhr_header=A;}else{this._use_default_xhr_header=A;}},setPollingInterval:function(A){if(typeof A=="number"&&isFinite(A)){this._polling_interval=A;}},createXhrObject:function(E){var D,A;try{A=new XMLHttpRequest();D={conn:A,tId:E};}catch(C){for(var B=0;B<this._msxml_progid.length;++B){try{A=new ActiveXObject(this._msxml_progid[B]);D={conn:A,tId:E};break;}catch(C){}}}finally{return D;}},getConnectionObject:function(A){var C;var D=this._transaction_id;try{if(!A){C=this.createXhrObject(D);}else{C={};C.tId=D;C.isUpload=true;}if(C){this._transaction_id++;}}catch(B){}finally{return C;}},asyncRequest:function(F,C,E,A){var D=(this._isFileUpload)?this.getConnectionObject(true):this.getConnectionObject();var B=(E&&E.argument)?E.argument:null;if(!D){return null;}else{if(E&&E.customevents){this.initCustomEvents(D,E);}if(this._isFormSubmit){if(this._isFileUpload){this.uploadFile(D,E,C,A);return D;}if(F.toUpperCase()=="GET"){if(this._sFormData.length!==0){C+=((C.indexOf("?")==-1)?"?":"&")+this._sFormData;}}else{if(F.toUpperCase()=="POST"){A=A?this._sFormData+"&"+A:this._sFormData;}}}if(F.toUpperCase()=="GET"&&(E&&E.cache===false)){C+=((C.indexOf("?")==-1)?"?":"&")+"rnd="+new Date().valueOf().toString();}D.conn.open(F,C,true);if(this._use_default_xhr_header){if(!this._default_headers["X-Requested-With"]){this.initHeader("X-Requested-With",this._default_xhr_header,true);}}if((F.toUpperCase()=="POST"&&this._use_default_post_header)&&this._isFormSubmit===false){this.initHeader("Content-Type",this._default_post_header);}if(this._has_default_headers||this._has_http_headers){this.setHeader(D);}this.handleReadyState(D,E);D.conn.send(A||"");if(this._isFormSubmit===true){this.resetFormState();}this.startEvent.fire(D,B);if(D.startEvent){D.startEvent.fire(D,B);}return D;}},initCustomEvents:function(A,C){for(var B in C.customevents){if(this._customEvents[B][0]){A[this._customEvents[B][0]]=new YAHOO.util.CustomEvent(this._customEvents[B][1],(C.scope)?C.scope:null);A[this._customEvents[B][0]].subscribe(C.customevents[B]);}}},handleReadyState:function(C,D){var B=this;var A=(D&&D.argument)?D.argument:null;if(D&&D.timeout){this._timeOut[C.tId]=window.setTimeout(function(){B.abort(C,D,true);},D.timeout);}this._poll[C.tId]=window.setInterval(function(){if(C.conn&&C.conn.readyState===4){window.clearInterval(B._poll[C.tId]);delete B._poll[C.tId];if(D&&D.timeout){window.clearTimeout(B._timeOut[C.tId]);delete B._timeOut[C.tId];}B.completeEvent.fire(C,A);if(C.completeEvent){C.completeEvent.fire(C,A);}B.handleTransactionResponse(C,D);}},this._polling_interval);},handleTransactionResponse:function(F,G,A){var D,C;var B=(G&&G.argument)?G.argument:null;try{if(F.conn.status!==undefined&&F.conn.status!==0){D=F.conn.status;}else{D=13030;}}catch(E){D=13030;}if(D>=200&&D<300||D===1223){C=this.createResponseObject(F,B);if(G&&G.success){if(!G.scope){G.success(C);}else{G.success.apply(G.scope,[C]);}}this.successEvent.fire(C);if(F.successEvent){F.successEvent.fire(C);}}else{switch(D){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:C=this.createExceptionObject(F.tId,B,(A?A:false));if(G&&G.failure){if(!G.scope){G.failure(C);}else{G.failure.apply(G.scope,[C]);}}break;default:C=this.createResponseObject(F,B);if(G&&G.failure){if(!G.scope){G.failure(C);}else{G.failure.apply(G.scope,[C]);}}}this.failureEvent.fire(C);if(F.failureEvent){F.failureEvent.fire(C);}}this.releaseObject(F);C=null;},createResponseObject:function(A,G){var D={};var I={};try{var C=A.conn.getAllResponseHeaders();var F=C.split("\n");for(var E=0;E<F.length;E++){var B=F[E].indexOf(":");if(B!=-1){I[F[E].substring(0,B)]=F[E].substring(B+2);}}}catch(H){}D.tId=A.tId;D.status=(A.conn.status==1223)?204:A.conn.status;D.statusText=(A.conn.status==1223)?"No Content":A.conn.statusText;D.getResponseHeader=I;D.getAllResponseHeaders=C;D.responseText=A.conn.responseText;D.responseXML=A.conn.responseXML;if(G){D.argument=G;}return D;},createExceptionObject:function(H,D,A){var F=0;var G="communication failure";var C=-1;var B="transaction aborted";var E={};E.tId=H;if(A){E.status=C;E.statusText=B;}else{E.status=F;E.statusText=G;}if(D){E.argument=D;}return E;},initHeader:function(A,D,C){var B=(C)?this._default_headers:this._http_headers;B[A]=D;if(C){this._has_default_headers=true;}else{this._has_http_headers=true;
}},setHeader:function(A){if(this._has_default_headers){for(var B in this._default_headers){if(YAHOO.lang.hasOwnProperty(this._default_headers,B)){A.conn.setRequestHeader(B,this._default_headers[B]);}}}if(this._has_http_headers){for(var B in this._http_headers){if(YAHOO.lang.hasOwnProperty(this._http_headers,B)){A.conn.setRequestHeader(B,this._http_headers[B]);}}delete this._http_headers;this._http_headers={};this._has_http_headers=false;}},resetDefaultHeaders:function(){delete this._default_headers;this._default_headers={};this._has_default_headers=false;},setForm:function(K,E,B){this.resetFormState();var J;if(typeof K=="string"){J=(document.getElementById(K)||document.forms[K]);}else{if(typeof K=="object"){J=K;}else{return ;}}if(E){var F=this.createFrame((window.location.href.toLowerCase().indexOf("https")===0||B)?true:false);this._isFormSubmit=true;this._isFileUpload=true;this._formNode=J;return ;}var A,I,G,L;var H=false;for(var D=0;D<J.elements.length;D++){A=J.elements[D];L=A.disabled;I=A.name;G=A.value;if(!L&&I){switch(A.type){case"select-one":case"select-multiple":for(var C=0;C<A.options.length;C++){if(A.options[C].selected){if(window.ActiveXObject){this._sFormData+=encodeURIComponent(I)+"="+encodeURIComponent(A.options[C].attributes["value"].specified?A.options[C].value:A.options[C].text)+"&";}else{this._sFormData+=encodeURIComponent(I)+"="+encodeURIComponent(A.options[C].hasAttribute("value")?A.options[C].value:A.options[C].text)+"&";}}}break;case"radio":case"checkbox":if(A.checked){this._sFormData+=encodeURIComponent(I)+"="+encodeURIComponent(G)+"&";}break;case"file":case undefined:case"reset":case"button":break;case"submit":if(H===false){if(this._hasSubmitListener&&this._submitElementValue){this._sFormData+=this._submitElementValue+"&";}else{this._sFormData+=encodeURIComponent(I)+"="+encodeURIComponent(G)+"&";}H=true;}break;default:this._sFormData+=encodeURIComponent(I)+"="+encodeURIComponent(G)+"&";}}}this._isFormSubmit=true;this._sFormData=this._sFormData.substr(0,this._sFormData.length-1);this.initHeader("Content-Type",this._default_form_header);return this._sFormData;},resetFormState:function(){this._isFormSubmit=false;this._isFileUpload=false;this._formNode=null;this._sFormData="";},createFrame:function(A){var B="yuiIO"+this._transaction_id;var C;if(window.ActiveXObject){C=document.createElement("<iframe id=\""+B+"\" name=\""+B+"\" />");if(typeof A=="boolean"){C.src="javascript:false";}}else{C=document.createElement("iframe");C.id=B;C.name=B;}C.style.position="absolute";C.style.top="-1000px";C.style.left="-1000px";document.body.appendChild(C);},appendPostData:function(A){var D=[];var B=A.split("&");for(var C=0;C<B.length;C++){var E=B[C].indexOf("=");if(E!=-1){D[C]=document.createElement("input");D[C].type="hidden";D[C].name=B[C].substring(0,E);D[C].value=B[C].substring(E+1);this._formNode.appendChild(D[C]);}}return D;},uploadFile:function(D,M,E,C){var N=this;var H="yuiIO"+D.tId;var I="multipart/form-data";var K=document.getElementById(H);var J=(M&&M.argument)?M.argument:null;var B={action:this._formNode.getAttribute("action"),method:this._formNode.getAttribute("method"),target:this._formNode.getAttribute("target")};this._formNode.setAttribute("action",E);this._formNode.setAttribute("method","POST");this._formNode.setAttribute("target",H);if(this._formNode.encoding){this._formNode.setAttribute("encoding",I);}else{this._formNode.setAttribute("enctype",I);}if(C){var L=this.appendPostData(C);}this._formNode.submit();this.startEvent.fire(D,J);if(D.startEvent){D.startEvent.fire(D,J);}if(M&&M.timeout){this._timeOut[D.tId]=window.setTimeout(function(){N.abort(D,M,true);},M.timeout);}if(L&&L.length>0){for(var G=0;G<L.length;G++){this._formNode.removeChild(L[G]);}}for(var A in B){if(YAHOO.lang.hasOwnProperty(B,A)){if(B[A]){this._formNode.setAttribute(A,B[A]);}else{this._formNode.removeAttribute(A);}}}this.resetFormState();var F=function(){if(M&&M.timeout){window.clearTimeout(N._timeOut[D.tId]);delete N._timeOut[D.tId];}N.completeEvent.fire(D,J);if(D.completeEvent){D.completeEvent.fire(D,J);}var P={};P.tId=D.tId;P.argument=M.argument;try{P.responseText=K.contentWindow.document.body?K.contentWindow.document.body.innerHTML:K.contentWindow.document.documentElement.textContent;P.responseXML=K.contentWindow.document.XMLDocument?K.contentWindow.document.XMLDocument:K.contentWindow.document;}catch(O){}if(M&&M.upload){if(!M.scope){M.upload(P);}else{M.upload.apply(M.scope,[P]);}}N.uploadEvent.fire(P);if(D.uploadEvent){D.uploadEvent.fire(P);}YAHOO.util.Event.removeListener(K,"load",F);setTimeout(function(){document.body.removeChild(K);N.releaseObject(D);},100);};YAHOO.util.Event.addListener(K,"load",F);},abort:function(E,G,A){var D;var B=(G&&G.argument)?G.argument:null;if(E&&E.conn){if(this.isCallInProgress(E)){E.conn.abort();window.clearInterval(this._poll[E.tId]);delete this._poll[E.tId];if(A){window.clearTimeout(this._timeOut[E.tId]);delete this._timeOut[E.tId];}D=true;}}else{if(E&&E.isUpload===true){var C="yuiIO"+E.tId;var F=document.getElementById(C);if(F){YAHOO.util.Event.removeListener(F,"load");document.body.removeChild(F);if(A){window.clearTimeout(this._timeOut[E.tId]);delete this._timeOut[E.tId];}D=true;}}else{D=false;}}if(D===true){this.abortEvent.fire(E,B);if(E.abortEvent){E.abortEvent.fire(E,B);}this.handleTransactionResponse(E,G,true);}return D;},isCallInProgress:function(B){if(B&&B.conn){return B.conn.readyState!==4&&B.conn.readyState!==0;}else{if(B&&B.isUpload===true){var A="yuiIO"+B.tId;return document.getElementById(A)?true:false;}else{return false;}}},releaseObject:function(A){if(A&&A.conn){A.conn=null;A=null;}}};YAHOO.register("connection",YAHOO.util.Connect,{version:"2.5.0",build:"895"});/*
Copyright (c) 2008, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.5.0
*/
(function(){var B=YAHOO.util;var A=function(D,C,E,F){if(!D){}this.init(D,C,E,F);};A.NAME="Anim";A.prototype={toString:function(){var C=this.getEl()||{};var D=C.id||C.tagName;return(this.constructor.NAME+": "+D);},patterns:{noNegatives:/width|height|opacity|padding/i,offsetAttribute:/^((width|height)|(top|left))$/,defaultUnit:/width|height|top$|bottom$|left$|right$/i,offsetUnit:/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i},doMethod:function(C,E,D){return this.method(this.currentFrame,E,D-E,this.totalFrames);},setAttribute:function(C,E,D){if(this.patterns.noNegatives.test(C)){E=(E>0)?E:0;}B.Dom.setStyle(this.getEl(),C,E+D);},getAttribute:function(C){var E=this.getEl();var G=B.Dom.getStyle(E,C);if(G!=="auto"&&!this.patterns.offsetUnit.test(G)){return parseFloat(G);}var D=this.patterns.offsetAttribute.exec(C)||[];var H=!!(D[3]);var F=!!(D[2]);if(F||(B.Dom.getStyle(E,"position")=="absolute"&&H)){G=E["offset"+D[0].charAt(0).toUpperCase()+D[0].substr(1)];}else{G=0;}return G;},getDefaultUnit:function(C){if(this.patterns.defaultUnit.test(C)){return"px";}return"";},setRuntimeAttribute:function(D){var I;var E;var F=this.attributes;this.runtimeAttributes[D]={};var H=function(J){return(typeof J!=="undefined");};if(!H(F[D]["to"])&&!H(F[D]["by"])){return false;}I=(H(F[D]["from"]))?F[D]["from"]:this.getAttribute(D);if(H(F[D]["to"])){E=F[D]["to"];}else{if(H(F[D]["by"])){if(I.constructor==Array){E=[];for(var G=0,C=I.length;G<C;++G){E[G]=I[G]+F[D]["by"][G]*1;}}else{E=I+F[D]["by"]*1;}}}this.runtimeAttributes[D].start=I;this.runtimeAttributes[D].end=E;this.runtimeAttributes[D].unit=(H(F[D].unit))?F[D]["unit"]:this.getDefaultUnit(D);return true;},init:function(E,J,I,C){var D=false;var F=null;var H=0;E=B.Dom.get(E);this.attributes=J||{};this.duration=!YAHOO.lang.isUndefined(I)?I:1;this.method=C||B.Easing.easeNone;this.useSeconds=true;this.currentFrame=0;this.totalFrames=B.AnimMgr.fps;this.setEl=function(M){E=B.Dom.get(M);};this.getEl=function(){return E;};this.isAnimated=function(){return D;};this.getStartTime=function(){return F;};this.runtimeAttributes={};this.animate=function(){if(this.isAnimated()){return false;}this.currentFrame=0;this.totalFrames=(this.useSeconds)?Math.ceil(B.AnimMgr.fps*this.duration):this.duration;if(this.duration===0&&this.useSeconds){this.totalFrames=1;}B.AnimMgr.registerElement(this);return true;};this.stop=function(M){if(!this.isAnimated()){return false;}if(M){this.currentFrame=this.totalFrames;this._onTween.fire();}B.AnimMgr.stop(this);};var L=function(){this.onStart.fire();this.runtimeAttributes={};for(var M in this.attributes){this.setRuntimeAttribute(M);}D=true;H=0;F=new Date();};var K=function(){var O={duration:new Date()-this.getStartTime(),currentFrame:this.currentFrame};O.toString=function(){return("duration: "+O.duration+", currentFrame: "+O.currentFrame);};this.onTween.fire(O);var N=this.runtimeAttributes;for(var M in N){this.setAttribute(M,this.doMethod(M,N[M].start,N[M].end),N[M].unit);}H+=1;};var G=function(){var M=(new Date()-F)/1000;var N={duration:M,frames:H,fps:H/M};N.toString=function(){return("duration: "+N.duration+", frames: "+N.frames+", fps: "+N.fps);};D=false;H=0;this.onComplete.fire(N);};this._onStart=new B.CustomEvent("_start",this,true);this.onStart=new B.CustomEvent("start",this);this.onTween=new B.CustomEvent("tween",this);this._onTween=new B.CustomEvent("_tween",this,true);this.onComplete=new B.CustomEvent("complete",this);this._onComplete=new B.CustomEvent("_complete",this,true);this._onStart.subscribe(L);this._onTween.subscribe(K);this._onComplete.subscribe(G);}};B.Anim=A;})();YAHOO.util.AnimMgr=new function(){var C=null;var B=[];var A=0;this.fps=1000;this.delay=1;this.registerElement=function(F){B[B.length]=F;A+=1;F._onStart.fire();this.start();};this.unRegister=function(G,F){F=F||E(G);if(!G.isAnimated()||F==-1){return false;}G._onComplete.fire();B.splice(F,1);A-=1;if(A<=0){this.stop();}return true;};this.start=function(){if(C===null){C=setInterval(this.run,this.delay);}};this.stop=function(H){if(!H){clearInterval(C);for(var G=0,F=B.length;G<F;++G){this.unRegister(B[0],0);}B=[];C=null;A=0;}else{this.unRegister(H);}};this.run=function(){for(var H=0,F=B.length;H<F;++H){var G=B[H];if(!G||!G.isAnimated()){continue;}if(G.currentFrame<G.totalFrames||G.totalFrames===null){G.currentFrame+=1;if(G.useSeconds){D(G);}G._onTween.fire();}else{YAHOO.util.AnimMgr.stop(G,H);}}};var E=function(H){for(var G=0,F=B.length;G<F;++G){if(B[G]==H){return G;}}return -1;};var D=function(G){var J=G.totalFrames;var I=G.currentFrame;var H=(G.currentFrame*G.duration*1000/G.totalFrames);var F=(new Date()-G.getStartTime());var K=0;if(F<G.duration*1000){K=Math.round((F/H-1)*G.currentFrame);}else{K=J-(I+1);}if(K>0&&isFinite(K)){if(G.currentFrame+K>=J){K=J-(I+1);}G.currentFrame+=K;}};};YAHOO.util.Bezier=new function(){this.getPosition=function(E,D){var F=E.length;var C=[];for(var B=0;B<F;++B){C[B]=[E[B][0],E[B][1]];}for(var A=1;A<F;++A){for(B=0;B<F-A;++B){C[B][0]=(1-D)*C[B][0]+D*C[parseInt(B+1,10)][0];C[B][1]=(1-D)*C[B][1]+D*C[parseInt(B+1,10)][1];}}return[C[0][0],C[0][1]];};};(function(){var A=function(F,E,G,H){A.superclass.constructor.call(this,F,E,G,H);};A.NAME="ColorAnim";var C=YAHOO.util;YAHOO.extend(A,C.Anim);var D=A.superclass;var B=A.prototype;B.patterns.color=/color$/i;B.patterns.rgb=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i;B.patterns.hex=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i;B.patterns.hex3=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i;B.patterns.transparent=/^transparent|rgba\(0, 0, 0, 0\)$/;B.parseColor=function(E){if(E.length==3){return E;}var F=this.patterns.hex.exec(E);if(F&&F.length==4){return[parseInt(F[1],16),parseInt(F[2],16),parseInt(F[3],16)];}F=this.patterns.rgb.exec(E);if(F&&F.length==4){return[parseInt(F[1],10),parseInt(F[2],10),parseInt(F[3],10)];}F=this.patterns.hex3.exec(E);if(F&&F.length==4){return[parseInt(F[1]+F[1],16),parseInt(F[2]+F[2],16),parseInt(F[3]+F[3],16)];}return null;};B.getAttribute=function(E){var G=this.getEl();if(this.patterns.color.test(E)){var H=YAHOO.util.Dom.getStyle(G,E);
if(this.patterns.transparent.test(H)){var F=G.parentNode;H=C.Dom.getStyle(F,E);while(F&&this.patterns.transparent.test(H)){F=F.parentNode;H=C.Dom.getStyle(F,E);if(F.tagName.toUpperCase()=="HTML"){H="#fff";}}}}else{H=D.getAttribute.call(this,E);}return H;};B.doMethod=function(F,J,G){var I;if(this.patterns.color.test(F)){I=[];for(var H=0,E=J.length;H<E;++H){I[H]=D.doMethod.call(this,F,J[H],G[H]);}I="rgb("+Math.floor(I[0])+","+Math.floor(I[1])+","+Math.floor(I[2])+")";}else{I=D.doMethod.call(this,F,J,G);}return I;};B.setRuntimeAttribute=function(F){D.setRuntimeAttribute.call(this,F);if(this.patterns.color.test(F)){var H=this.attributes;var J=this.parseColor(this.runtimeAttributes[F].start);var G=this.parseColor(this.runtimeAttributes[F].end);if(typeof H[F]["to"]==="undefined"&&typeof H[F]["by"]!=="undefined"){G=this.parseColor(H[F].by);for(var I=0,E=J.length;I<E;++I){G[I]=J[I]+G[I];}}this.runtimeAttributes[F].start=J;this.runtimeAttributes[F].end=G;}};C.ColorAnim=A;})();
/*
TERMS OF USE - EASING EQUATIONS
Open source under the BSD License.
Copyright 2001 Robert Penner All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * Neither the name of the author nor the names of contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
YAHOO.util.Easing={easeNone:function(B,A,D,C){return D*B/C+A;},easeIn:function(B,A,D,C){return D*(B/=C)*B+A;},easeOut:function(B,A,D,C){return -D*(B/=C)*(B-2)+A;},easeBoth:function(B,A,D,C){if((B/=C/2)<1){return D/2*B*B+A;}return -D/2*((--B)*(B-2)-1)+A;},easeInStrong:function(B,A,D,C){return D*(B/=C)*B*B*B+A;},easeOutStrong:function(B,A,D,C){return -D*((B=B/C-1)*B*B*B-1)+A;},easeBothStrong:function(B,A,D,C){if((B/=C/2)<1){return D/2*B*B*B*B+A;}return -D/2*((B-=2)*B*B*B-2)+A;},elasticIn:function(C,A,G,F,B,E){if(C==0){return A;}if((C/=F)==1){return A+G;}if(!E){E=F*0.3;}if(!B||B<Math.abs(G)){B=G;var D=E/4;}else{var D=E/(2*Math.PI)*Math.asin(G/B);}return -(B*Math.pow(2,10*(C-=1))*Math.sin((C*F-D)*(2*Math.PI)/E))+A;},elasticOut:function(C,A,G,F,B,E){if(C==0){return A;}if((C/=F)==1){return A+G;}if(!E){E=F*0.3;}if(!B||B<Math.abs(G)){B=G;var D=E/4;}else{var D=E/(2*Math.PI)*Math.asin(G/B);}return B*Math.pow(2,-10*C)*Math.sin((C*F-D)*(2*Math.PI)/E)+G+A;},elasticBoth:function(C,A,G,F,B,E){if(C==0){return A;}if((C/=F/2)==2){return A+G;}if(!E){E=F*(0.3*1.5);}if(!B||B<Math.abs(G)){B=G;var D=E/4;}else{var D=E/(2*Math.PI)*Math.asin(G/B);}if(C<1){return -0.5*(B*Math.pow(2,10*(C-=1))*Math.sin((C*F-D)*(2*Math.PI)/E))+A;}return B*Math.pow(2,-10*(C-=1))*Math.sin((C*F-D)*(2*Math.PI)/E)*0.5+G+A;},backIn:function(B,A,E,D,C){if(typeof C=="undefined"){C=1.70158;}return E*(B/=D)*B*((C+1)*B-C)+A;},backOut:function(B,A,E,D,C){if(typeof C=="undefined"){C=1.70158;}return E*((B=B/D-1)*B*((C+1)*B+C)+1)+A;},backBoth:function(B,A,E,D,C){if(typeof C=="undefined"){C=1.70158;}if((B/=D/2)<1){return E/2*(B*B*(((C*=(1.525))+1)*B-C))+A;}return E/2*((B-=2)*B*(((C*=(1.525))+1)*B+C)+2)+A;},bounceIn:function(B,A,D,C){return D-YAHOO.util.Easing.bounceOut(C-B,0,D,C)+A;},bounceOut:function(B,A,D,C){if((B/=C)<(1/2.75)){return D*(7.5625*B*B)+A;}else{if(B<(2/2.75)){return D*(7.5625*(B-=(1.5/2.75))*B+0.75)+A;}else{if(B<(2.5/2.75)){return D*(7.5625*(B-=(2.25/2.75))*B+0.9375)+A;}}}return D*(7.5625*(B-=(2.625/2.75))*B+0.984375)+A;},bounceBoth:function(B,A,D,C){if(B<C/2){return YAHOO.util.Easing.bounceIn(B*2,0,D,C)*0.5+A;}return YAHOO.util.Easing.bounceOut(B*2-C,0,D,C)*0.5+D*0.5+A;}};(function(){var A=function(H,G,I,J){if(H){A.superclass.constructor.call(this,H,G,I,J);}};A.NAME="Motion";var E=YAHOO.util;YAHOO.extend(A,E.ColorAnim);var F=A.superclass;var C=A.prototype;C.patterns.points=/^points$/i;C.setAttribute=function(G,I,H){if(this.patterns.points.test(G)){H=H||"px";F.setAttribute.call(this,"left",I[0],H);F.setAttribute.call(this,"top",I[1],H);}else{F.setAttribute.call(this,G,I,H);}};C.getAttribute=function(G){if(this.patterns.points.test(G)){var H=[F.getAttribute.call(this,"left"),F.getAttribute.call(this,"top")];}else{H=F.getAttribute.call(this,G);}return H;};C.doMethod=function(G,K,H){var J=null;if(this.patterns.points.test(G)){var I=this.method(this.currentFrame,0,100,this.totalFrames)/100;J=E.Bezier.getPosition(this.runtimeAttributes[G],I);}else{J=F.doMethod.call(this,G,K,H);}return J;};C.setRuntimeAttribute=function(P){if(this.patterns.points.test(P)){var H=this.getEl();var J=this.attributes;var G;var L=J["points"]["control"]||[];var I;var M,O;if(L.length>0&&!(L[0] instanceof Array)){L=[L];}else{var K=[];for(M=0,O=L.length;M<O;++M){K[M]=L[M];}L=K;}if(E.Dom.getStyle(H,"position")=="static"){E.Dom.setStyle(H,"position","relative");}if(D(J["points"]["from"])){E.Dom.setXY(H,J["points"]["from"]);}else{E.Dom.setXY(H,E.Dom.getXY(H));}G=this.getAttribute("points");if(D(J["points"]["to"])){I=B.call(this,J["points"]["to"],G);
var N=E.Dom.getXY(this.getEl());for(M=0,O=L.length;M<O;++M){L[M]=B.call(this,L[M],G);}}else{if(D(J["points"]["by"])){I=[G[0]+J["points"]["by"][0],G[1]+J["points"]["by"][1]];for(M=0,O=L.length;M<O;++M){L[M]=[G[0]+L[M][0],G[1]+L[M][1]];}}}this.runtimeAttributes[P]=[G];if(L.length>0){this.runtimeAttributes[P]=this.runtimeAttributes[P].concat(L);}this.runtimeAttributes[P][this.runtimeAttributes[P].length]=I;}else{F.setRuntimeAttribute.call(this,P);}};var B=function(G,I){var H=E.Dom.getXY(this.getEl());G=[G[0]-H[0]+I[0],G[1]-H[1]+I[1]];return G;};var D=function(G){return(typeof G!=="undefined");};E.Motion=A;})();(function(){var D=function(F,E,G,H){if(F){D.superclass.constructor.call(this,F,E,G,H);}};D.NAME="Scroll";var B=YAHOO.util;YAHOO.extend(D,B.ColorAnim);var C=D.superclass;var A=D.prototype;A.doMethod=function(E,H,F){var G=null;if(E=="scroll"){G=[this.method(this.currentFrame,H[0],F[0]-H[0],this.totalFrames),this.method(this.currentFrame,H[1],F[1]-H[1],this.totalFrames)];}else{G=C.doMethod.call(this,E,H,F);}return G;};A.getAttribute=function(E){var G=null;var F=this.getEl();if(E=="scroll"){G=[F.scrollLeft,F.scrollTop];}else{G=C.getAttribute.call(this,E);}return G;};A.setAttribute=function(E,H,G){var F=this.getEl();if(E=="scroll"){F.scrollLeft=H[0];F.scrollTop=H[1];}else{C.setAttribute.call(this,E,H,G);}};B.Scroll=D;})();YAHOO.register("animation",YAHOO.util.Anim,{version:"2.5.0",build:"895"});
/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
(function(){var lang=YAHOO.lang,util=YAHOO.util,Ev=util.Event;util.DataSourceBase=function(oLiveData,oConfigs){if(oLiveData===null||oLiveData===undefined){return;}this.liveData=oLiveData;this._oQueue={interval:null,conn:null,requests:[]};this.responseSchema={};if(oConfigs&&(oConfigs.constructor==Object)){for(var sConfig in oConfigs){if(sConfig){this[sConfig]=oConfigs[sConfig];}}}var maxCacheEntries=this.maxCacheEntries;if(!lang.isNumber(maxCacheEntries)||(maxCacheEntries<0)){maxCacheEntries=0;}this._aIntervals=[];this.createEvent("cacheRequestEvent");this.createEvent("cacheResponseEvent");this.createEvent("requestEvent");this.createEvent("responseEvent");this.createEvent("responseParseEvent");this.createEvent("responseCacheEvent");this.createEvent("dataErrorEvent");this.createEvent("cacheFlushEvent");var DS=util.DataSourceBase;this._sName="DataSource instance"+DS._nIndex;DS._nIndex++;};var DS=util.DataSourceBase;lang.augmentObject(DS,{TYPE_UNKNOWN:-1,TYPE_JSARRAY:0,TYPE_JSFUNCTION:1,TYPE_XHR:2,TYPE_JSON:3,TYPE_XML:4,TYPE_TEXT:5,TYPE_HTMLTABLE:6,TYPE_SCRIPTNODE:7,TYPE_LOCAL:8,ERROR_DATAINVALID:"Invalid data",ERROR_DATANULL:"Null data",_nIndex:0,_nTransactionId:0,issueCallback:function(callback,params,error,scope){if(lang.isFunction(callback)){callback.apply(scope,params);}else{if(lang.isObject(callback)){scope=callback.scope||scope||window;var callbackFunc=callback.success;if(error){callbackFunc=callback.failure;}if(callbackFunc){callbackFunc.apply(scope,params.concat([callback.argument]));}}}},parseString:function(oData){if(!lang.isValue(oData)){return null;}var string=oData+"";if(lang.isString(string)){return string;}else{return null;}},parseNumber:function(oData){if(!lang.isValue(oData)||(oData==="")){return null;}var number=oData*1;if(lang.isNumber(number)){return number;}else{return null;}},convertNumber:function(oData){return DS.parseNumber(oData);},parseDate:function(oData){var date=null;if(!(oData instanceof Date)){date=new Date(oData);}else{return oData;}if(date instanceof Date){return date;}else{return null;}},convertDate:function(oData){return DS.parseDate(oData);}});DS.Parser={string:DS.parseString,number:DS.parseNumber,date:DS.parseDate};DS.prototype={_sName:null,_aCache:null,_oQueue:null,_aIntervals:null,maxCacheEntries:0,liveData:null,dataType:DS.TYPE_UNKNOWN,responseType:DS.TYPE_UNKNOWN,responseSchema:null,toString:function(){return this._sName;},getCachedResponse:function(oRequest,oCallback,oCaller){var aCache=this._aCache;if(this.maxCacheEntries>0){if(!aCache){this._aCache=[];}else{var nCacheLength=aCache.length;if(nCacheLength>0){var oResponse=null;this.fireEvent("cacheRequestEvent",{request:oRequest,callback:oCallback,caller:oCaller});for(var i=nCacheLength-1;i>=0;i--){var oCacheElem=aCache[i];if(this.isCacheHit(oRequest,oCacheElem.request)){oResponse=oCacheElem.response;this.fireEvent("cacheResponseEvent",{request:oRequest,response:oResponse,callback:oCallback,caller:oCaller});if(i<nCacheLength-1){aCache.splice(i,1);this.addToCache(oRequest,oResponse);}oResponse.cached=true;break;}}return oResponse;}}}else{if(aCache){this._aCache=null;}}return null;},isCacheHit:function(oRequest,oCachedRequest){return(oRequest===oCachedRequest);},addToCache:function(oRequest,oResponse){var aCache=this._aCache;if(!aCache){return;}while(aCache.length>=this.maxCacheEntries){aCache.shift();}var oCacheElem={request:oRequest,response:oResponse};aCache[aCache.length]=oCacheElem;this.fireEvent("responseCacheEvent",{request:oRequest,response:oResponse});},flushCache:function(){if(this._aCache){this._aCache=[];this.fireEvent("cacheFlushEvent");}},setInterval:function(nMsec,oRequest,oCallback,oCaller){if(lang.isNumber(nMsec)&&(nMsec>=0)){var oSelf=this;var nId=setInterval(function(){oSelf.makeConnection(oRequest,oCallback,oCaller);},nMsec);this._aIntervals.push(nId);return nId;}else{}},clearInterval:function(nId){var tracker=this._aIntervals||[];for(var i=tracker.length-1;i>-1;i--){if(tracker[i]===nId){tracker.splice(i,1);clearInterval(nId);}}},clearAllIntervals:function(){var tracker=this._aIntervals||[];for(var i=tracker.length-1;i>-1;i--){clearInterval(tracker[i]);}tracker=[];},sendRequest:function(oRequest,oCallback,oCaller){var oCachedResponse=this.getCachedResponse(oRequest,oCallback,oCaller);if(oCachedResponse){DS.issueCallback(oCallback,[oRequest,oCachedResponse],false,oCaller);return null;}return this.makeConnection(oRequest,oCallback,oCaller);},makeConnection:function(oRequest,oCallback,oCaller){var tId=DS._nTransactionId++;this.fireEvent("requestEvent",{tId:tId,request:oRequest,callback:oCallback,caller:oCaller});var oRawResponse=this.liveData;this.handleResponse(oRequest,oRawResponse,oCallback,oCaller,tId);return tId;},handleResponse:function(oRequest,oRawResponse,oCallback,oCaller,tId){this.fireEvent("responseEvent",{tId:tId,request:oRequest,response:oRawResponse,callback:oCallback,caller:oCaller});var xhr=(this.dataType==DS.TYPE_XHR)?true:false;var oParsedResponse=null;var oFullResponse=oRawResponse;if(this.responseType===DS.TYPE_UNKNOWN){var ctype=(oRawResponse&&oRawResponse.getResponseHeader)?oRawResponse.getResponseHeader["Content-Type"]:null;if(ctype){if(ctype.indexOf("text/xml")>-1){this.responseType=DS.TYPE_XML;}else{if(ctype.indexOf("application/json")>-1){this.responseType=DS.TYPE_JSON;}else{if(ctype.indexOf("text/plain")>-1){this.responseType=DS.TYPE_TEXT;}}}}else{if(YAHOO.lang.isArray(oRawResponse)){this.responseType=DS.TYPE_JSARRAY;}else{if(oRawResponse&&oRawResponse.nodeType&&oRawResponse.nodeType==9){this.responseType=DS.TYPE_XML;}else{if(oRawResponse&&oRawResponse.nodeName&&(oRawResponse.nodeName.toLowerCase()=="table")){this.responseType=DS.TYPE_HTMLTABLE;}else{if(YAHOO.lang.isObject(oRawResponse)){this.responseType=DS.TYPE_JSON;}else{if(YAHOO.lang.isString(oRawResponse)){this.responseType=DS.TYPE_TEXT;}}}}}}}switch(this.responseType){case DS.TYPE_JSARRAY:if(xhr&&oRawResponse&&oRawResponse.responseText){oFullResponse=oRawResponse.responseText;}try{if(lang.isString(oFullResponse)){var parseArgs=[oFullResponse].concat(this.parseJSONArgs);
if(lang.JSON){oFullResponse=lang.JSON.parse.apply(lang.JSON,parseArgs);}else{if(window.JSON&&JSON.parse){oFullResponse=JSON.parse.apply(JSON,parseArgs);}else{if(oFullResponse.parseJSON){oFullResponse=oFullResponse.parseJSON.apply(oFullResponse,parseArgs.slice(1));}else{while(oFullResponse.length>0&&(oFullResponse.charAt(0)!="{")&&(oFullResponse.charAt(0)!="[")){oFullResponse=oFullResponse.substring(1,oFullResponse.length);}if(oFullResponse.length>0){var arrayEnd=Math.max(oFullResponse.lastIndexOf("]"),oFullResponse.lastIndexOf("}"));oFullResponse=oFullResponse.substring(0,arrayEnd+1);oFullResponse=eval("("+oFullResponse+")");}}}}}}catch(e1){}oFullResponse=this.doBeforeParseData(oRequest,oFullResponse,oCallback);oParsedResponse=this.parseArrayData(oRequest,oFullResponse);break;case DS.TYPE_JSON:if(xhr&&oRawResponse&&oRawResponse.responseText){oFullResponse=oRawResponse.responseText;}try{if(lang.isString(oFullResponse)){var parseArgs=[oFullResponse].concat(this.parseJSONArgs);if(lang.JSON){oFullResponse=lang.JSON.parse.apply(lang.JSON,parseArgs);}else{if(window.JSON&&JSON.parse){oFullResponse=JSON.parse.apply(JSON,parseArgs);}else{if(oFullResponse.parseJSON){oFullResponse=oFullResponse.parseJSON.apply(oFullResponse,parseArgs.slice(1));}else{while(oFullResponse.length>0&&(oFullResponse.charAt(0)!="{")&&(oFullResponse.charAt(0)!="[")){oFullResponse=oFullResponse.substring(1,oFullResponse.length);}if(oFullResponse.length>0){var objEnd=Math.max(oFullResponse.lastIndexOf("]"),oFullResponse.lastIndexOf("}"));oFullResponse=oFullResponse.substring(0,objEnd+1);oFullResponse=eval("("+oFullResponse+")");}}}}}}catch(e){}oFullResponse=this.doBeforeParseData(oRequest,oFullResponse,oCallback);oParsedResponse=this.parseJSONData(oRequest,oFullResponse);break;case DS.TYPE_HTMLTABLE:if(xhr&&oRawResponse.responseText){var el=document.createElement("div");el.innerHTML=oRawResponse.responseText;oFullResponse=el.getElementsByTagName("table")[0];}oFullResponse=this.doBeforeParseData(oRequest,oFullResponse,oCallback);oParsedResponse=this.parseHTMLTableData(oRequest,oFullResponse);break;case DS.TYPE_XML:if(xhr&&oRawResponse.responseXML){oFullResponse=oRawResponse.responseXML;}oFullResponse=this.doBeforeParseData(oRequest,oFullResponse,oCallback);oParsedResponse=this.parseXMLData(oRequest,oFullResponse);break;case DS.TYPE_TEXT:if(xhr&&lang.isString(oRawResponse.responseText)){oFullResponse=oRawResponse.responseText;}oFullResponse=this.doBeforeParseData(oRequest,oFullResponse,oCallback);oParsedResponse=this.parseTextData(oRequest,oFullResponse);break;default:oFullResponse=this.doBeforeParseData(oRequest,oFullResponse,oCallback);oParsedResponse=this.parseData(oRequest,oFullResponse);break;}oParsedResponse=oParsedResponse||{};if(!oParsedResponse.results){oParsedResponse.results=[];}if(!oParsedResponse.meta){oParsedResponse.meta={};}if(oParsedResponse&&!oParsedResponse.error){oParsedResponse=this.doBeforeCallback(oRequest,oFullResponse,oParsedResponse,oCallback);this.fireEvent("responseParseEvent",{request:oRequest,response:oParsedResponse,callback:oCallback,caller:oCaller});this.addToCache(oRequest,oParsedResponse);}else{oParsedResponse.error=true;this.fireEvent("dataErrorEvent",{request:oRequest,response:oRawResponse,callback:oCallback,caller:oCaller,message:DS.ERROR_DATANULL});}oParsedResponse.tId=tId;DS.issueCallback(oCallback,[oRequest,oParsedResponse],oParsedResponse.error,oCaller);},doBeforeParseData:function(oRequest,oFullResponse,oCallback){return oFullResponse;},doBeforeCallback:function(oRequest,oFullResponse,oParsedResponse,oCallback){return oParsedResponse;},parseData:function(oRequest,oFullResponse){if(lang.isValue(oFullResponse)){var oParsedResponse={results:oFullResponse,meta:{}};return oParsedResponse;}return null;},parseArrayData:function(oRequest,oFullResponse){if(lang.isArray(oFullResponse)){var results=[],i,j,rec,field,data;if(lang.isArray(this.responseSchema.fields)){var fields=this.responseSchema.fields;for(i=fields.length-1;i>=0;--i){if(typeof fields[i]!=="object"){fields[i]={key:fields[i]};}}var parsers={},p;for(i=fields.length-1;i>=0;--i){p=(typeof fields[i].parser==="function"?fields[i].parser:DS.Parser[fields[i].parser+""])||fields[i].converter;if(p){parsers[fields[i].key]=p;}}var arrType=lang.isArray(oFullResponse[0]);for(i=oFullResponse.length-1;i>-1;i--){var oResult={};rec=oFullResponse[i];if(typeof rec==="object"){for(j=fields.length-1;j>-1;j--){field=fields[j];data=arrType?rec[j]:rec[field.key];if(parsers[field.key]){data=parsers[field.key].call(this,data);}if(data===undefined){data=null;}oResult[field.key]=data;}}else{if(lang.isString(rec)){for(j=fields.length-1;j>-1;j--){field=fields[j];data=rec;if(parsers[field.key]){data=parsers[field.key].call(this,data);}if(data===undefined){data=null;}oResult[field.key]=data;}}}results[i]=oResult;}}else{results=oFullResponse;}var oParsedResponse={results:results};return oParsedResponse;}return null;},parseTextData:function(oRequest,oFullResponse){if(lang.isString(oFullResponse)){if(lang.isString(this.responseSchema.recordDelim)&&lang.isString(this.responseSchema.fieldDelim)){var oParsedResponse={results:[]};var recDelim=this.responseSchema.recordDelim;var fieldDelim=this.responseSchema.fieldDelim;if(oFullResponse.length>0){var newLength=oFullResponse.length-recDelim.length;if(oFullResponse.substr(newLength)==recDelim){oFullResponse=oFullResponse.substr(0,newLength);}if(oFullResponse.length>0){var recordsarray=oFullResponse.split(recDelim);for(var i=0,len=recordsarray.length,recIdx=0;i<len;++i){var bError=false,sRecord=recordsarray[i];if(lang.isString(sRecord)&&(sRecord.length>0)){var fielddataarray=recordsarray[i].split(fieldDelim);var oResult={};if(lang.isArray(this.responseSchema.fields)){var fields=this.responseSchema.fields;for(var j=fields.length-1;j>-1;j--){try{var data=fielddataarray[j];if(lang.isString(data)){if(data.charAt(0)=='"'){data=data.substr(1);}if(data.charAt(data.length-1)=='"'){data=data.substr(0,data.length-1);}var field=fields[j];
var key=(lang.isValue(field.key))?field.key:field;if(!field.parser&&field.converter){field.parser=field.converter;}var parser=(typeof field.parser==="function")?field.parser:DS.Parser[field.parser+""];if(parser){data=parser.call(this,data);}if(data===undefined){data=null;}oResult[key]=data;}else{bError=true;}}catch(e){bError=true;}}}else{oResult=fielddataarray;}if(!bError){oParsedResponse.results[recIdx++]=oResult;}}}}}return oParsedResponse;}}return null;},parseXMLResult:function(result){var oResult={},schema=this.responseSchema;try{for(var m=schema.fields.length-1;m>=0;m--){var field=schema.fields[m];var key=(lang.isValue(field.key))?field.key:field;var data=null;var xmlAttr=result.attributes.getNamedItem(key);if(xmlAttr){data=xmlAttr.value;}else{var xmlNode=result.getElementsByTagName(key);if(xmlNode&&xmlNode.item(0)){var item=xmlNode.item(0);data=(item)?((item.text)?item.text:(item.textContent)?item.textContent:null):null;if(!data){var datapieces=[];for(var j=0,len=item.childNodes.length;j<len;j++){if(item.childNodes[j].nodeValue){datapieces[datapieces.length]=item.childNodes[j].nodeValue;}}if(datapieces.length>0){data=datapieces.join("");}}}}if(data===null){data="";}if(!field.parser&&field.converter){field.parser=field.converter;}var parser=(typeof field.parser==="function")?field.parser:DS.Parser[field.parser+""];if(parser){data=parser.call(this,data);}if(data===undefined){data=null;}oResult[key]=data;}}catch(e){}return oResult;},parseXMLData:function(oRequest,oFullResponse){var bError=false,schema=this.responseSchema,oParsedResponse={meta:{}},xmlList=null,metaNode=schema.metaNode,metaLocators=schema.metaFields||{},i,k,loc,v;try{xmlList=(schema.resultNode)?oFullResponse.getElementsByTagName(schema.resultNode):null;metaNode=metaNode?oFullResponse.getElementsByTagName(metaNode)[0]:oFullResponse;if(metaNode){for(k in metaLocators){if(lang.hasOwnProperty(metaLocators,k)){loc=metaLocators[k];v=metaNode.getElementsByTagName(loc)[0];if(v){v=v.firstChild.nodeValue;}else{v=metaNode.attributes.getNamedItem(loc);if(v){v=v.value;}}if(lang.isValue(v)){oParsedResponse.meta[k]=v;}}}}}catch(e){}if(!xmlList||!lang.isArray(schema.fields)){bError=true;}else{oParsedResponse.results=[];for(i=xmlList.length-1;i>=0;--i){var oResult=this.parseXMLResult(xmlList.item(i));oParsedResponse.results[i]=oResult;}}if(bError){oParsedResponse.error=true;}else{}return oParsedResponse;},parseJSONData:function(oRequest,oFullResponse){var oParsedResponse={results:[],meta:{}};if(lang.isObject(oFullResponse)&&this.responseSchema.resultsList){var schema=this.responseSchema,fields=schema.fields,resultsList=oFullResponse,results=[],metaFields=schema.metaFields||{},fieldParsers=[],fieldPaths=[],simpleFields=[],bError=false,i,len,j,v,key,parser,path;var buildPath=function(needle){var path=null,keys=[],i=0;if(needle){needle=needle.replace(/\[(['"])(.*?)\1\]/g,function(x,$1,$2){keys[i]=$2;return".@"+(i++);}).replace(/\[(\d+)\]/g,function(x,$1){keys[i]=parseInt($1,10)|0;return".@"+(i++);}).replace(/^\./,"");if(!/[^\w\.\$@]/.test(needle)){path=needle.split(".");for(i=path.length-1;i>=0;--i){if(path[i].charAt(0)==="@"){path[i]=keys[parseInt(path[i].substr(1),10)];}}}else{}}return path;};var walkPath=function(path,origin){var v=origin,i=0,len=path.length;for(;i<len&&v;++i){v=v[path[i]];}return v;};path=buildPath(schema.resultsList);if(path){resultsList=walkPath(path,oFullResponse);if(resultsList===undefined){bError=true;}}else{bError=true;}if(!resultsList){resultsList=[];}if(!lang.isArray(resultsList)){resultsList=[resultsList];}if(!bError){if(schema.fields){var field;for(i=0,len=fields.length;i<len;i++){field=fields[i];key=field.key||field;parser=((typeof field.parser==="function")?field.parser:DS.Parser[field.parser+""])||field.converter;path=buildPath(key);if(parser){fieldParsers[fieldParsers.length]={key:key,parser:parser};}if(path){if(path.length>1){fieldPaths[fieldPaths.length]={key:key,path:path};}else{simpleFields[simpleFields.length]={key:key,path:path[0]};}}else{}}for(i=resultsList.length-1;i>=0;--i){var r=resultsList[i],rec={};if(r){for(j=simpleFields.length-1;j>=0;--j){rec[simpleFields[j].key]=(r[simpleFields[j].path]!==undefined)?r[simpleFields[j].path]:r[j];}for(j=fieldPaths.length-1;j>=0;--j){rec[fieldPaths[j].key]=walkPath(fieldPaths[j].path,r);}for(j=fieldParsers.length-1;j>=0;--j){var p=fieldParsers[j].key;rec[p]=fieldParsers[j].parser(rec[p]);if(rec[p]===undefined){rec[p]=null;}}}results[i]=rec;}}else{results=resultsList;}for(key in metaFields){if(lang.hasOwnProperty(metaFields,key)){path=buildPath(metaFields[key]);if(path){v=walkPath(path,oFullResponse);oParsedResponse.meta[key]=v;}}}}else{oParsedResponse.error=true;}oParsedResponse.results=results;}else{oParsedResponse.error=true;}return oParsedResponse;},parseHTMLTableData:function(oRequest,oFullResponse){var bError=false;var elTable=oFullResponse;var fields=this.responseSchema.fields;var oParsedResponse={results:[]};if(lang.isArray(fields)){for(var i=0;i<elTable.tBodies.length;i++){var elTbody=elTable.tBodies[i];for(var j=elTbody.rows.length-1;j>-1;j--){var elRow=elTbody.rows[j];var oResult={};for(var k=fields.length-1;k>-1;k--){var field=fields[k];var key=(lang.isValue(field.key))?field.key:field;var data=elRow.cells[k].innerHTML;if(!field.parser&&field.converter){field.parser=field.converter;}var parser=(typeof field.parser==="function")?field.parser:DS.Parser[field.parser+""];if(parser){data=parser.call(this,data);}if(data===undefined){data=null;}oResult[key]=data;}oParsedResponse.results[j]=oResult;}}}else{bError=true;}if(bError){oParsedResponse.error=true;}else{}return oParsedResponse;}};lang.augmentProto(DS,util.EventProvider);util.LocalDataSource=function(oLiveData,oConfigs){this.dataType=DS.TYPE_LOCAL;if(oLiveData){if(YAHOO.lang.isArray(oLiveData)){this.responseType=DS.TYPE_JSARRAY;}else{if(oLiveData.nodeType&&oLiveData.nodeType==9){this.responseType=DS.TYPE_XML;}else{if(oLiveData.nodeName&&(oLiveData.nodeName.toLowerCase()=="table")){this.responseType=DS.TYPE_HTMLTABLE;
oLiveData=oLiveData.cloneNode(true);}else{if(YAHOO.lang.isString(oLiveData)){this.responseType=DS.TYPE_TEXT;}else{if(YAHOO.lang.isObject(oLiveData)){this.responseType=DS.TYPE_JSON;}}}}}}else{oLiveData=[];this.responseType=DS.TYPE_JSARRAY;}util.LocalDataSource.superclass.constructor.call(this,oLiveData,oConfigs);};lang.extend(util.LocalDataSource,DS);lang.augmentObject(util.LocalDataSource,DS);util.FunctionDataSource=function(oLiveData,oConfigs){this.dataType=DS.TYPE_JSFUNCTION;oLiveData=oLiveData||function(){};util.FunctionDataSource.superclass.constructor.call(this,oLiveData,oConfigs);};lang.extend(util.FunctionDataSource,DS,{scope:null,makeConnection:function(oRequest,oCallback,oCaller){var tId=DS._nTransactionId++;this.fireEvent("requestEvent",{tId:tId,request:oRequest,callback:oCallback,caller:oCaller});var oRawResponse=(this.scope)?this.liveData.call(this.scope,oRequest,this):this.liveData(oRequest);if(this.responseType===DS.TYPE_UNKNOWN){if(YAHOO.lang.isArray(oRawResponse)){this.responseType=DS.TYPE_JSARRAY;}else{if(oRawResponse&&oRawResponse.nodeType&&oRawResponse.nodeType==9){this.responseType=DS.TYPE_XML;}else{if(oRawResponse&&oRawResponse.nodeName&&(oRawResponse.nodeName.toLowerCase()=="table")){this.responseType=DS.TYPE_HTMLTABLE;}else{if(YAHOO.lang.isObject(oRawResponse)){this.responseType=DS.TYPE_JSON;}else{if(YAHOO.lang.isString(oRawResponse)){this.responseType=DS.TYPE_TEXT;}}}}}}this.handleResponse(oRequest,oRawResponse,oCallback,oCaller,tId);return tId;}});lang.augmentObject(util.FunctionDataSource,DS);util.ScriptNodeDataSource=function(oLiveData,oConfigs){this.dataType=DS.TYPE_SCRIPTNODE;oLiveData=oLiveData||"";util.ScriptNodeDataSource.superclass.constructor.call(this,oLiveData,oConfigs);};lang.extend(util.ScriptNodeDataSource,DS,{getUtility:util.Get,asyncMode:"allowAll",scriptCallbackParam:"callback",generateRequestCallback:function(id){return"&"+this.scriptCallbackParam+"=YAHOO.util.ScriptNodeDataSource.callbacks["+id+"]";},doBeforeGetScriptNode:function(sUri){return sUri;},makeConnection:function(oRequest,oCallback,oCaller){var tId=DS._nTransactionId++;this.fireEvent("requestEvent",{tId:tId,request:oRequest,callback:oCallback,caller:oCaller});if(util.ScriptNodeDataSource._nPending===0){util.ScriptNodeDataSource.callbacks=[];util.ScriptNodeDataSource._nId=0;}var id=util.ScriptNodeDataSource._nId;util.ScriptNodeDataSource._nId++;var oSelf=this;util.ScriptNodeDataSource.callbacks[id]=function(oRawResponse){if((oSelf.asyncMode!=="ignoreStaleResponses")||(id===util.ScriptNodeDataSource.callbacks.length-1)){if(oSelf.responseType===DS.TYPE_UNKNOWN){if(YAHOO.lang.isArray(oRawResponse)){oSelf.responseType=DS.TYPE_JSARRAY;}else{if(oRawResponse.nodeType&&oRawResponse.nodeType==9){oSelf.responseType=DS.TYPE_XML;}else{if(oRawResponse.nodeName&&(oRawResponse.nodeName.toLowerCase()=="table")){oSelf.responseType=DS.TYPE_HTMLTABLE;}else{if(YAHOO.lang.isObject(oRawResponse)){oSelf.responseType=DS.TYPE_JSON;}else{if(YAHOO.lang.isString(oRawResponse)){oSelf.responseType=DS.TYPE_TEXT;}}}}}}oSelf.handleResponse(oRequest,oRawResponse,oCallback,oCaller,tId);}else{}delete util.ScriptNodeDataSource.callbacks[id];};util.ScriptNodeDataSource._nPending++;var sUri=this.liveData+oRequest+this.generateRequestCallback(id);sUri=this.doBeforeGetScriptNode(sUri);this.getUtility.script(sUri,{autopurge:true,onsuccess:util.ScriptNodeDataSource._bumpPendingDown,onfail:util.ScriptNodeDataSource._bumpPendingDown});return tId;}});lang.augmentObject(util.ScriptNodeDataSource,DS);lang.augmentObject(util.ScriptNodeDataSource,{_nId:0,_nPending:0,callbacks:[]});util.XHRDataSource=function(oLiveData,oConfigs){this.dataType=DS.TYPE_XHR;this.connMgr=this.connMgr||util.Connect;oLiveData=oLiveData||"";util.XHRDataSource.superclass.constructor.call(this,oLiveData,oConfigs);};lang.extend(util.XHRDataSource,DS,{connMgr:null,connXhrMode:"allowAll",connMethodPost:false,connTimeout:0,makeConnection:function(oRequest,oCallback,oCaller){var oRawResponse=null;var tId=DS._nTransactionId++;this.fireEvent("requestEvent",{tId:tId,request:oRequest,callback:oCallback,caller:oCaller});var oSelf=this;var oConnMgr=this.connMgr;var oQueue=this._oQueue;var _xhrSuccess=function(oResponse){if(oResponse&&(this.connXhrMode=="ignoreStaleResponses")&&(oResponse.tId!=oQueue.conn.tId)){return null;}else{if(!oResponse){this.fireEvent("dataErrorEvent",{request:oRequest,callback:oCallback,caller:oCaller,message:DS.ERROR_DATANULL});DS.issueCallback(oCallback,[oRequest,{error:true}],true,oCaller);return null;}else{if(this.responseType===DS.TYPE_UNKNOWN){var ctype=(oResponse.getResponseHeader)?oResponse.getResponseHeader["Content-Type"]:null;if(ctype){if(ctype.indexOf("text/xml")>-1){this.responseType=DS.TYPE_XML;}else{if(ctype.indexOf("application/json")>-1){this.responseType=DS.TYPE_JSON;}else{if(ctype.indexOf("text/plain")>-1){this.responseType=DS.TYPE_TEXT;}}}}}this.handleResponse(oRequest,oResponse,oCallback,oCaller,tId);}}};var _xhrFailure=function(oResponse){this.fireEvent("dataErrorEvent",{request:oRequest,callback:oCallback,caller:oCaller,message:DS.ERROR_DATAINVALID});if(lang.isString(this.liveData)&&lang.isString(oRequest)&&(this.liveData.lastIndexOf("?")!==this.liveData.length-1)&&(oRequest.indexOf("?")!==0)){}oResponse=oResponse||{};oResponse.error=true;DS.issueCallback(oCallback,[oRequest,oResponse],true,oCaller);return null;};var _xhrCallback={success:_xhrSuccess,failure:_xhrFailure,scope:this};if(lang.isNumber(this.connTimeout)){_xhrCallback.timeout=this.connTimeout;}if(this.connXhrMode=="cancelStaleRequests"){if(oQueue.conn){if(oConnMgr.abort){oConnMgr.abort(oQueue.conn);oQueue.conn=null;}else{}}}if(oConnMgr&&oConnMgr.asyncRequest){var sLiveData=this.liveData;var isPost=this.connMethodPost;var sMethod=(isPost)?"POST":"GET";var sUri=(isPost||!lang.isValue(oRequest))?sLiveData:sLiveData+oRequest;var sRequest=(isPost)?oRequest:null;if(this.connXhrMode!="queueRequests"){oQueue.conn=oConnMgr.asyncRequest(sMethod,sUri,_xhrCallback,sRequest);}else{if(oQueue.conn){var allRequests=oQueue.requests;
allRequests.push({request:oRequest,callback:_xhrCallback});if(!oQueue.interval){oQueue.interval=setInterval(function(){if(oConnMgr.isCallInProgress(oQueue.conn)){return;}else{if(allRequests.length>0){sUri=(isPost||!lang.isValue(allRequests[0].request))?sLiveData:sLiveData+allRequests[0].request;sRequest=(isPost)?allRequests[0].request:null;oQueue.conn=oConnMgr.asyncRequest(sMethod,sUri,allRequests[0].callback,sRequest);allRequests.shift();}else{clearInterval(oQueue.interval);oQueue.interval=null;}}},50);}}else{oQueue.conn=oConnMgr.asyncRequest(sMethod,sUri,_xhrCallback,sRequest);}}}else{DS.issueCallback(oCallback,[oRequest,{error:true}],true,oCaller);}return tId;}});lang.augmentObject(util.XHRDataSource,DS);util.DataSource=function(oLiveData,oConfigs){oConfigs=oConfigs||{};var dataType=oConfigs.dataType;if(dataType){if(dataType==DS.TYPE_LOCAL){lang.augmentObject(util.DataSource,util.LocalDataSource);return new util.LocalDataSource(oLiveData,oConfigs);}else{if(dataType==DS.TYPE_XHR){lang.augmentObject(util.DataSource,util.XHRDataSource);return new util.XHRDataSource(oLiveData,oConfigs);}else{if(dataType==DS.TYPE_SCRIPTNODE){lang.augmentObject(util.DataSource,util.ScriptNodeDataSource);return new util.ScriptNodeDataSource(oLiveData,oConfigs);}else{if(dataType==DS.TYPE_JSFUNCTION){lang.augmentObject(util.DataSource,util.FunctionDataSource);return new util.FunctionDataSource(oLiveData,oConfigs);}}}}}if(YAHOO.lang.isString(oLiveData)){lang.augmentObject(util.DataSource,util.XHRDataSource);return new util.XHRDataSource(oLiveData,oConfigs);}else{if(YAHOO.lang.isFunction(oLiveData)){lang.augmentObject(util.DataSource,util.FunctionDataSource);return new util.FunctionDataSource(oLiveData,oConfigs);}else{lang.augmentObject(util.DataSource,util.LocalDataSource);return new util.LocalDataSource(oLiveData,oConfigs);}}};lang.augmentObject(util.DataSource,DS);})();YAHOO.util.Number={format:function(C,G){var B=YAHOO.lang;if(!B.isValue(C)||(C==="")){return"";}G=G||{};if(!B.isNumber(C)){C*=1;}if(B.isNumber(C)){var E=(C<0);var K=C+"";var H=(G.decimalSeparator)?G.decimalSeparator:".";var I;if(B.isNumber(G.decimalPlaces)){var J=G.decimalPlaces;var D=Math.pow(10,J);K=Math.round(C*D)/D+"";I=K.lastIndexOf(".");if(J>0){if(I<0){K+=H;I=K.length-1;}else{if(H!=="."){K=K.replace(".",H);}}while((K.length-1-I)<J){K+="0";}}}if(G.thousandsSeparator){var M=G.thousandsSeparator;I=K.lastIndexOf(H);I=(I>-1)?I:K.length;var L=K.substring(I);var A=-1;for(var F=I;F>0;F--){A++;if((A%3===0)&&(F!==I)&&(!E||(F>1))){L=M+L;}L=K.charAt(F-1)+L;}K=L;}K=(G.prefix)?G.prefix+K:K;K=(G.suffix)?K+G.suffix:K;return K;}else{return C;}}};(function(){var A=function(C,E,D){if(typeof D==="undefined"){D=10;}for(;parseInt(C,10)<D&&D>1;D/=10){C=E.toString()+C;}return C.toString();};var B={formats:{a:function(D,C){return C.a[D.getDay()];},A:function(D,C){return C.A[D.getDay()];},b:function(D,C){return C.b[D.getMonth()];},B:function(D,C){return C.B[D.getMonth()];},C:function(C){return A(parseInt(C.getFullYear()/100,10),0);},d:["getDate","0"],e:["getDate"," "],g:function(C){return A(parseInt(B.formats.G(C)%100,10),0);},G:function(E){var F=E.getFullYear();var D=parseInt(B.formats.V(E),10);var C=parseInt(B.formats.W(E),10);if(C>D){F++;}else{if(C===0&&D>=52){F--;}}return F;},H:["getHours","0"],I:function(D){var C=D.getHours()%12;return A(C===0?12:C,0);},j:function(G){var F=new Date(""+G.getFullYear()+"/1/1 GMT");var D=new Date(""+G.getFullYear()+"/"+(G.getMonth()+1)+"/"+G.getDate()+" GMT");var C=D-F;var E=parseInt(C/60000/60/24,10)+1;return A(E,0,100);},k:["getHours"," "],l:function(D){var C=D.getHours()%12;return A(C===0?12:C," ");},m:function(C){return A(C.getMonth()+1,0);},M:["getMinutes","0"],p:function(D,C){return C.p[D.getHours()>=12?1:0];},P:function(D,C){return C.P[D.getHours()>=12?1:0];},s:function(D,C){return parseInt(D.getTime()/1000,10);},S:["getSeconds","0"],u:function(C){var D=C.getDay();return D===0?7:D;},U:function(F){var C=parseInt(B.formats.j(F),10);var E=6-F.getDay();var D=parseInt((C+E)/7,10);return A(D,0);},V:function(F){var E=parseInt(B.formats.W(F),10);var C=(new Date(""+F.getFullYear()+"/1/1")).getDay();var D=E+(C>4||C<=1?0:1);if(D===53&&(new Date(""+F.getFullYear()+"/12/31")).getDay()<4){D=1;}else{if(D===0){D=B.formats.V(new Date(""+(F.getFullYear()-1)+"/12/31"));}}return A(D,0);},w:"getDay",W:function(F){var C=parseInt(B.formats.j(F),10);var E=7-B.formats.u(F);var D=parseInt((C+E)/7,10);return A(D,0,10);},y:function(C){return A(C.getFullYear()%100,0);},Y:"getFullYear",z:function(E){var D=E.getTimezoneOffset();var C=A(parseInt(Math.abs(D/60),10),0);var F=A(Math.abs(D%60),0);return(D>0?"-":"+")+C+F;},Z:function(C){var D=C.toString().replace(/^.*:\d\d( GMT[+-]\d+)? \(?([A-Za-z ]+)\)?\d*$/,"$2").replace(/[a-z ]/g,"");if(D.length>4){D=B.formats.z(C);}return D;},"%":function(C){return"%";}},aggregates:{c:"locale",D:"%m/%d/%y",F:"%Y-%m-%d",h:"%b",n:"\n",r:"locale",R:"%H:%M",t:"\t",T:"%H:%M:%S",x:"locale",X:"locale"},format:function(G,F,D){F=F||{};if(!(G instanceof Date)){return YAHOO.lang.isValue(G)?G:"";}var H=F.format||"%m/%d/%Y";if(H==="YYYY/MM/DD"){H="%Y/%m/%d";}else{if(H==="DD/MM/YYYY"){H="%d/%m/%Y";}else{if(H==="MM/DD/YYYY"){H="%m/%d/%Y";}}}D=D||"en";if(!(D in YAHOO.util.DateLocale)){if(D.replace(/-[a-zA-Z]+$/,"") in YAHOO.util.DateLocale){D=D.replace(/-[a-zA-Z]+$/,"");}else{D="en";}}var J=YAHOO.util.DateLocale[D];var C=function(L,K){var M=B.aggregates[K];return(M==="locale"?J[K]:M);};var E=function(L,K){var M=B.formats[K];if(typeof M==="string"){return G[M]();}else{if(typeof M==="function"){return M.call(G,G,J);}else{if(typeof M==="object"&&typeof M[0]==="string"){return A(G[M[0]](),M[1]);}else{return K;}}}};while(H.match(/%[cDFhnrRtTxX]/)){H=H.replace(/%([cDFhnrRtTxX])/g,C);}var I=H.replace(/%([aAbBCdegGHIjklmMpPsSuUVwWyYzZ%])/g,E);C=E=undefined;return I;}};YAHOO.namespace("YAHOO.util");YAHOO.util.Date=B;YAHOO.util.DateLocale={a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a %d %b %Y %T %Z",p:["AM","PM"],P:["am","pm"],r:"%I:%M:%S %p",x:"%d/%m/%y",X:"%T"};
YAHOO.util.DateLocale["en"]=YAHOO.lang.merge(YAHOO.util.DateLocale,{});YAHOO.util.DateLocale["en-US"]=YAHOO.lang.merge(YAHOO.util.DateLocale["en"],{c:"%a %d %b %Y %I:%M:%S %p %Z",x:"%m/%d/%Y",X:"%I:%M:%S %p"});YAHOO.util.DateLocale["en-GB"]=YAHOO.lang.merge(YAHOO.util.DateLocale["en"],{r:"%l:%M:%S %P %Z"});YAHOO.util.DateLocale["en-AU"]=YAHOO.lang.merge(YAHOO.util.DateLocale["en"]);})();YAHOO.register("datasource",YAHOO.util.DataSource,{version:"2.7.0",build:"1796"});

/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
YAHOO.widget.DS_JSArray=YAHOO.util.LocalDataSource;YAHOO.widget.DS_JSFunction=YAHOO.util.FunctionDataSource;YAHOO.widget.DS_XHR=function(B,A,D){var C=new YAHOO.util.XHRDataSource(B,D);C._aDeprecatedSchema=A;return C;};YAHOO.widget.DS_ScriptNode=function(B,A,D){var C=new YAHOO.util.ScriptNodeDataSource(B,D);C._aDeprecatedSchema=A;return C;};YAHOO.widget.DS_XHR.TYPE_JSON=YAHOO.util.DataSourceBase.TYPE_JSON;YAHOO.widget.DS_XHR.TYPE_XML=YAHOO.util.DataSourceBase.TYPE_XML;YAHOO.widget.DS_XHR.TYPE_FLAT=YAHOO.util.DataSourceBase.TYPE_TEXT;YAHOO.widget.AutoComplete=function(G,B,J,C){if(G&&B&&J){if(J instanceof YAHOO.util.DataSourceBase){this.dataSource=J;}else{return;}this.key=0;var D=J.responseSchema;if(J._aDeprecatedSchema){var K=J._aDeprecatedSchema;if(YAHOO.lang.isArray(K)){if((J.responseType===YAHOO.util.DataSourceBase.TYPE_JSON)||(J.responseType===YAHOO.util.DataSourceBase.TYPE_UNKNOWN)){D.resultsList=K[0];this.key=K[1];D.fields=(K.length<3)?null:K.slice(1);}else{if(J.responseType===YAHOO.util.DataSourceBase.TYPE_XML){D.resultNode=K[0];this.key=K[1];D.fields=K.slice(1);}else{if(J.responseType===YAHOO.util.DataSourceBase.TYPE_TEXT){D.recordDelim=K[0];D.fieldDelim=K[1];}}}J.responseSchema=D;}}if(YAHOO.util.Dom.inDocument(G)){if(YAHOO.lang.isString(G)){this._sName="instance"+YAHOO.widget.AutoComplete._nIndex+" "+G;this._elTextbox=document.getElementById(G);}else{this._sName=(G.id)?"instance"+YAHOO.widget.AutoComplete._nIndex+" "+G.id:"instance"+YAHOO.widget.AutoComplete._nIndex;this._elTextbox=G;}YAHOO.util.Dom.addClass(this._elTextbox,"yui-ac-input");}else{return;}if(YAHOO.util.Dom.inDocument(B)){if(YAHOO.lang.isString(B)){this._elContainer=document.getElementById(B);}else{this._elContainer=B;}if(this._elContainer.style.display=="none"){}var E=this._elContainer.parentNode;var A=E.tagName.toLowerCase();if(A=="div"){YAHOO.util.Dom.addClass(E,"yui-ac");}else{}}else{return;}if(this.dataSource.dataType===YAHOO.util.DataSourceBase.TYPE_LOCAL){this.applyLocalFilter=true;}if(C&&(C.constructor==Object)){for(var I in C){if(I){this[I]=C[I];}}}this._initContainerEl();this._initProps();this._initListEl();this._initContainerHelperEls();var H=this;var F=this._elTextbox;YAHOO.util.Event.addListener(F,"keyup",H._onTextboxKeyUp,H);YAHOO.util.Event.addListener(F,"keydown",H._onTextboxKeyDown,H);YAHOO.util.Event.addListener(F,"focus",H._onTextboxFocus,H);YAHOO.util.Event.addListener(F,"blur",H._onTextboxBlur,H);YAHOO.util.Event.addListener(B,"mouseover",H._onContainerMouseover,H);YAHOO.util.Event.addListener(B,"mouseout",H._onContainerMouseout,H);YAHOO.util.Event.addListener(B,"click",H._onContainerClick,H);YAHOO.util.Event.addListener(B,"scroll",H._onContainerScroll,H);YAHOO.util.Event.addListener(B,"resize",H._onContainerResize,H);YAHOO.util.Event.addListener(F,"keypress",H._onTextboxKeyPress,H);YAHOO.util.Event.addListener(window,"unload",H._onWindowUnload,H);this.textboxFocusEvent=new YAHOO.util.CustomEvent("textboxFocus",this);this.textboxKeyEvent=new YAHOO.util.CustomEvent("textboxKey",this);this.dataRequestEvent=new YAHOO.util.CustomEvent("dataRequest",this);this.dataReturnEvent=new YAHOO.util.CustomEvent("dataReturn",this);this.dataErrorEvent=new YAHOO.util.CustomEvent("dataError",this);this.containerPopulateEvent=new YAHOO.util.CustomEvent("containerPopulate",this);this.containerExpandEvent=new YAHOO.util.CustomEvent("containerExpand",this);this.typeAheadEvent=new YAHOO.util.CustomEvent("typeAhead",this);this.itemMouseOverEvent=new YAHOO.util.CustomEvent("itemMouseOver",this);this.itemMouseOutEvent=new YAHOO.util.CustomEvent("itemMouseOut",this);this.itemArrowToEvent=new YAHOO.util.CustomEvent("itemArrowTo",this);this.itemArrowFromEvent=new YAHOO.util.CustomEvent("itemArrowFrom",this);this.itemSelectEvent=new YAHOO.util.CustomEvent("itemSelect",this);this.unmatchedItemSelectEvent=new YAHOO.util.CustomEvent("unmatchedItemSelect",this);this.selectionEnforceEvent=new YAHOO.util.CustomEvent("selectionEnforce",this);this.containerCollapseEvent=new YAHOO.util.CustomEvent("containerCollapse",this);this.textboxBlurEvent=new YAHOO.util.CustomEvent("textboxBlur",this);this.textboxChangeEvent=new YAHOO.util.CustomEvent("textboxChange",this);F.setAttribute("autocomplete","off");YAHOO.widget.AutoComplete._nIndex++;}else{}};YAHOO.widget.AutoComplete.prototype.dataSource=null;YAHOO.widget.AutoComplete.prototype.applyLocalFilter=null;YAHOO.widget.AutoComplete.prototype.queryMatchCase=false;YAHOO.widget.AutoComplete.prototype.queryMatchContains=false;YAHOO.widget.AutoComplete.prototype.queryMatchSubset=false;YAHOO.widget.AutoComplete.prototype.minQueryLength=1;YAHOO.widget.AutoComplete.prototype.maxResultsDisplayed=10;YAHOO.widget.AutoComplete.prototype.queryDelay=0.2;YAHOO.widget.AutoComplete.prototype.typeAheadDelay=0.5;YAHOO.widget.AutoComplete.prototype.queryInterval=500;YAHOO.widget.AutoComplete.prototype.highlightClassName="yui-ac-highlight";YAHOO.widget.AutoComplete.prototype.prehighlightClassName=null;YAHOO.widget.AutoComplete.prototype.delimChar=null;YAHOO.widget.AutoComplete.prototype.autoHighlight=true;YAHOO.widget.AutoComplete.prototype.typeAhead=false;YAHOO.widget.AutoComplete.prototype.animHoriz=false;YAHOO.widget.AutoComplete.prototype.animVert=true;YAHOO.widget.AutoComplete.prototype.animSpeed=0.3;YAHOO.widget.AutoComplete.prototype.forceSelection=false;YAHOO.widget.AutoComplete.prototype.allowBrowserAutocomplete=true;YAHOO.widget.AutoComplete.prototype.alwaysShowContainer=false;YAHOO.widget.AutoComplete.prototype.useIFrame=false;YAHOO.widget.AutoComplete.prototype.useShadow=false;YAHOO.widget.AutoComplete.prototype.suppressInputUpdate=false;YAHOO.widget.AutoComplete.prototype.resultTypeList=true;YAHOO.widget.AutoComplete.prototype.queryQuestionMark=true;YAHOO.widget.AutoComplete.prototype.toString=function(){return"AutoComplete "+this._sName;};YAHOO.widget.AutoComplete.prototype.getInputEl=function(){return this._elTextbox;};YAHOO.widget.AutoComplete.prototype.getContainerEl=function(){return this._elContainer;
};YAHOO.widget.AutoComplete.prototype.isFocused=function(){return(this._bFocused===null)?false:this._bFocused;};YAHOO.widget.AutoComplete.prototype.isContainerOpen=function(){return this._bContainerOpen;};YAHOO.widget.AutoComplete.prototype.getListEl=function(){return this._elList;};YAHOO.widget.AutoComplete.prototype.getListItemMatch=function(A){if(A._sResultMatch){return A._sResultMatch;}else{return null;}};YAHOO.widget.AutoComplete.prototype.getListItemData=function(A){if(A._oResultData){return A._oResultData;}else{return null;}};YAHOO.widget.AutoComplete.prototype.getListItemIndex=function(A){if(YAHOO.lang.isNumber(A._nItemIndex)){return A._nItemIndex;}else{return null;}};YAHOO.widget.AutoComplete.prototype.setHeader=function(B){if(this._elHeader){var A=this._elHeader;if(B){A.innerHTML=B;A.style.display="block";}else{A.innerHTML="";A.style.display="none";}}};YAHOO.widget.AutoComplete.prototype.setFooter=function(B){if(this._elFooter){var A=this._elFooter;if(B){A.innerHTML=B;A.style.display="block";}else{A.innerHTML="";A.style.display="none";}}};YAHOO.widget.AutoComplete.prototype.setBody=function(A){if(this._elBody){var B=this._elBody;YAHOO.util.Event.purgeElement(B,true);if(A){B.innerHTML=A;B.style.display="block";}else{B.innerHTML="";B.style.display="none";}this._elList=null;}};YAHOO.widget.AutoComplete.prototype.generateRequest=function(B){var A=this.dataSource.dataType;if(A===YAHOO.util.DataSourceBase.TYPE_XHR){if(!this.dataSource.connMethodPost){B=(this.queryQuestionMark?"?":"")+(this.dataSource.scriptQueryParam||"query")+"="+B+(this.dataSource.scriptQueryAppend?("&"+this.dataSource.scriptQueryAppend):"");}else{B=(this.dataSource.scriptQueryParam||"query")+"="+B+(this.dataSource.scriptQueryAppend?("&"+this.dataSource.scriptQueryAppend):"");}}else{if(A===YAHOO.util.DataSourceBase.TYPE_SCRIPTNODE){B="&"+(this.dataSource.scriptQueryParam||"query")+"="+B+(this.dataSource.scriptQueryAppend?("&"+this.dataSource.scriptQueryAppend):"");}}return B;};YAHOO.widget.AutoComplete.prototype.sendQuery=function(B){this._bFocused=null;var A=(this.delimChar)?this._elTextbox.value+B:B;this._sendQuery(A);};YAHOO.widget.AutoComplete.prototype.collapseContainer=function(){this._toggleContainer(false);};YAHOO.widget.AutoComplete.prototype.getSubsetMatches=function(E){var D,C,A;for(var B=E.length;B>=this.minQueryLength;B--){A=this.generateRequest(E.substr(0,B));this.dataRequestEvent.fire(this,D,A);C=this.dataSource.getCachedResponse(A);if(C){return this.filterResults.apply(this.dataSource,[E,C,C,{scope:this}]);}}return null;};YAHOO.widget.AutoComplete.prototype.preparseRawResponse=function(C,B,A){var D=((this.responseStripAfter!=="")&&(B.indexOf))?B.indexOf(this.responseStripAfter):-1;if(D!=-1){B=B.substring(0,D);}return B;};YAHOO.widget.AutoComplete.prototype.filterResults=function(J,L,P,K){if(K&&K.argument&&K.argument.query){J=K.argument.query;}if(J&&J!==""){P=YAHOO.widget.AutoComplete._cloneObject(P);var H=K.scope,O=this,B=P.results,M=[],D=false,I=(O.queryMatchCase||H.queryMatchCase),A=(O.queryMatchContains||H.queryMatchContains);for(var C=B.length-1;C>=0;C--){var F=B[C];var E=null;if(YAHOO.lang.isString(F)){E=F;}else{if(YAHOO.lang.isArray(F)){E=F[0];}else{if(this.responseSchema.fields){var N=this.responseSchema.fields[0].key||this.responseSchema.fields[0];E=F[N];}else{if(this.key){E=F[this.key];}}}}if(YAHOO.lang.isString(E)){var G=(I)?E.indexOf(decodeURIComponent(J)):E.toLowerCase().indexOf(decodeURIComponent(J).toLowerCase());if((!A&&(G===0))||(A&&(G>-1))){M.unshift(F);}}}P.results=M;}else{}return P;};YAHOO.widget.AutoComplete.prototype.handleResponse=function(C,A,B){if((this instanceof YAHOO.widget.AutoComplete)&&this._sName){this._populateList(C,A,B);}};YAHOO.widget.AutoComplete.prototype.doBeforeLoadData=function(C,A,B){return true;};YAHOO.widget.AutoComplete.prototype.formatResult=function(B,D,A){var C=(A)?A:"";return C;};YAHOO.widget.AutoComplete.prototype.doBeforeExpandContainer=function(D,A,C,B){return true;};YAHOO.widget.AutoComplete.prototype.destroy=function(){var B=this.toString();var A=this._elTextbox;var D=this._elContainer;this.textboxFocusEvent.unsubscribeAll();this.textboxKeyEvent.unsubscribeAll();this.dataRequestEvent.unsubscribeAll();this.dataReturnEvent.unsubscribeAll();this.dataErrorEvent.unsubscribeAll();this.containerPopulateEvent.unsubscribeAll();this.containerExpandEvent.unsubscribeAll();this.typeAheadEvent.unsubscribeAll();this.itemMouseOverEvent.unsubscribeAll();this.itemMouseOutEvent.unsubscribeAll();this.itemArrowToEvent.unsubscribeAll();this.itemArrowFromEvent.unsubscribeAll();this.itemSelectEvent.unsubscribeAll();this.unmatchedItemSelectEvent.unsubscribeAll();this.selectionEnforceEvent.unsubscribeAll();this.containerCollapseEvent.unsubscribeAll();this.textboxBlurEvent.unsubscribeAll();this.textboxChangeEvent.unsubscribeAll();YAHOO.util.Event.purgeElement(A,true);YAHOO.util.Event.purgeElement(D,true);D.innerHTML="";for(var C in this){if(YAHOO.lang.hasOwnProperty(this,C)){this[C]=null;}}};YAHOO.widget.AutoComplete.prototype.textboxFocusEvent=null;YAHOO.widget.AutoComplete.prototype.textboxKeyEvent=null;YAHOO.widget.AutoComplete.prototype.dataRequestEvent=null;YAHOO.widget.AutoComplete.prototype.dataReturnEvent=null;YAHOO.widget.AutoComplete.prototype.dataErrorEvent=null;YAHOO.widget.AutoComplete.prototype.containerPopulateEvent=null;YAHOO.widget.AutoComplete.prototype.containerExpandEvent=null;YAHOO.widget.AutoComplete.prototype.typeAheadEvent=null;YAHOO.widget.AutoComplete.prototype.itemMouseOverEvent=null;YAHOO.widget.AutoComplete.prototype.itemMouseOutEvent=null;YAHOO.widget.AutoComplete.prototype.itemArrowToEvent=null;YAHOO.widget.AutoComplete.prototype.itemArrowFromEvent=null;YAHOO.widget.AutoComplete.prototype.itemSelectEvent=null;YAHOO.widget.AutoComplete.prototype.unmatchedItemSelectEvent=null;YAHOO.widget.AutoComplete.prototype.selectionEnforceEvent=null;YAHOO.widget.AutoComplete.prototype.containerCollapseEvent=null;YAHOO.widget.AutoComplete.prototype.textboxBlurEvent=null;
YAHOO.widget.AutoComplete.prototype.textboxChangeEvent=null;YAHOO.widget.AutoComplete._nIndex=0;YAHOO.widget.AutoComplete.prototype._sName=null;YAHOO.widget.AutoComplete.prototype._elTextbox=null;YAHOO.widget.AutoComplete.prototype._elContainer=null;YAHOO.widget.AutoComplete.prototype._elContent=null;YAHOO.widget.AutoComplete.prototype._elHeader=null;YAHOO.widget.AutoComplete.prototype._elBody=null;YAHOO.widget.AutoComplete.prototype._elFooter=null;YAHOO.widget.AutoComplete.prototype._elShadow=null;YAHOO.widget.AutoComplete.prototype._elIFrame=null;YAHOO.widget.AutoComplete.prototype._bFocused=null;YAHOO.widget.AutoComplete.prototype._oAnim=null;YAHOO.widget.AutoComplete.prototype._bContainerOpen=false;YAHOO.widget.AutoComplete.prototype._bOverContainer=false;YAHOO.widget.AutoComplete.prototype._elList=null;YAHOO.widget.AutoComplete.prototype._nDisplayedItems=0;YAHOO.widget.AutoComplete.prototype._sCurQuery=null;YAHOO.widget.AutoComplete.prototype._sPastSelections="";YAHOO.widget.AutoComplete.prototype._sInitInputValue=null;YAHOO.widget.AutoComplete.prototype._elCurListItem=null;YAHOO.widget.AutoComplete.prototype._bItemSelected=false;YAHOO.widget.AutoComplete.prototype._nKeyCode=null;YAHOO.widget.AutoComplete.prototype._nDelayID=-1;YAHOO.widget.AutoComplete.prototype._nTypeAheadDelayID=-1;YAHOO.widget.AutoComplete.prototype._iFrameSrc="javascript:false;";YAHOO.widget.AutoComplete.prototype._queryInterval=null;YAHOO.widget.AutoComplete.prototype._sLastTextboxValue=null;YAHOO.widget.AutoComplete.prototype._initProps=function(){var B=this.minQueryLength;if(!YAHOO.lang.isNumber(B)){this.minQueryLength=1;}var E=this.maxResultsDisplayed;if(!YAHOO.lang.isNumber(E)||(E<1)){this.maxResultsDisplayed=10;}var F=this.queryDelay;if(!YAHOO.lang.isNumber(F)||(F<0)){this.queryDelay=0.2;}var C=this.typeAheadDelay;if(!YAHOO.lang.isNumber(C)||(C<0)){this.typeAheadDelay=0.2;}var A=this.delimChar;if(YAHOO.lang.isString(A)&&(A.length>0)){this.delimChar=[A];}else{if(!YAHOO.lang.isArray(A)){this.delimChar=null;}}var D=this.animSpeed;if((this.animHoriz||this.animVert)&&YAHOO.util.Anim){if(!YAHOO.lang.isNumber(D)||(D<0)){this.animSpeed=0.3;}if(!this._oAnim){this._oAnim=new YAHOO.util.Anim(this._elContent,{},this.animSpeed);}else{this._oAnim.duration=this.animSpeed;}}if(this.forceSelection&&A){}};YAHOO.widget.AutoComplete.prototype._initContainerHelperEls=function(){if(this.useShadow&&!this._elShadow){var A=document.createElement("div");A.className="yui-ac-shadow";A.style.width=0;A.style.height=0;this._elShadow=this._elContainer.appendChild(A);}if(this.useIFrame&&!this._elIFrame){var B=document.createElement("iframe");B.src=this._iFrameSrc;B.frameBorder=0;B.scrolling="no";B.style.position="absolute";B.style.width=0;B.style.height=0;B.tabIndex=-1;B.style.padding=0;this._elIFrame=this._elContainer.appendChild(B);}};YAHOO.widget.AutoComplete.prototype._initContainerEl=function(){YAHOO.util.Dom.addClass(this._elContainer,"yui-ac-container");if(!this._elContent){var C=document.createElement("div");C.className="yui-ac-content";C.style.display="none";this._elContent=this._elContainer.appendChild(C);var B=document.createElement("div");B.className="yui-ac-hd";B.style.display="none";this._elHeader=this._elContent.appendChild(B);var D=document.createElement("div");D.className="yui-ac-bd";this._elBody=this._elContent.appendChild(D);var A=document.createElement("div");A.className="yui-ac-ft";A.style.display="none";this._elFooter=this._elContent.appendChild(A);}else{}};YAHOO.widget.AutoComplete.prototype._initListEl=function(){var C=this.maxResultsDisplayed;var A=this._elList||document.createElement("ul");var B;while(A.childNodes.length<C){B=document.createElement("li");B.style.display="none";B._nItemIndex=A.childNodes.length;A.appendChild(B);}if(!this._elList){var D=this._elBody;YAHOO.util.Event.purgeElement(D,true);D.innerHTML="";this._elList=D.appendChild(A);}};YAHOO.widget.AutoComplete.prototype._focus=function(){var A=this;setTimeout(function(){try{A._elTextbox.focus();}catch(B){}},0);};YAHOO.widget.AutoComplete.prototype._enableIntervalDetection=function(){var A=this;if(!A._queryInterval&&A.queryInterval){A._queryInterval=setInterval(function(){A._onInterval();},A.queryInterval);}};YAHOO.widget.AutoComplete.prototype._onInterval=function(){var A=this._elTextbox.value;var B=this._sLastTextboxValue;if(A!=B){this._sLastTextboxValue=A;this._sendQuery(A);}};YAHOO.widget.AutoComplete.prototype._clearInterval=function(){if(this._queryInterval){clearInterval(this._queryInterval);this._queryInterval=null;}};YAHOO.widget.AutoComplete.prototype._isIgnoreKey=function(A){if((A==9)||(A==13)||(A==16)||(A==17)||(A>=18&&A<=20)||(A==27)||(A>=33&&A<=35)||(A>=36&&A<=40)||(A>=44&&A<=45)||(A==229)){return true;}return false;};YAHOO.widget.AutoComplete.prototype._sendQuery=function(D){if(this.minQueryLength<0){this._toggleContainer(false);return;}if(this.delimChar){var A=this._extractQuery(D);D=A.query;this._sPastSelections=A.previous;}if((D&&(D.length<this.minQueryLength))||(!D&&this.minQueryLength>0)){if(this._nDelayID!=-1){clearTimeout(this._nDelayID);}this._toggleContainer(false);return;}D=encodeURIComponent(D);this._nDelayID=-1;if(this.dataSource.queryMatchSubset||this.queryMatchSubset){var C=this.getSubsetMatches(D);if(C){this.handleResponse(D,C,{query:D});return;}}if(this.responseStripAfter){this.dataSource.doBeforeParseData=this.preparseRawResponse;}if(this.applyLocalFilter){this.dataSource.doBeforeCallback=this.filterResults;}var B=this.generateRequest(D);this.dataRequestEvent.fire(this,D,B);this.dataSource.sendRequest(B,{success:this.handleResponse,failure:this.handleResponse,scope:this,argument:{query:D}});};YAHOO.widget.AutoComplete.prototype._populateList=function(K,F,C){if(this._nTypeAheadDelayID!=-1){clearTimeout(this._nTypeAheadDelayID);}K=(C&&C.query)?C.query:K;var H=this.doBeforeLoadData(K,F,C);if(H&&!F.error){this.dataReturnEvent.fire(this,K,F.results);if(this._bFocused||(this._bFocused===null)){var M=decodeURIComponent(K);this._sCurQuery=M;
this._bItemSelected=false;var R=F.results,A=Math.min(R.length,this.maxResultsDisplayed),J=(this.dataSource.responseSchema.fields)?(this.dataSource.responseSchema.fields[0].key||this.dataSource.responseSchema.fields[0]):0;if(A>0){if(!this._elList||(this._elList.childNodes.length<A)){this._initListEl();}this._initContainerHelperEls();var I=this._elList.childNodes;for(var Q=A-1;Q>=0;Q--){var P=I[Q],E=R[Q];if(this.resultTypeList){var B=[];B[0]=(YAHOO.lang.isString(E))?E:E[J]||E[this.key];var L=this.dataSource.responseSchema.fields;if(YAHOO.lang.isArray(L)&&(L.length>1)){for(var N=1,S=L.length;N<S;N++){B[B.length]=E[L[N].key||L[N]];}}else{if(YAHOO.lang.isArray(E)){B=E;}else{if(YAHOO.lang.isString(E)){B=[E];}else{B[1]=E;}}}E=B;}P._sResultMatch=(YAHOO.lang.isString(E))?E:(YAHOO.lang.isArray(E))?E[0]:(E[J]||"");P._oResultData=E;

// custom for Delicious, do to weird innerHTML bug...
//P.innerHTML = '';
//P.appendChild(this.formatResult(E,M,P._sResultMatch));


                    /* START DEL HACK - For some reason IE7 barfs on innerHTML writes here */
                    var children = P.childNodes;
                    for (var ii=0; ii<children.length; ii++) {
                        P.removeChild(children[ii]);
                    };
                    var tmp = document.createElement('span');
                    tmp.innerHTML = this.formatResult(E, M, P._sResultMatch);
                    P.appendChild(tmp);
                    /* END DEL HACK */





P.style.display="";}if(A<I.length){var G;for(var O=I.length-1;O>=A;O--){G=I[O];G.style.display="none";}}this._nDisplayedItems=A;this.containerPopulateEvent.fire(this,K,R);if(this.autoHighlight){var D=this._elList.firstChild;this._toggleHighlight(D,"to");this.itemArrowToEvent.fire(this,D);this._typeAhead(D,K);}else{this._toggleHighlight(this._elCurListItem,"from");}H=this.doBeforeExpandContainer(this._elTextbox,this._elContainer,K,R);this._toggleContainer(H);}else{this._toggleContainer(false);}return;}}else{this.dataErrorEvent.fire(this,K);}};YAHOO.widget.AutoComplete.prototype._clearSelection=function(){var A=(this.delimChar)?this._extractQuery(this._elTextbox.value):{previous:"",query:this._elTextbox.value};this._elTextbox.value=A.previous;this.selectionEnforceEvent.fire(this,A.query);};YAHOO.widget.AutoComplete.prototype._textMatchesOption=function(){var A=null;for(var B=0;B<this._nDisplayedItems;B++){var C=this._elList.childNodes[B];var D=(""+C._sResultMatch).toLowerCase();if(D==this._sCurQuery.toLowerCase()){A=C;break;}}return(A);};YAHOO.widget.AutoComplete.prototype._typeAhead=function(B,D){if(!this.typeAhead||(this._nKeyCode==8)){return;}var A=this,C=this._elTextbox;if(C.setSelectionRange||C.createTextRange){this._nTypeAheadDelayID=setTimeout(function(){var F=C.value.length;A._updateValue(B);var G=C.value.length;A._selectText(C,F,G);var E=C.value.substr(F,G);A.typeAheadEvent.fire(A,D,E);},(this.typeAheadDelay*1000));}};YAHOO.widget.AutoComplete.prototype._selectText=function(D,A,B){if(D.setSelectionRange){D.setSelectionRange(A,B);}else{if(D.createTextRange){var C=D.createTextRange();C.moveStart("character",A);C.moveEnd("character",B-D.value.length);C.select();}else{D.select();}}};YAHOO.widget.AutoComplete.prototype._extractQuery=function(H){var C=this.delimChar,F=-1,G,E,B=C.length-1,D;for(;B>=0;B--){G=H.lastIndexOf(C[B]);if(G>F){F=G;}}if(C[B]==" "){for(var A=C.length-1;A>=0;A--){if(H[F-1]==C[A]){F--;break;}}}if(F>-1){E=F+1;while(H.charAt(E)==" "){E+=1;}D=H.substring(0,E);H=H.substr(E);}else{D="";}return{previous:D,query:H};};YAHOO.widget.AutoComplete.prototype._toggleContainerHelpers=function(D){var E=this._elContent.offsetWidth+"px";var B=this._elContent.offsetHeight+"px";if(this.useIFrame&&this._elIFrame){var C=this._elIFrame;if(D){C.style.width=E;C.style.height=B;C.style.padding="";}else{C.style.width=0;C.style.height=0;C.style.padding=0;}}if(this.useShadow&&this._elShadow){var A=this._elShadow;if(D){A.style.width=E;A.style.height=B;}else{A.style.width=0;A.style.height=0;}}};YAHOO.widget.AutoComplete.prototype._toggleContainer=function(I){var D=this._elContainer;if(this.alwaysShowContainer&&this._bContainerOpen){return;}if(!I){this._toggleHighlight(this._elCurListItem,"from");this._nDisplayedItems=0;this._sCurQuery=null;if(this._elContent.style.display=="none"){return;}}var A=this._oAnim;if(A&&A.getEl()&&(this.animHoriz||this.animVert)){if(A.isAnimated()){A.stop(true);}var G=this._elContent.cloneNode(true);D.appendChild(G);G.style.top="-9000px";G.style.width="";G.style.height="";G.style.display="";var F=G.offsetWidth;var C=G.offsetHeight;var B=(this.animHoriz)?0:F;var E=(this.animVert)?0:C;A.attributes=(I)?{width:{to:F},height:{to:C}}:{width:{to:B},height:{to:E}};if(I&&!this._bContainerOpen){this._elContent.style.width=B+"px";this._elContent.style.height=E+"px";}else{this._elContent.style.width=F+"px";this._elContent.style.height=C+"px";}D.removeChild(G);G=null;var H=this;var J=function(){A.onComplete.unsubscribeAll();if(I){H._toggleContainerHelpers(true);H._bContainerOpen=I;H.containerExpandEvent.fire(H);}else{H._elContent.style.display="none";H._bContainerOpen=I;H.containerCollapseEvent.fire(H);}};this._toggleContainerHelpers(false);this._elContent.style.display="";A.onComplete.subscribe(J);A.animate();}else{if(I){this._elContent.style.display="";this._toggleContainerHelpers(true);this._bContainerOpen=I;this.containerExpandEvent.fire(this);}else{this._toggleContainerHelpers(false);this._elContent.style.display="none";this._bContainerOpen=I;this.containerCollapseEvent.fire(this);}}};YAHOO.widget.AutoComplete.prototype._toggleHighlight=function(A,C){if(A){var B=this.highlightClassName;if(this._elCurListItem){YAHOO.util.Dom.removeClass(this._elCurListItem,B);this._elCurListItem=null;}if((C=="to")&&B){YAHOO.util.Dom.addClass(A,B);this._elCurListItem=A;}}};YAHOO.widget.AutoComplete.prototype._togglePrehighlight=function(B,C){if(B==this._elCurListItem){return;}var A=this.prehighlightClassName;if((C=="mouseover")&&A){YAHOO.util.Dom.addClass(B,A);}else{YAHOO.util.Dom.removeClass(B,A);}};YAHOO.widget.AutoComplete.prototype._updateValue=function(C){if(!this.suppressInputUpdate){var F=this._elTextbox;var E=(this.delimChar)?(this.delimChar[0]||this.delimChar):null;var B=C._sResultMatch;var D="";if(E){D=this._sPastSelections;D+=B+E;if(E!=" "){D+=" ";}}else{D=B;}F.value=D;if(F.type=="textarea"){F.scrollTop=F.scrollHeight;}var A=F.value.length;this._selectText(F,A,A);this._elCurListItem=C;}};YAHOO.widget.AutoComplete.prototype._selectItem=function(A){this._bItemSelected=true;this._updateValue(A);this._sPastSelections=this._elTextbox.value;
this._clearInterval();this.itemSelectEvent.fire(this,A,A._oResultData);this._toggleContainer(false);};YAHOO.widget.AutoComplete.prototype._jumpSelection=function(){if(this._elCurListItem){this._selectItem(this._elCurListItem);}else{this._toggleContainer(false);}};YAHOO.widget.AutoComplete.prototype._moveSelection=function(G){if(this._bContainerOpen){var H=this._elCurListItem,D=-1;if(H){D=H._nItemIndex;}var E=(G==40)?(D+1):(D-1);if(E<-2||E>=this._nDisplayedItems){return;}if(H){this._toggleHighlight(H,"from");this.itemArrowFromEvent.fire(this,H);}if(E==-1){if(this.delimChar){this._elTextbox.value=this._sPastSelections+this._sCurQuery;}else{this._elTextbox.value=this._sCurQuery;}return;}if(E==-2){this._toggleContainer(false);return;}var F=this._elList.childNodes[E],B=this._elContent,C=YAHOO.util.Dom.getStyle(B,"overflow"),I=YAHOO.util.Dom.getStyle(B,"overflowY"),A=((C=="auto")||(C=="scroll")||(I=="auto")||(I=="scroll"));if(A&&(E>-1)&&(E<this._nDisplayedItems)){if(G==40){if((F.offsetTop+F.offsetHeight)>(B.scrollTop+B.offsetHeight)){B.scrollTop=(F.offsetTop+F.offsetHeight)-B.offsetHeight;}else{if((F.offsetTop+F.offsetHeight)<B.scrollTop){B.scrollTop=F.offsetTop;}}}else{if(F.offsetTop<B.scrollTop){this._elContent.scrollTop=F.offsetTop;}else{if(F.offsetTop>(B.scrollTop+B.offsetHeight)){this._elContent.scrollTop=(F.offsetTop+F.offsetHeight)-B.offsetHeight;}}}}this._toggleHighlight(F,"to");this.itemArrowToEvent.fire(this,F);if(this.typeAhead){this._updateValue(F);}}};YAHOO.widget.AutoComplete.prototype._onContainerMouseover=function(A,C){var D=YAHOO.util.Event.getTarget(A);var B=D.nodeName.toLowerCase();while(D&&(B!="table")){switch(B){case"body":return;case"li":if(C.prehighlightClassName){C._togglePrehighlight(D,"mouseover");}else{C._toggleHighlight(D,"to");}C.itemMouseOverEvent.fire(C,D);break;case"div":if(YAHOO.util.Dom.hasClass(D,"yui-ac-container")){C._bOverContainer=true;return;}break;default:break;}D=D.parentNode;if(D){B=D.nodeName.toLowerCase();}}};YAHOO.widget.AutoComplete.prototype._onContainerMouseout=function(A,C){var D=YAHOO.util.Event.getTarget(A);var B=D.nodeName.toLowerCase();while(D&&(B!="table")){switch(B){case"body":return;case"li":if(C.prehighlightClassName){C._togglePrehighlight(D,"mouseout");}else{C._toggleHighlight(D,"from");}C.itemMouseOutEvent.fire(C,D);break;case"ul":C._toggleHighlight(C._elCurListItem,"to");break;case"div":if(YAHOO.util.Dom.hasClass(D,"yui-ac-container")){C._bOverContainer=false;return;}break;default:break;}D=D.parentNode;if(D){B=D.nodeName.toLowerCase();}}};YAHOO.widget.AutoComplete.prototype._onContainerClick=function(A,C){var D=YAHOO.util.Event.getTarget(A);var B=D.nodeName.toLowerCase();while(D&&(B!="table")){switch(B){case"body":return;case"li":C._toggleHighlight(D,"to");C._selectItem(D);return;default:break;}D=D.parentNode;if(D){B=D.nodeName.toLowerCase();}}};YAHOO.widget.AutoComplete.prototype._onContainerScroll=function(A,B){B._focus();};YAHOO.widget.AutoComplete.prototype._onContainerResize=function(A,B){B._toggleContainerHelpers(B._bContainerOpen);};YAHOO.widget.AutoComplete.prototype._onTextboxKeyDown=function(A,B){var C=A.keyCode;if(B._nTypeAheadDelayID!=-1){clearTimeout(B._nTypeAheadDelayID);}switch(C){case 9:if(!YAHOO.env.ua.opera&&(navigator.userAgent.toLowerCase().indexOf("mac")==-1)||(YAHOO.env.ua.webkit>420)){if(B._elCurListItem){if(B.delimChar&&(B._nKeyCode!=C)){if(B._bContainerOpen){YAHOO.util.Event.stopEvent(A);}}B._selectItem(B._elCurListItem);}else{B._toggleContainer(false);}}break;case 13:if(!YAHOO.env.ua.opera&&(navigator.userAgent.toLowerCase().indexOf("mac")==-1)||(YAHOO.env.ua.webkit>420)){if(B._elCurListItem){if(B._nKeyCode!=C){if(B._bContainerOpen){YAHOO.util.Event.stopEvent(A);}}B._selectItem(B._elCurListItem);}else{B._toggleContainer(false);}}break;case 27:B._toggleContainer(false);return;case 39:B._jumpSelection();break;case 38:if(B._bContainerOpen){YAHOO.util.Event.stopEvent(A);B._moveSelection(C);}break;case 40:if(B._bContainerOpen){YAHOO.util.Event.stopEvent(A);B._moveSelection(C);}break;default:B._bItemSelected=false;B._toggleHighlight(B._elCurListItem,"from");B.textboxKeyEvent.fire(B,C);break;}if(C===18){B._enableIntervalDetection();}B._nKeyCode=C;};YAHOO.widget.AutoComplete.prototype._onTextboxKeyPress=function(A,B){var C=A.keyCode;if(YAHOO.env.ua.opera||(navigator.userAgent.toLowerCase().indexOf("mac")!=-1)&&(YAHOO.env.ua.webkit<420)){switch(C){case 9:if(B._bContainerOpen){if(B.delimChar){YAHOO.util.Event.stopEvent(A);}if(B._elCurListItem){B._selectItem(B._elCurListItem);}else{B._toggleContainer(false);}}break;case 13:if(B._bContainerOpen){YAHOO.util.Event.stopEvent(A);if(B._elCurListItem){B._selectItem(B._elCurListItem);}else{B._toggleContainer(false);}}break;default:break;}}else{if(C==229){B._enableIntervalDetection();}}};YAHOO.widget.AutoComplete.prototype._onTextboxKeyUp=function(A,C){var B=this.value;C._initProps();var D=A.keyCode;if(C._isIgnoreKey(D)){return;}if(C._nDelayID!=-1){clearTimeout(C._nDelayID);}C._nDelayID=setTimeout(function(){C._sendQuery(B);},(C.queryDelay*1000));};YAHOO.widget.AutoComplete.prototype._onTextboxFocus=function(A,B){if(!B._bFocused){B._elTextbox.setAttribute("autocomplete","off");B._bFocused=true;B._sInitInputValue=B._elTextbox.value;B.textboxFocusEvent.fire(B);}};YAHOO.widget.AutoComplete.prototype._onTextboxBlur=function(A,C){if(!C._bOverContainer||(C._nKeyCode==9)){if(!C._bItemSelected){var B=C._textMatchesOption();if(!C._bContainerOpen||(C._bContainerOpen&&(B===null))){if(C.forceSelection){C._clearSelection();}else{C.unmatchedItemSelectEvent.fire(C,C._sCurQuery);}}else{if(C.forceSelection){C._selectItem(B);}}}C._clearInterval();C._bFocused=false;if(C._sInitInputValue!==C._elTextbox.value){C.textboxChangeEvent.fire(C);}C.textboxBlurEvent.fire(C);C._toggleContainer(false);}else{C._focus();}};YAHOO.widget.AutoComplete.prototype._onWindowUnload=function(A,B){if(B&&B._elTextbox&&B.allowBrowserAutocomplete){B._elTextbox.setAttribute("autocomplete","on");}};YAHOO.widget.AutoComplete.prototype.doBeforeSendQuery=function(A){return this.generateRequest(A);
};YAHOO.widget.AutoComplete.prototype.getListItems=function(){var C=[],B=this._elList.childNodes;for(var A=B.length-1;A>=0;A--){C[A]=B[A];}return C;};YAHOO.widget.AutoComplete._cloneObject=function(D){if(!YAHOO.lang.isValue(D)){return D;}var F={};if(YAHOO.lang.isFunction(D)){F=D;}else{if(YAHOO.lang.isArray(D)){var E=[];for(var C=0,B=D.length;C<B;C++){E[C]=YAHOO.widget.AutoComplete._cloneObject(D[C]);}F=E;}else{if(YAHOO.lang.isObject(D)){for(var A in D){if(YAHOO.lang.hasOwnProperty(D,A)){if(YAHOO.lang.isValue(D[A])&&YAHOO.lang.isObject(D[A])||YAHOO.lang.isArray(D[A])){F[A]=YAHOO.widget.AutoComplete._cloneObject(D[A]);}else{F[A]=D[A];}}}}else{F=D;}}}return F;};YAHOO.register("autocomplete",YAHOO.widget.AutoComplete,{version:"2.7.0",build:"1796"});
/*
Copyright (c) 2008, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.5.0
*/
YAHOO.widget.LogMsg=function(A){if(A&&(A.constructor==Object)){for(var B in A){this[B]=A[B];}}};YAHOO.widget.LogMsg.prototype.msg=null;YAHOO.widget.LogMsg.prototype.time=null;YAHOO.widget.LogMsg.prototype.category=null;YAHOO.widget.LogMsg.prototype.source=null;YAHOO.widget.LogMsg.prototype.sourceDetail=null;YAHOO.widget.LogWriter=function(A){if(!A){YAHOO.log("Could not instantiate LogWriter due to invalid source.","error","LogWriter");return ;}this._source=A;};YAHOO.widget.LogWriter.prototype.toString=function(){return"LogWriter "+this._sSource;};YAHOO.widget.LogWriter.prototype.log=function(A,B){YAHOO.widget.Logger.log(A,B,this._source);};YAHOO.widget.LogWriter.prototype.getSource=function(){return this._sSource;};YAHOO.widget.LogWriter.prototype.setSource=function(A){if(!A){YAHOO.log("Could not set source due to invalid source.","error",this.toString());return ;}else{this._sSource=A;}};YAHOO.widget.LogWriter.prototype._source=null;YAHOO.widget.LogReader=function(B,A){this._sName=YAHOO.widget.LogReader._index;YAHOO.widget.LogReader._index++;this._buffer=[];this._filterCheckboxes={};this._lastTime=YAHOO.widget.Logger.getStartTime();if(A&&(A.constructor==Object)){for(var C in A){this[C]=A[C];}}this._initContainerEl(B);if(!this._elContainer){YAHOO.log("Could not instantiate LogReader due to an invalid container element "+B,"error",this.toString());return ;}this._initHeaderEl();this._initConsoleEl();this._initFooterEl();this._initDragDrop();this._initCategories();this._initSources();YAHOO.widget.Logger.newLogEvent.subscribe(this._onNewLog,this);YAHOO.widget.Logger.logResetEvent.subscribe(this._onReset,this);YAHOO.widget.Logger.categoryCreateEvent.subscribe(this._onCategoryCreate,this);YAHOO.widget.Logger.sourceCreateEvent.subscribe(this._onSourceCreate,this);this._filterLogs();YAHOO.log("LogReader initialized",null,this.toString());};YAHOO.widget.LogReader.prototype.logReaderEnabled=true;YAHOO.widget.LogReader.prototype.width=null;YAHOO.widget.LogReader.prototype.height=null;YAHOO.widget.LogReader.prototype.top=null;YAHOO.widget.LogReader.prototype.left=null;YAHOO.widget.LogReader.prototype.right=null;YAHOO.widget.LogReader.prototype.bottom=null;YAHOO.widget.LogReader.prototype.fontSize=null;YAHOO.widget.LogReader.prototype.footerEnabled=true;YAHOO.widget.LogReader.prototype.verboseOutput=true;YAHOO.widget.LogReader.prototype.newestOnTop=true;YAHOO.widget.LogReader.prototype.outputBuffer=100;YAHOO.widget.LogReader.prototype.thresholdMax=500;YAHOO.widget.LogReader.prototype.thresholdMin=100;YAHOO.widget.LogReader.prototype.isCollapsed=false;YAHOO.widget.LogReader.prototype.isPaused=false;YAHOO.widget.LogReader.prototype.draggable=true;YAHOO.widget.LogReader.prototype.toString=function(){return"LogReader instance"+this._sName;};YAHOO.widget.LogReader.prototype.pause=function(){this.isPaused=true;this._btnPause.value="Resume";this._timeout=null;this.logReaderEnabled=false;};YAHOO.widget.LogReader.prototype.resume=function(){this.isPaused=false;this._btnPause.value="Pause";this.logReaderEnabled=true;this._printBuffer();};YAHOO.widget.LogReader.prototype.hide=function(){this._elContainer.style.display="none";};YAHOO.widget.LogReader.prototype.show=function(){this._elContainer.style.display="block";};YAHOO.widget.LogReader.prototype.collapse=function(){this._elConsole.style.display="none";if(this._elFt){this._elFt.style.display="none";}this._btnCollapse.value="Expand";this.isCollapsed=true;};YAHOO.widget.LogReader.prototype.expand=function(){this._elConsole.style.display="block";if(this._elFt){this._elFt.style.display="block";}this._btnCollapse.value="Collapse";this.isCollapsed=false;};YAHOO.widget.LogReader.prototype.getCheckbox=function(A){return this._filterCheckboxes[A];};YAHOO.widget.LogReader.prototype.getCategories=function(){return this._categoryFilters;};YAHOO.widget.LogReader.prototype.showCategory=function(B){var D=this._categoryFilters;if(D.indexOf){if(D.indexOf(B)>-1){return ;}}else{for(var A=0;A<D.length;A++){if(D[A]===B){return ;}}}this._categoryFilters.push(B);this._filterLogs();var C=this.getCheckbox(B);if(C){C.checked=true;}};YAHOO.widget.LogReader.prototype.hideCategory=function(B){var D=this._categoryFilters;for(var A=0;A<D.length;A++){if(B==D[A]){D.splice(A,1);break;}}this._filterLogs();var C=this.getCheckbox(B);if(C){C.checked=false;}};YAHOO.widget.LogReader.prototype.getSources=function(){return this._sourceFilters;};YAHOO.widget.LogReader.prototype.showSource=function(A){var D=this._sourceFilters;if(D.indexOf){if(D.indexOf(A)>-1){return ;}}else{for(var B=0;B<D.length;B++){if(A==D[B]){return ;}}}D.push(A);this._filterLogs();var C=this.getCheckbox(A);if(C){C.checked=true;}};YAHOO.widget.LogReader.prototype.hideSource=function(A){var D=this._sourceFilters;for(var B=0;B<D.length;B++){if(A==D[B]){D.splice(B,1);break;}}this._filterLogs();var C=this.getCheckbox(A);if(C){C.checked=false;}};YAHOO.widget.LogReader.prototype.clearConsole=function(){this._timeout=null;this._buffer=[];this._consoleMsgCount=0;var A=this._elConsole;while(A.hasChildNodes()){A.removeChild(A.firstChild);}};YAHOO.widget.LogReader.prototype.setTitle=function(A){this._title.innerHTML=this.html2Text(A);};YAHOO.widget.LogReader.prototype.getLastTime=function(){return this._lastTime;};YAHOO.widget.LogReader.prototype.formatMsg=function(D){var E=D.category;var L=E.substring(0,4).toUpperCase();var I=D.time;var J;if(I.toLocaleTimeString){J=I.toLocaleTimeString();}else{J=I.toString();}var B=I.getTime();var F=YAHOO.widget.Logger.getStartTime();var C=B-F;var N=B-this.getLastTime();var A=D.source;var M=D.sourceDetail;var K=(M)?A+" "+M:A;var H=this.html2Text(YAHOO.lang.dump(D.msg));var G=(this.verboseOutput)?["<pre class=\"yui-log-verbose\"><p><span class='",E,"'>",L,"<\/span> ",C,"ms (+",N,") ",J,": ","<\/p><p>",K,": <\/p><p>",H,"<\/p><\/pre>"]:["<pre><p><span class='",E,"'>",L,"<\/span> ",C,"ms (+",N,") ",J,": ",K,": ",H,"<\/p><\/pre>"];return G.join("");};YAHOO.widget.LogReader.prototype.html2Text=function(A){if(A){A+="";return A.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;");
}return"";};YAHOO.widget.LogReader._index=0;YAHOO.widget.LogReader.prototype._sName=null;YAHOO.widget.LogReader.prototype._buffer=null;YAHOO.widget.LogReader.prototype._consoleMsgCount=0;YAHOO.widget.LogReader.prototype._lastTime=null;YAHOO.widget.LogReader.prototype._timeout=null;YAHOO.widget.LogReader.prototype._filterCheckboxes=null;YAHOO.widget.LogReader.prototype._categoryFilters=null;YAHOO.widget.LogReader.prototype._sourceFilters=null;YAHOO.widget.LogReader.prototype._elContainer=null;YAHOO.widget.LogReader.prototype._elHd=null;YAHOO.widget.LogReader.prototype._elCollapse=null;YAHOO.widget.LogReader.prototype._btnCollapse=null;YAHOO.widget.LogReader.prototype._title=null;YAHOO.widget.LogReader.prototype._elConsole=null;YAHOO.widget.LogReader.prototype._elFt=null;YAHOO.widget.LogReader.prototype._elBtns=null;YAHOO.widget.LogReader.prototype._elCategoryFilters=null;YAHOO.widget.LogReader.prototype._elSourceFilters=null;YAHOO.widget.LogReader.prototype._btnPause=null;YAHOO.widget.LogReader.prototype._btnClear=null;YAHOO.widget.LogReader.prototype._initContainerEl=function(B){B=YAHOO.util.Dom.get(B);if(B&&B.tagName&&(B.tagName.toLowerCase()=="div")){this._elContainer=B;YAHOO.util.Dom.addClass(this._elContainer,"yui-log");}else{this._elContainer=document.body.appendChild(document.createElement("div"));YAHOO.util.Dom.addClass(this._elContainer,"yui-log");YAHOO.util.Dom.addClass(this._elContainer,"yui-log-container");var A=this._elContainer.style;if(this.width){A.width=this.width;}if(this.right){A.right=this.right;}if(this.top){A.top=this.top;}if(this.left){A.left=this.left;A.right="auto";}if(this.bottom){A.bottom=this.bottom;A.top="auto";}if(this.fontSize){A.fontSize=this.fontSize;}if(navigator.userAgent.toLowerCase().indexOf("opera")!=-1){document.body.style+="";}}};YAHOO.widget.LogReader.prototype._initHeaderEl=function(){var A=this;if(this._elHd){YAHOO.util.Event.purgeElement(this._elHd,true);this._elHd.innerHTML="";}this._elHd=this._elContainer.appendChild(document.createElement("div"));this._elHd.id="yui-log-hd"+this._sName;this._elHd.className="yui-log-hd";this._elCollapse=this._elHd.appendChild(document.createElement("div"));this._elCollapse.className="yui-log-btns";this._btnCollapse=document.createElement("input");this._btnCollapse.type="button";this._btnCollapse.className="yui-log-button";this._btnCollapse.value="Collapse";this._btnCollapse=this._elCollapse.appendChild(this._btnCollapse);YAHOO.util.Event.addListener(A._btnCollapse,"click",A._onClickCollapseBtn,A);this._title=this._elHd.appendChild(document.createElement("h4"));this._title.innerHTML="Logger Console";};YAHOO.widget.LogReader.prototype._initConsoleEl=function(){if(this._elConsole){YAHOO.util.Event.purgeElement(this._elConsole,true);this._elConsole.innerHTML="";}this._elConsole=this._elContainer.appendChild(document.createElement("div"));this._elConsole.className="yui-log-bd";if(this.height){this._elConsole.style.height=this.height;}};YAHOO.widget.LogReader.prototype._initFooterEl=function(){var A=this;if(this.footerEnabled){if(this._elFt){YAHOO.util.Event.purgeElement(this._elFt,true);this._elFt.innerHTML="";}this._elFt=this._elContainer.appendChild(document.createElement("div"));this._elFt.className="yui-log-ft";this._elBtns=this._elFt.appendChild(document.createElement("div"));this._elBtns.className="yui-log-btns";this._btnPause=document.createElement("input");this._btnPause.type="button";this._btnPause.className="yui-log-button";this._btnPause.value="Pause";this._btnPause=this._elBtns.appendChild(this._btnPause);YAHOO.util.Event.addListener(A._btnPause,"click",A._onClickPauseBtn,A);this._btnClear=document.createElement("input");this._btnClear.type="button";this._btnClear.className="yui-log-button";this._btnClear.value="Clear";this._btnClear=this._elBtns.appendChild(this._btnClear);YAHOO.util.Event.addListener(A._btnClear,"click",A._onClickClearBtn,A);this._elCategoryFilters=this._elFt.appendChild(document.createElement("div"));this._elCategoryFilters.className="yui-log-categoryfilters";this._elSourceFilters=this._elFt.appendChild(document.createElement("div"));this._elSourceFilters.className="yui-log-sourcefilters";}};YAHOO.widget.LogReader.prototype._initDragDrop=function(){if(YAHOO.util.DD&&this.draggable&&this._elHd){var A=new YAHOO.util.DD(this._elContainer);A.setHandleElId(this._elHd.id);this._elHd.style.cursor="move";}};YAHOO.widget.LogReader.prototype._initCategories=function(){this._categoryFilters=[];var C=YAHOO.widget.Logger.categories;for(var A=0;A<C.length;A++){var B=C[A];this._categoryFilters.push(B);if(this._elCategoryFilters){this._createCategoryCheckbox(B);}}};YAHOO.widget.LogReader.prototype._initSources=function(){this._sourceFilters=[];var C=YAHOO.widget.Logger.sources;for(var B=0;B<C.length;B++){var A=C[B];this._sourceFilters.push(A);if(this._elSourceFilters){this._createSourceCheckbox(A);}}};YAHOO.widget.LogReader.prototype._createCategoryCheckbox=function(B){var A=this;if(this._elFt){var E=this._elCategoryFilters;var D=E.appendChild(document.createElement("span"));D.className="yui-log-filtergrp";var C=document.createElement("input");C.id="yui-log-filter-"+B+this._sName;C.className="yui-log-filter-"+B;C.type="checkbox";C.category=B;C=D.appendChild(C);C.checked=true;YAHOO.util.Event.addListener(C,"click",A._onCheckCategory,A);var F=D.appendChild(document.createElement("label"));F.htmlFor=C.id;F.className=B;F.innerHTML=B;this._filterCheckboxes[B]=C;}};YAHOO.widget.LogReader.prototype._createSourceCheckbox=function(A){var D=this;if(this._elFt){var F=this._elSourceFilters;var E=F.appendChild(document.createElement("span"));E.className="yui-log-filtergrp";var C=document.createElement("input");C.id="yui-log-filter"+A+this._sName;C.className="yui-log-filter"+A;C.type="checkbox";C.source=A;C=E.appendChild(C);C.checked=true;YAHOO.util.Event.addListener(C,"click",D._onCheckSource,D);var B=E.appendChild(document.createElement("label"));B.htmlFor=C.id;B.className=A;B.innerHTML=A;this._filterCheckboxes[A]=C;
}};YAHOO.widget.LogReader.prototype._filterLogs=function(){if(this._elConsole!==null){this.clearConsole();this._printToConsole(YAHOO.widget.Logger.getStack());}};YAHOO.widget.LogReader.prototype._printBuffer=function(){this._timeout=null;if(this._elConsole!==null){var B=this.thresholdMax;B=(B&&!isNaN(B))?B:500;if(this._consoleMsgCount<B){var A=[];for(var C=0;C<this._buffer.length;C++){A[C]=this._buffer[C];}this._buffer=[];this._printToConsole(A);}else{this._filterLogs();}if(!this.newestOnTop){this._elConsole.scrollTop=this._elConsole.scrollHeight;}}};YAHOO.widget.LogReader.prototype._printToConsole=function(J){var B=J.length;var O=this.thresholdMin;if(isNaN(O)||(O>this.thresholdMax)){O=0;}var L=(B>O)?(B-O):0;var C=this._sourceFilters.length;var M=this._categoryFilters.length;for(var I=L;I<B;I++){var F=false;var K=false;var N=J[I];var A=N.source;var D=N.category;for(var H=0;H<C;H++){if(A==this._sourceFilters[H]){K=true;break;}}if(K){for(var G=0;G<M;G++){if(D==this._categoryFilters[G]){F=true;break;}}}if(F){var E=this.formatMsg(N);if(this.newestOnTop){this._elConsole.innerHTML=E+this._elConsole.innerHTML;}else{this._elConsole.innerHTML+=E;}this._consoleMsgCount++;this._lastTime=N.time.getTime();}}};YAHOO.widget.LogReader.prototype._onCategoryCreate=function(D,C,A){var B=C[0];A._categoryFilters.push(B);if(A._elFt){A._createCategoryCheckbox(B);}};YAHOO.widget.LogReader.prototype._onSourceCreate=function(D,C,A){var B=C[0];A._sourceFilters.push(B);if(A._elFt){A._createSourceCheckbox(B);}};YAHOO.widget.LogReader.prototype._onCheckCategory=function(A,B){var C=this.category;if(!this.checked){B.hideCategory(C);}else{B.showCategory(C);}};YAHOO.widget.LogReader.prototype._onCheckSource=function(A,B){var C=this.source;if(!this.checked){B.hideSource(C);}else{B.showSource(C);}};YAHOO.widget.LogReader.prototype._onClickCollapseBtn=function(A,B){if(!B.isCollapsed){B.collapse();}else{B.expand();}};YAHOO.widget.LogReader.prototype._onClickPauseBtn=function(A,B){if(!B.isPaused){B.pause();}else{B.resume();}};YAHOO.widget.LogReader.prototype._onClickClearBtn=function(A,B){B.clearConsole();};YAHOO.widget.LogReader.prototype._onNewLog=function(D,C,A){var B=C[0];A._buffer.push(B);if(A.logReaderEnabled===true&&A._timeout===null){A._timeout=setTimeout(function(){A._printBuffer();},A.outputBuffer);}};YAHOO.widget.LogReader.prototype._onReset=function(C,B,A){A._filterLogs();};if(!YAHOO.widget.Logger){YAHOO.widget.Logger={loggerEnabled:true,_browserConsoleEnabled:false,categories:["info","warn","error","time","window"],sources:["global"],_stack:[],maxStackEntries:2500,_startTime:new Date().getTime(),_lastTime:null,_windowErrorsHandled:false,_origOnWindowError:null};YAHOO.widget.Logger.log=function(B,F,G){if(this.loggerEnabled){if(!F){F="info";}else{F=F.toLocaleLowerCase();if(this._isNewCategory(F)){this._createNewCategory(F);}}var C="global";var A=null;if(G){var D=G.indexOf(" ");if(D>0){C=G.substring(0,D);A=G.substring(D,G.length);}else{C=G;}if(this._isNewSource(C)){this._createNewSource(C);}}var H=new Date();var J=new YAHOO.widget.LogMsg({msg:B,time:H,category:F,source:C,sourceDetail:A});var I=this._stack;var E=this.maxStackEntries;if(E&&!isNaN(E)&&(I.length>=E)){I.shift();}I.push(J);this.newLogEvent.fire(J);if(this._browserConsoleEnabled){this._printToBrowserConsole(J);}return true;}else{return false;}};YAHOO.widget.Logger.reset=function(){this._stack=[];this._startTime=new Date().getTime();this.loggerEnabled=true;this.log("Logger reset");this.logResetEvent.fire();};YAHOO.widget.Logger.getStack=function(){return this._stack;};YAHOO.widget.Logger.getStartTime=function(){return this._startTime;};YAHOO.widget.Logger.disableBrowserConsole=function(){YAHOO.log("Logger output to the function debug() has been disabled.");this._browserConsoleEnabled=false;};YAHOO.widget.Logger.enableBrowserConsole=function(){this._browserConsoleEnabled=true;YAHOO.log("Logger output to the function debug() has been enabled.");};YAHOO.widget.Logger.handleWindowErrors=function(){if(!YAHOO.widget.Logger._windowErrorsHandled){if(window.error){YAHOO.widget.Logger._origOnWindowError=window.onerror;}window.onerror=YAHOO.widget.Logger._onWindowError;YAHOO.widget.Logger._windowErrorsHandled=true;YAHOO.log("Logger handling of window.onerror has been enabled.");}else{YAHOO.log("Logger handling of window.onerror had already been enabled.");}};YAHOO.widget.Logger.unhandleWindowErrors=function(){if(YAHOO.widget.Logger._windowErrorsHandled){if(YAHOO.widget.Logger._origOnWindowError){window.onerror=YAHOO.widget.Logger._origOnWindowError;YAHOO.widget.Logger._origOnWindowError=null;}else{window.onerror=null;}YAHOO.widget.Logger._windowErrorsHandled=false;YAHOO.log("Logger handling of window.onerror has been disabled.");}else{YAHOO.log("Logger handling of window.onerror had already been disabled.");}};YAHOO.widget.Logger.categoryCreateEvent=new YAHOO.util.CustomEvent("categoryCreate",this,true);YAHOO.widget.Logger.sourceCreateEvent=new YAHOO.util.CustomEvent("sourceCreate",this,true);YAHOO.widget.Logger.newLogEvent=new YAHOO.util.CustomEvent("newLog",this,true);YAHOO.widget.Logger.logResetEvent=new YAHOO.util.CustomEvent("logReset",this,true);YAHOO.widget.Logger._createNewCategory=function(A){this.categories.push(A);this.categoryCreateEvent.fire(A);};YAHOO.widget.Logger._isNewCategory=function(B){for(var A=0;A<this.categories.length;A++){if(B==this.categories[A]){return false;}}return true;};YAHOO.widget.Logger._createNewSource=function(A){this.sources.push(A);this.sourceCreateEvent.fire(A);};YAHOO.widget.Logger._isNewSource=function(A){if(A){for(var B=0;B<this.sources.length;B++){if(A==this.sources[B]){return false;}}return true;}};YAHOO.widget.Logger._printToBrowserConsole=function(C){if(window.console&&debug){var E=C.category;var D=C.category.substring(0,4).toUpperCase();var G=C.time;var F;if(G.toLocaleTimeString){F=G.toLocaleTimeString();}else{F=G.toString();}var H=G.getTime();var B=(YAHOO.widget.Logger._lastTime)?(H-YAHOO.widget.Logger._lastTime):0;
YAHOO.widget.Logger._lastTime=H;var A=F+" ("+B+"ms): "+C.source+": "+C.msg;debug(A);}};YAHOO.widget.Logger._onWindowError=function(A,C,B){try{YAHOO.widget.Logger.log(A+" ("+C+", line "+B+")","window");if(YAHOO.widget.Logger._origOnWindowError){YAHOO.widget.Logger._origOnWindowError();}}catch(D){return false;}};YAHOO.widget.Logger.log("Logger initialized");}YAHOO.register("logger",YAHOO.widget.Logger,{version:"2.5.0",build:"895"});/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.8.0r4
*/
(function(){var l=YAHOO.lang,isFunction=l.isFunction,isObject=l.isObject,isArray=l.isArray,_toStr=Object.prototype.toString,Native=(YAHOO.env.ua.caja?window:this).JSON,_UNICODE_EXCEPTIONS=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_ESCAPES=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,_VALUES=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_BRACKETS=/(?:^|:|,)(?:\s*\[)+/g,_UNSAFE=/^[\],:{}\s]*$/,_SPECIAL_CHARS=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_CHARS={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},UNDEFINED="undefined",OBJECT="object",NULL="null",STRING="string",NUMBER="number",BOOLEAN="boolean",DATE="date",_allowable={"undefined":UNDEFINED,"string":STRING,"[object String]":STRING,"number":NUMBER,"[object Number]":NUMBER,"boolean":BOOLEAN,"[object Boolean]":BOOLEAN,"[object Date]":DATE,"[object RegExp]":OBJECT},EMPTY="",OPEN_O="{",CLOSE_O="}",OPEN_A="[",CLOSE_A="]",COMMA=",",COMMA_CR=",\n",CR="\n",COLON=":",COLON_SP=": ",QUOTE='"';Native=_toStr.call(Native)==="[object JSON]"&&Native;function _char(c){if(!_CHARS[c]){_CHARS[c]="\\u"+("0000"+(+(c.charCodeAt(0))).toString(16)).slice(-4);}return _CHARS[c];}function _revive(data,reviver){var walk=function(o,key){var k,v,value=o[key];if(value&&typeof value==="object"){for(k in value){if(l.hasOwnProperty(value,k)){v=walk(value,k);if(v===undefined){delete value[k];}else{value[k]=v;}}}}return reviver.call(o,key,value);};return typeof reviver==="function"?walk({"":data},""):data;}function _prepare(s){return s.replace(_UNICODE_EXCEPTIONS,_char);}function _isSafe(str){return l.isString(str)&&_UNSAFE.test(str.replace(_ESCAPES,"@").replace(_VALUES,"]").replace(_BRACKETS,""));}function _parse(s,reviver){s=_prepare(s);if(_isSafe(s)){return _revive(eval("("+s+")"),reviver);}throw new SyntaxError("JSON.parse");}function _type(o){var t=typeof o;return _allowable[t]||_allowable[_toStr.call(o)]||(t===OBJECT?(o?OBJECT:NULL):UNDEFINED);}function _string(s){return QUOTE+s.replace(_SPECIAL_CHARS,_char)+QUOTE;}function _indent(s,space){return s.replace(/^/gm,space);}function _stringify(o,w,space){if(o===undefined){return undefined;}var replacer=isFunction(w)?w:null,format=_toStr.call(space).match(/String|Number/)||[],_date=YAHOO.lang.JSON.dateToString,stack=[],tmp,i,len;if(replacer||!isArray(w)){w=undefined;}if(w){tmp={};for(i=0,len=w.length;i<len;++i){tmp[w[i]]=true;}w=tmp;}space=format[0]==="Number"?new Array(Math.min(Math.max(0,space),10)+1).join(" "):(space||EMPTY).slice(0,10);function _serialize(h,key){var value=h[key],t=_type(value),a=[],colon=space?COLON_SP:COLON,arr,i,keys,k,v;if(isObject(value)&&isFunction(value.toJSON)){value=value.toJSON(key);}else{if(t===DATE){value=_date(value);}}if(isFunction(replacer)){value=replacer.call(h,key,value);}if(value!==h[key]){t=_type(value);}switch(t){case DATE:case OBJECT:break;case STRING:return _string(value);case NUMBER:return isFinite(value)?value+EMPTY:NULL;case BOOLEAN:return value+EMPTY;case NULL:return NULL;default:return undefined;}for(i=stack.length-1;i>=0;--i){if(stack[i]===value){throw new Error("JSON.stringify. Cyclical reference");}}arr=isArray(value);stack.push(value);if(arr){for(i=value.length-1;i>=0;--i){a[i]=_serialize(value,i)||NULL;}}else{keys=w||value;i=0;for(k in keys){if(keys.hasOwnProperty(k)){v=_serialize(value,k);if(v){a[i++]=_string(k)+colon+v;}}}}stack.pop();if(space&&a.length){return arr?OPEN_A+CR+_indent(a.join(COMMA_CR),space)+CR+CLOSE_A:OPEN_O+CR+_indent(a.join(COMMA_CR),space)+CR+CLOSE_O;}else{return arr?OPEN_A+a.join(COMMA)+CLOSE_A:OPEN_O+a.join(COMMA)+CLOSE_O;}}return _serialize({"":o},"");}YAHOO.lang.JSON={useNativeParse:!!Native,useNativeStringify:!!Native,isSafe:function(s){return _isSafe(_prepare(s));},parse:function(s,reviver){return Native&&YAHOO.lang.JSON.useNativeParse?Native.parse(s,reviver):_parse(s,reviver);},stringify:function(o,w,space){return Native&&YAHOO.lang.JSON.useNativeStringify?Native.stringify(o,w,space):_stringify(o,w,space);},dateToString:function(d){function _zeroPad(v){return v<10?"0"+v:v;}return d.getUTCFullYear()+"-"+_zeroPad(d.getUTCMonth()+1)+"-"+_zeroPad(d.getUTCDate())+"T"+_zeroPad(d.getUTCHours())+COLON+_zeroPad(d.getUTCMinutes())+COLON+_zeroPad(d.getUTCSeconds())+"Z";},stringToDate:function(str){var m=str.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{3}))?Z$/);if(m){var d=new Date();d.setUTCFullYear(m[1],m[2]-1,m[3]);d.setUTCHours(m[4],m[5],m[6],(m[7]||0));return d;}return str;}};YAHOO.lang.JSON.isValid=YAHOO.lang.JSON.isSafe;})();YAHOO.register("json",YAHOO.lang.JSON,{version:"2.8.0r4",build:"2446"});
if(!YAHOO.ULT){YAHOO.ULT={};}
if(!YAHOO.ULT.CONF){YAHOO.ULT.CONF={};}
if(!YAHOO.ULT.BEACON){YAHOO.ULT.BEACON="http://geo.yahoo.com/t";}
if(!YAHOO.ULT.DOMAIN){YAHOO.ULT.DOMAIN=".yahoo.com";}
if(!YAHOO.ULT.IMG){YAHOO.ULT.IMG=new Image();}
if(typeof(YAHOO.ULT.DEBUG)==="undefined"){YAHOO.ULT.DEBUG=0;}
YAHOO.ULT.DELIMITERS={'/':'P',';':'1','?':'P','&':'1','#':'P'};(function(){var YLT=YAHOO.ULT;YLT.set_href=function(el,data,keyname){if(data.html){el.href=data[keyname];el.innerHTML=data.html;}else{el.href=data[keyname];}};YLT.strip_rd=function(u,data){var idx=u.indexOf('/**');if(idx!=-1){data.clean=u.substr(idx+3);data.clean=decodeURIComponent(data.clean);}
return data;};YLT.strip=function(u){var delims=YLT.DELIMITERS;var data={url:u,clean:'',cookie:'',keys:[]};var idx=0;while(u.indexOf('_yl',idx)!=-1){var start=u.indexOf('_yl',idx);if(idx<start){data.clean+=u.slice(idx,start-1);}
idx=start+3;if(delims[u.charAt(start-1)]&&u.charAt(start+4)==='='){data.ult=1;var key="_yl"+u.charAt(start+3);var value="";for(start=start+5;start<u.length&&!delims[u.charAt(start)];start++){value+=u.charAt(start);}
data.keys.push(key);data[key]=value;if(key!='_ylv'){data.cookie+="&"+key+"="+value;}
if(delims[u.charAt(start)]&&delims[u.charAt(start)]=='P'){data.clean+=u.charAt(start);}
idx=start+1;}else{data.clean+=u.slice(start-1,idx);}}
if(data.ult){data.cookie=data.cookie.substr(1);data.clean+=u.substr(idx);YLT.strip_rd(u,data);}
return data;};YLT.clnclk=function(e,data){var el=e.target||e.srcElement;if(data._ylv==3){var cook="D="+data.cookie+"; Max-Age=10; Path=/; Domain="+YLT.DOMAIN;document.cookie=cook;}else{var src=YLT.BEACON+"?"+data.cookie+'&t='+Math.random();if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||data.target=="_blank"){}else{YLT.IMG.onerror=YLT.IMG.onload=function(){location=data.clean;};YAHOO.util.Event.preventDefault(e);}
YLT.IMG.src=src;}};YLT.clicked=function(e,data){var el=e.target||e.srcElement;if(el.nodeName!=="A"){if(el.parentNode.nodeName==="A"){el=el.parentNode;}}
if(data._ylv==3){YLT.set_href(el,data,"clean");var cook="D="+data.cookie+"; Max-Age=10; Path=/; Domain="+YLT.DOMAIN;document.cookie=cook;}else if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){}else if(data._ylv==8||data._ylv==9){}else{var src=YLT.BEACON+"?"+data.cookie+'&t='+Math.random();if(data.target=="_blank"){YLT.set_href(el,data,"clean");}else{YLT.IMG.onerror=YLT.IMG.onload=function(){location=data.clean;};YAHOO.util.Event.preventDefault(e);}
YLT.IMG.src=src;}};YLT.revert=function(e,data){var el=e.target||e.srcElement;if(el.nodeName==="A"){YLT.set_href(el,data,"url");}else{if(el.parentNode.nodeName==="A"){el.parentNode.href=data.url;}}};YLT.clean=function(){YLT.isIE=(typeof(ActiveXObject)=='function');if(navigator.userAgent.toLowerCase().indexOf("safari")!=-1){YLT.isSafari=true;}
var el,data,name;for(var i=0;i<document.links.length;i++){el=document.links[i];if(el.className.indexOf('yltasis')!=-1){continue;}
data=YLT.strip(el.getAttribute('href',2));if(!data.ult){continue;}else if(YLT.isSafari&&data._ylv!=3){continue;}
for(name=0;name<data.keys.length;name++){if(data.keys[name]!='_ylv'){delete data[data.keys[name]];}}
delete data.keys;delete data.ult;data.target=el.target;if(YLT.isIE&&(el.innerHTML.indexOf('http')===0||el.className.indexOf('yltiefix')!=-1)){data.html=el.innerHTML;}
YLT.set_href(el,data,"clean");if(YLT.CONF.cleanest){YAHOO.util.Event.addListener(el,'click',YLT.clnclk,data);}else{YAHOO.util.Event.addListener(el,'click',YLT.clicked,data);YAHOO.util.Event.addListener(el,'mousedown',YLT.revert,data);}}};})();
YAHOO.util.Event.onDOMReady(YAHOO.ULT.clean);

Array.prototype.contains = function (obj) {
	return this.indexOf(obj) != -1;
};

Array.prototype.copy = function (obj) {
	return this.concat();
};

Array.prototype.insertAt = function (obj, i) {
	this.splice(i, 0, obj);
};

Array.prototype.insertBefore = function (obj, obj2) {
	var i = this.indexOf(obj2);
	if (i == -1)
		this.push(obj);
	else
		this.splice(i, 0, obj);
};

Array.prototype.removeAt = function (i) {
	this.splice(i, 1);
};

Array.prototype.remove = function (obj) {
	var i = this.indexOf(obj);
	if (i != -1)
		this.splice(i, 1);
};

/* Returns the last element in an array */
Array.prototype.getLast = function (obj) {
    if (this.length > 1) {
        return this[this.length-1];
    } else {
        return false;
    };
};





/**
 ** BIND PROTOTYPES
 */

// Bind a given function to a given object context.
Function.prototype.bind = function(obj) {
    var method = this;
    return function() { return method.apply(obj, arguments); };
}





/**
 ** STRING PROTOTYPES
 */

// Add a whitespace trimming method to String.
String.prototype.trim = function() {
    return this.replace(/^\s*/, "").replace(/\s*$/, "");
}





/*
    forEach, version 1.0
    Copyright 2006, Dean Edwards
    License: http://www.opensource.org/licenses/mit-license.php
*/
// array-like enumeration
if (!Array.forEach) { // mozilla already supports this
    Array.forEach = function(array, block, context) {
        for (var i = 0; i < array.length; i++) {
            block.call(context, array[i], i, array);
        }
    };
}

// generic enumeration
Function.prototype.forEach = function(object, block, context) {
    for (var key in object) {
        if (typeof this.prototype[key] == "undefined") {
            block.call(context, object[key], key, object);
        }
    }
};

// character enumeration
String.forEach = function(string, block, context) {
    Array.forEach(string.split(""), function(chr, index) {
        block.call(context, chr, index, string);
    });
};

// globally resolve forEach enumeration
var forEach = function(object, block, context) {
    if (object) {
        var resolve = Object; // default
        if (object instanceof Function) {
            // functions have a "length" property
            resolve = Function;
        } else if (object.forEach instanceof Function) {
            // the object implements a custom forEach method so use that
            object.forEach(block, context);
            return;
        } else if (typeof object == "string") {
            // the object is a string
            resolve = String;
        } else if (typeof object.length == "number") {
            // the object is array-like
            resolve = Array;
        }
        resolve.forEach(object, block, context);
    }
};





/*
JSONstring v 1.0
copyright 2006 Thomas Frank

This program is free software under the terms of the
GNU General Public License version 2 as published by the Free
Software Foundation. It is distributed without any warranty.


Based on Steve Yen's implementation:
http://trimpath.com/project/wiki/JsonLibrary
*/

JSONstring={
    compactOutput:false,
    includeProtos:false,
    includeFunctions: false,
    detectCirculars:true,
    restoreCirculars:true,
    make:function(arg,restore) {
        this.restore=restore;
        this.mem=[];this.pathMem=[];
        return this.toJsonStringArray(arg).join('');
    },
    toObject:function(x){
        eval("this.myObj="+x);
        if(!this.restoreCirculars || !alert){return this.myObj};
        this.restoreCode=[];
        this.make(this.myObj,true);
        var r=this.restoreCode.join(";")+";";
        eval('r=r.replace(/\\W([0-9]{1,})(\\W)/g,"[$1]$2").replace(/\\.\\;/g,";")');
        eval(r);
        return this.myObj
    },
    toJsonStringArray:function(arg, out) {
        if(!out){this.path=[]};
        out = out || [];
        var u; // undefined
        switch (typeof arg) {
        case 'object':
            this.lastObj=arg;
            if(this.detectCirculars){
                var m=this.mem; var n=this.pathMem;
                for(var i=0;i<m.length;i++){
                    if(arg===m[i]){
                        out.push('"JSONcircRef:'+n[i]+'"');return out
                    }
                };
                m.push(arg); n.push(this.path.join("."));
            };
            if (arg) {
                if (arg.constructor == Array) {
                    out.push('[');
                    for (var i = 0; i < arg.length; ++i) {
                        this.path.push(i);
                        if (i > 0)
                            out.push(',\n');
                        this.toJsonStringArray(arg[i], out);
                        this.path.pop();
                    }
                    out.push(']');
                    return out;
                } else if (typeof arg.toString != 'undefined') {
                    out.push('{');
                    var first = true;
                    for (var i in arg) {
                        if(!this.includeProtos && arg[i]===arg.constructor.prototype[i]){continue};
                        this.path.push(i);
                        var curr = out.length;
                        if (!first)
                            out.push(this.compactOutput?',':',\n');
                        this.toJsonStringArray(i, out);
                        out.push(':');
                        this.toJsonStringArray(arg[i], out);
                        if (out[out.length - 1] == u)
                            out.splice(curr, out.length - curr);
                        else
                            first = false;
                        this.path.pop();
                    }
                    out.push('}');
                    return out;
                }
                return out;
            }
            out.push('null');
            return out;
        case 'unknown':
        case 'undefined':
        case 'function':
            out.push(this.includeFunctions?arg:u);
            return out;
        case 'string':
            if(this.restore && arg.indexOf("JSONcircRef:")==0){
                this.restoreCode.push('this.myObj.'+this.path.join(".")+"="+arg.split("JSONcircRef:").join("this.myObj."));
            };
            out.push('"');
            var a=['\\','\\\\','\n','\\n','\r','\\r','"','\\"'];
            arg+=""; for(var i=0;i<8;i+=2){arg=arg.split(a[i]).join(a[i+1])};
            out.push(arg);
            out.push('"');
            return out;
        default:
            out.push(String(arg));
            return out;
        }
    }
}


var del_text = {

    msgs: {

        // ACTION PANEL
        ACTION_PROMPT_NOSELECTION   : 'Please select the bookmarks you want to $1.',
        ACTION_WARNING_NOSELECTION  : 'Oops! Please select the bookmarks you want to $1 first.',
        ACTION_WARNING_SHARE        : 'share',
        ACTION_WARNING_UNSHARE      : 'no longer want to share',
        ACTION_WARNING_DELETE       : 'delete',
        ACTION_WARNING_REMOVE       : 'remove',
        ACTION_WARNING_ADDTAGS      : 'add tags to',
        ACTION_WARNING_DELTAGS      : 'remove tags from',
        ACTION_WARNING_FORTAGS      : "Warning - you can't assign 'for:' tags using the bulk editor",
        ACTION_CONFIRM_SHARE        : 'Share $1?',
        ACTION_CONFIRM_UNSHARE      : 'Do not share $1?',
        ACTION_CONFIRM_DELETE       : 'Delete $1?',
        ACTION_CONFIRM_DELETE_CONF  : 'Are you sure that you want to delete $1?',
        ACTION_CONFIRM_REMOVE       : 'Remove $1 from your inbox?',
        ACTION_CONFIRM_REMOVE_CONF  : 'Are you sure that you want to remove $1?',
        ACTION_CONFIRM_SURE         : 'Are you sure?',
        ACTION_CONFIRM_ADDTAGS      : 'Add a tag (or tags) to $1.',
        ACTION_CONFIRM_ADDTAGS_TYPE : 'type a tag',
        ACTION_CONFIRM_ADDTAGS_ERR  : 'Please enter a tag',
        ACTION_CONFIRM_DELTAGS      : 'The following tags are common to $1:',
        ACTION_CONFIRM_DELTAGS_CLICK: 'Check the tags you want to remove.',
        ACTION_CONFIRM_DELTAGS_CONF : 'Are you sure you want to remove $2 from $1?',
        ACTION_CONFIRM_DELTAGS_ERR  : 'There are no tags that are common to the bookmarks you have selected.',
        ACTION_CONFIRM_YES          : 'YES',
        ACTION_CONFIRM_NO           : 'NO',
        ACTION_LABEL_SELECTED_BMS   : 'Selected Bookmarks',
        ACTION_LABEL_UNSELECTED_BMS : 'Bookmarks',
        ACTION_LABEL_BULK_EDIT      : 'Bulk edit:',
        ACTION_LABEL_CLOSE          : 'Close',
        ACTION_LABEL_OK             : 'OK',
        ACTION_TITLE_SHARE          : 'Share',
        ACTION_TITLE_UNSHARE        : 'Do Not Share',
        ACTION_TITLE_DELETE         : 'Delete',
        ACTION_TITLE_REMOVE         : 'Remove',
        ACTION_TITLE_ADDTAG         : 'Add Tag',
        ACTION_TITLE_REMOVETAG      : 'Remove Tag',

        // WORD SINGULAR / PLURAL
        SINGULAR_THIS     : 'this',
        PLURAL_THIS       : 'these',
        SINGULAR_TAGS     : 'tag',
        PLURAL_TAGS       : 'tags',
        SINGULAR_BOOKMARK : 'bookmark',
        PLURAL_BOOKMARK   : 'bookmarks',

        // BUTTONS
        BUTTON_OK : 'OK',
        BUTTON_CANCEL : 'Cancel',
        BUTTON_SAVE : 'Save',
        
        // Bookmark messaging
        MSG_ALERT_URL_DANGEROUS : 'Warning Restricted Bookmark. Don\'t Panic!\n\nThis URL may have unexpected or dangerous effects when visited, so Delicious has disabled this link in order to protect your account.\n\nBut if you are sure this bookmark is safe and from a trusted source, there are two ways you can still use it:\n\n1. Add the link to your browser\'s bookmarks.\nOn your bookmarks, right-click (or control-click) the link and choose "Bookmark This Link" or "Add to Favorites"\n\n2. Visit the link manually.\nOn your bookmarks, right-click (or control-click) the link and choose "Copy Link Location" or "Copy Shortcut". Then, paste the URL into your address bar.',
        
        // Network
        TXT_TITLE_EDITCONTACT        : 'Edit User',
        TXT_TITLE_EDITCONTACT_SUB    : 'Select name to display...',
        TXT_LABEL_USERNAME           : 'Username',
        TXT_LABEL_PROFILENAME        : 'Display Name',
        TXT_LABEL_NICKNAME           : 'Nickname',
        TXT_REMOVE_FROM_NETWORK      : 'Remove user',
        TXT_REMOVE_FROM_NETWORK_LINK : 'Remove...',
        TXT_LEARN_ABOUT_NAMES        : 'Learn about names',
        TXT_REMOVE_CONFIRM           : 'Are you sure you want to remove this user from your network?',
        TXT_ERROR_USERNAME_NOTEXIST  : 'This username does not exist.',
        TXT_ERROR_USERNAME_CHECKFAIL : 'Sorry, we had a server problem, please try this again.',

        // Search
        TXT_LABEL_SEARCH_THESE : 'Search these bookmarks',
        TXT_LABEL_SEARCH       : 'Search ',
        TXT_LABEL_SEARCH_DEFAULT : 'Search Delicious',

        // Subscriptions
        TXT_TITLE_EDITSUBS           : 'Edit subscription',
        TXT_LABEL_TAG                : 'Tag',
        TXT_LABEL_SPECIFICUSER       : 'From a specific user',
        TXT_REMOVE_SUBSCRIPTION      : 'Remove subscription',
        TXT_REMOVE_SUBS_CONFIRM      : 'Are you sure you want to remove this subscription?',

        // MISC TEXT
        TXT_ADD_TAG_DESC_ACT : 'Add a tag description',
        TXT_ERROR            : 'Error, please try again later.',
        TXT_LOADING          : 'Loading...',
        TXT_SAVED : 'SAVED',

        // INLINE ERRORs
        TXT_INLINE_EDIT_ERROR   : 'Sorry, there was a temporary problem with editing this bookmark. Please try again.',
        TXT_INLINE_SHARE_ERROR  : 'Sorry, there was a temporary problem sharing this bookmark. Please try again.',
        TXT_INLINE_SAVE_ERROR   : 'Sorry, there was a temporary problem saving this bookmark. Please try again.',
        TXT_INLINE_DELETE_ERROR : 'Sorry, there was a temporary problem deleting this bookmark. Please try again.',
        TXT_INLINE_ERROR        : 'Sorry, there was a temporary problem. Please try again.',

		
        // Settings
        TXT_CHARS_LEFT : 'characters left',
        TXT_CHAR_LEFT : 'character left',
        
        //Error message
        ERR_POST_TITLELENGTH         : 'Titles must be less than 255 characters',
        ERR_POST_NOTELENGTH          : 'Notes must be less than 1000 characters',
        ERR_POST_DEFAULT             : 'Item save failed - please try again.',
        ERR_POST_TAGLENGTH           : 'Tags must be 128 characters or less.',
        ERR_POST_NUMTAGS             : '50 tag limit reached, please concentrate tags.',
        ERR_POST_SHARELENGTH         : 'Message must be 116 characters or less.',
        
        //MP3 player
        TXT_MP3_PLAY                 : 'PLAY',
        TXT_MP3_STOP                 : 'STOP',
        
        // Fresh Feed
        TXT_SHOW_MORE_TWEETS         : 'Show more tweets' 
    },

    imgs: {

    }

};
	
		
	//]]>
</script>
<script data-src="del-opera.js">
	/*<![CDATA[*/
	
	/**
 * YUI Libs
 */
var Dom = YAHOO.util.Dom;
var Evt = YAHOO.util.Event;
var Conn = YAHOO.util.Connect
var AutoComplete  = YAHOO.widget.AutoComplete;

const DEL_UA_STRING = "crbmext";
const XT_VERSION = "0.998";	//other two places: manifest, background.html

/**
 * Root Delicious namespace object
 */
if (typeof(window.Delicious)=='undefined') Delicious = {};
Delicious = function() {

    return {

        // TODO: Switch this on a query string / hostname basis.
        DEBUG: false,
		isChromeExt: false,

        /**
         * Initialize elements on the page
         */
        init: function() {

            // Send any YUI log messages to the browser console (ie. or Firebug)
            if (!YAHOO.env.ua.ie) {
                YAHOO.widget.Logger.enableBrowserConsole();
            }
            
            // If the body has a class of 'debug', turn on debugging.
            if (typeof DELICIOUS_DEBUG != 'undefined' && DELICIOUS_DEBUG == true) {
                //YAHOO.log("DEBUG MODE ON");
                this.DEBUG = true;
            }

            // Catchall block for things to be done upon page load.
            Evt.on(window, 'load', function() {
                // Inject a logging div, if needed.
                if (this.DEBUG && !this.log_reader) {
                    if (!Dom.get(this.LOG_ID)) {
                        var divEl = DIV({'class': 'yui-skin-sam'});                        
                        divEl.appendChild(DIV({'id': this.LOG_ID}));                        
                        document.body.appendChild(divEl);
                    }
                    this.log_reader = new YAHOO.widget.LogReader(this.LOG_ID);
                    this.log_reader.collapse();
                }

                this.log = Delicious.getLogger("Global");
                //this.log("init");

            }, this, true);
        },

        /**
         * Provide a common way to handle logging in context
         */
        LOG_ID: "yui_log",
        getLogger: function(cat) {
          if (Delicious.DEBUG == true) {
            return function(msg, lvl) {
                //YAHOO.log(msg, (lvl || "debug"), "del:"+cat);
            }.bind(this);
          }
          else {
            return function(msg, lvl) {
            }.bind(this);
          }
        },

        EOF : null
    };
}();
Delicious.init();


/**
 ** Simple Configuration setting, storage and retrieval
 */
Delicious.Config = function() {
    _data = {};
    return {
        set: function(key, value) {
            if (key)
                _data[key] = value;
        },
        get: function(key) {
            if (_data[key]) return _data[key];
            else return undefined;
        }, 
        EOF: null
    };
}();


Delicious.OperaUI = (function() {
    return {
        rootNode: false,
		initialized: false,

        init: function() {
			if(this.initialized) return;
            debug('OperaUI.init()');
            this.rootNode = Dom.get('chrome');
            Delicious.isChromeExt = true;
						sendRequest({id: 'pre-flight-check'});
						sendRequest({id: 'page-details'});
						return;
            var bgPage = opera.extension;//.getBackgroundPage();
						//debug('bgPage:\n\n' + _(bgPage).join('\n'));
            //Show last error
            if(DelXT.getLastAddBookmarkStatus() == "true") {
                    
                    return;
            }
						
            //Dom.get('msgs').innerHTML = window.location.href; 
            // Check for page URL and TITLE
						//try {
							
							var pageUrl, pageTitle
							
							//fetch from content script.
							var contentScriptLoaded = false;
							
							bgPage.addEventListener('message'
								,function(e) {
									var response = e.data;
									contentScriptLoaded = true;
									Delicious.OperaUI.getURLDetailsfromServer(response.url, response.title, response.notes);
								}
								,false
							);
						bgPage.postMessage({id: "pageDetails"});
							window.setTimeout(function(event) {
								if(!contentScriptLoaded) {
									Delicious.OperaUI.getURLDetailsfromServer(pageUrl, pageTitle, null);
								}
							}, 200);
							return;
						//} catch (e) { };
						Delicious.OperaUI.getURLDetailsfromServer(pageUrl, pageTitle, null);
        },
        
        getURLDetailsfromServer: function(pageUrl, pageTitle, notes) {
					
					
            var saveUrl = 'http://delicious.com/chromesave?json=1&url='
                            + encodeURIComponent(pageUrl) 
                            +'&title='
                            + encodeURIComponent(pageTitle)
                            +'&src='
                            +DEL_UA_STRING
                            +XT_VERSION;
            // put these values into the form
            Dom.get('url').value = pageUrl;
            Dom.get('title').value = pageTitle;
            // make call to get data
					
            Conn.asyncRequest('GET', saveUrl,
              {
                argument: [saveUrl, pageUrl, pageTitle, notes],
                success:  Delicious.OperaUI.getChromeSuccess,
                failure:  Delicious.OperaUI.getChromeFailure,
                scope: Delicious.OperaUI,
                timeout: 4000
              }
            );  
        },

        getChromeSuccess: function(o) {
            //this.printMsg('Note', 'OperaUI.getChromeSuccess()', 1);
            /*
            // get fetch return
        	//strip off comments if any
        	  var res = o.responseText;
        	 	if(o.responseText && o.responseText.indexOf('<\!\-\-') != -1) {
        	 		res = o.responseText.substr(0, o.responseText.indexOf('<\!\-\-'));
        	 	}
            var results = YAHOO.lang.JSON.parse(res);
			
			// get user login, and fetch AC Data
			var tagsCallback = 'http://feeds.delicious.com/v2/json/tags/'
					+results.login
					+'?callback=Delicious.TagsData.callbackDynamicUserTags'
					+'&private='+results.tagsKey;
			Delicious.UserTagsData.setDynamicTags(tagsCallback);
			var sendCallback = 'http://feeds.delicious.com/v2/json/socialcontacts/'
					+results.login
					+'?callback=Delicious.TagsData.callbackDynamicSocialSend'
					+'&private='+results.socialKey;
			Delicious.UserSendData.setDynamicTags(sendCallback);
			Delicious.TagsData.init();
            */
            // removing loading stuff
            Dom.removeClass('chrome', 'loadingPage');
            var loadingMsg = Dom.get('loadingMsg')
            if (loadingMsg)
                loadingMsg.parentNode.removeChild(loadingMsg);

            // initialize all JS on the page
            Delicious.Opera.init();
            
            // check for login
            if (!results.login) {
                return this.displayLogin();
            };
            
            var addError = false;//turn it to true for testing
            if(addError) {
                Dom.get('titleAction').innerHTML = "Delicious";
                this.displayAddError();
                
                return;
            }
            // print signin name
            var loginName = EM({}, [
                'signed in as ',
                STRONG({}, [results.login])
              ])
            Dom.get('signedInAs').appendChild(loginName);
                        
            // take contents of return, and place on page
            Dom.get('key').value = results.crumb;
            Dom.get('url').value = results.url;
            Dom.get('title').value = results.title;
            if(results.type == "edit") {
                Dom.get('titleAction').innerHTML = "Edit a Bookmark";
                Dom.get('notes').value = results.note;
                Dom.get('tags').value = results.tags;
                if (results.isPrivate)
                    Dom.get('share').checked = true;
            }
            Dom.get('tags').focus();
						
						//if notes are supplied by selecting text on page. put them to notes field. Override exisitng notes
						if(o.argument[3]) {
								Dom.get('notes').value = o.argument[3];
						}
        },
        
        getChromeFailure: function(o) {
            //debug('OperaUI.getChromeFailure()');
            
            // print error message
            this.printMsg('Note', 'We were unable to determine whether or not you have previously saved this bookmark. Please feel free to save this as a new bookmark.', 1); 
            
            // removing loading stuff
            Dom.removeClass('chrome', 'loadingPage');
            var loadingMsg = Dom.get('loadingMsg')
            if (loadingMsg)
                loadingMsg.parentNode.removeChild(loadingMsg);
            Dom.get('tags').focus();
        },
        
        displayLogin: function() {
            var saveFields = Dom.get('saveFields');
            saveFields.innerHTML = '';
            
            //this.printMsg('Login', 'You are not currently signed in.', 1);
            var loginMsg = SPAN({}, [
                'You are not currently logged in.',
                document.createElement('br'),
                document.createElement('br'),
                'Please ',
                A({'id':'loginLink', 'href':'http://delicious.com/login', 'onclick':'window.open("http://delicious.com/login?noui=yes", "authWIndow", "width=800, height=400"); window.close(); return false;'}, 'login'),
                ' and then try saving this page again.'
            ]);
            this.printMsg('Note', loginMsg, 1);
        },
        
        displayAddError: function() {
            var saveFields = Dom.get('saveFields');
            saveFields.innerHTML = '';
            var div = DIV({'class':'Note'}, ['Oops. Your last bookmark was not saved to delicious.com.']);
            Dom.get('msgs').appendChild(div);
        },
        
        printMsg: function(msgType, msgText, isNew) {
            if (isNew)
                Dom.get('msgs').innerHTML = '';
            var message = (YAHOO.lang.isString(msgText)) ? SPAN({}, msgText) : msgText;
            var div = DIV({'class':msgType.toLowerCase()}, [STRONG({},msgType+':'), message]);
            Dom.get('msgs').appendChild(div);
        },
        
        drawForm: function(formHTML) {
            // add text
            this.rootNode.innerHTML = formHTML;
            // initialize all JS on the page
            Delicious.Opera.init();
        },

        EOF: null
    };
})();




/**
 * UI code for Common module pages.
 * @class Delicious.Common
 */
Delicious.Opera = (function() {

    var _registered = {};

    return {
    
        init: function() {
            debug('Delicious.Opera.init()');

            Delicious.Config.set('ACResults', 4);

            // add notes input counter
            this.notesCounter = new Delicious.textareaCounter;
            this.notesCounter.init('notes', 'notescount', 1000);

            // add message input counter
            this.msgCounter = new Delicious.textareaCounter;
            this.msgCounter.init('message', 'messagecount', 116);

            // initialize message editing
            this.MessageEditor = new Delicious.MessageEditor;
            this.MessageEditor.init('message', 'Delicious.Opera.MessageEditor', Delicious.Opera);
            this.setRegisteredObject('message', this.MessageEditor);

            // initialize send editor
            this.SendEditor = new Delicious.TagLines;
            this.SendEditor.init('send', 'Send', 'Delicious.Opera.SendEditor', Delicious.Opera, 12, 6);
            this.setRegisteredObject('send', this.SendEditor);

            // initialize tags editor
            this.TagsEditor = new Delicious.InputTags;
            this.TagsEditor.init('tags', 'Tags', 'Delicious.Opera.TagsEditor', Delicious.Opera);
            this.setRegisteredObject('tags', this.TagsEditor);

            // initialize 'mark private' checkbox
            this.PrivateObj = new Delicious.MarkPrivate;
            this.PrivateObj.init('share', 'Delicious.Opera.PrivateObj', Delicious.Opera);
            this.setRegisteredObject('markprivate', this.PrivateObj);

            // initialize twitter account
            this.TwitterSettings = new Delicious.SendSettings;
            this.TwitterSettings.init('twitter');

            // initialize buzz account
            this.BuzzSettings = new Delicious.SendSettings;
            this.BuzzSettings.init('buzz');

            // save and cancel buttons
            Evt.on('cancel', 'click', this.handleCancel, this, true);
            Evt.on('save', 'click', this.handleSave, this, true);

        },
        
        term: function() {
            // Clear all JS Objects
            this.notesCounter = false;
            this.msgCounter = false;
            this.MessageEditor = false;
            this.SendEditor = false;
            this.TagsEditor = false;
            this.PrivateObj = false;
            this.TwitterSettings = false;
            this.BuzzSettings = false;
            
            // clear registered objects
            _registered = {};

            // clear eventListeners
            // (don't do this to the 'cancel' button, people should still be able to cancel)
            Evt.purgeElement('save');
        },

        handleCancel: function(ev) {
				opera.postError('popup - Opera.handleCancel()');
            Evt.stopEvent(ev);
            window.close();
        },

        handleSave: function(ev) {
		opera.postError('popup - Opera.handleSave()');
            if(ev) {
                Evt.stopEvent(ev);
            }

            // add loading notice
            var saveInput = Dom.get('save');
            var saveBtn = saveInput.parentNode;
            Dom.addClass(saveBtn, 'loading');
            saveInput.value = 'loading' 
            
            // clear JS objects from memory
            this.term();
            
            // make call
            Conn.setForm('saveitem');
//            var fd = Conn._sFormData;
            //chrome.extension.getBackgroundPage().DelXT.handleSave(Dom.get('url').value, fd);
            opera.extension.postMessage({
		id: 'handle-save'
		,url: Dom.get('url').value
		,fd: Conn._sFormData
	});
		
            //window.close();
        },

        callbackSaveSuccess: function(o) {
            if (o.responseText=='true') {
                window.close();
            } else {
                Delicious.OperaUI.drawForm(o.responseText);
            };          
        },

        callbackSaveFailure: function(o) {
            // add loading notice
            var saveInput = Dom.get('save');
            var saveBtn = saveInput.parentNode;
            Dom.removeClass(saveBtn, 'loading');
            saveInput.value = 'save' 
            saveBtn.removeChild(saveInput);
            // print error message
            this.printMsg('Error', 'Sorry, we were unable to save this bookmark. Please try again later', 1); 
        },

       /*
        * OUTSIDE AC callback-funcitons
        */
        ACTagsCallback: function() {
            //debug('Delicious.Opera.ACTagsCallback()');
            var type = 'tag';
            var tag = '';
            try {
                type = arguments[1][2][2];
                tag  = arguments[1][2][0];
            } catch (e) {};
            if (type=='for') {
                if (Delicious.Opera.isRegistered('tags') ) {
                    Delicious.Opera.getRegisteredObject('tags').exeAC(tag);
                };
            };
        },

        ACSendCallback: function() {
            //debug('Delicious.Opera.ACSendCallback()');
            if (Delicious.Opera.isRegistered('send') ) {
                // do post AC stuff
                Delicious.Opera.getRegisteredObject('send').exeAC();
                // clear the onBlur timer, since we have to blur to do this via a mouse-click
                Delicious.Opera.getRegisteredObject('send').blurTimer = false;
                Window.clearTimeout(Delicious.Opera.getRegisteredObject('send').blurTimer);
            };
        },


       /*
        * JS OBJECT REGISTRATION
        */
        isRegistered: function(type) {
            if (_registered[type]) return true;
            else return false;
        },
        setRegisteredObject: function(type, jsObj) {
            _registered[type] = jsObj;
        },
        getRegisteredObject: function(type) {
            if (_registered[type]) return _registered[type];
            else return false;
        },

        EOF: null

    };
})();





if(!YAHOO.ULT){YAHOO.ULT={};}
YAHOO.ULT.BEACON="http://us.brd.yahoo.com/t";
YAHOO.ULT.DOMAIN=".delicious.com";
YAHOO.ULT.CONF={cleanest:1};

Delicious.PageBeacon = function() {

    return {

        beaconSRC: false,

        init: function(beaconSRC) {
            // bail if there's no string here
            if (!beaconSRC) return;
            // store src in object for reference later
            this.beaconSRC = beaconSRC;
            // add eventListener so we launch this thing once everything else is done
            Evt.on(window, 'load', this.wireUpBeacon, this, true);
        },

        wireUpBeacon: function() {
            var parent = Dom.get('beacon');
            var beacon = document.createElement('img');
            beacon.alt = '';
            beacon.src = this.beaconSRC;
            if (parent)
                parent.appendChild(beacon);
        },

        EOF: null
    };
}();





/**
 * A small collection of handy DOM manipulation utilities
 */
Delicious.DOM = function() {

    return {

        /**
         * Given a DOM node, scrape out the text from it and all its children.
         */
        scrapeText: function(node) {
            if (!node) return '';
            if (1 == node.nodeType) {
                var out = '';
                var cn = node.childNodes;
                for (var i=0,child; child=cn[i]; i++)
                    out += this.scrapeText(child);
                return out;
            } else {
                return node.nodeValue;
            }
        },

        escapeHTML: function (str) {
            return (''+str).replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        },

        // See: http://simon.incutio.com/archive/2003/06/15/javascriptWithXML
        createElement: function(el) {
            var self = arguments.callee;
            if (!self.createElement) {
                if (typeof document.createElementNS != 'undefined') {
                    self.createElement = function(el) { return document.createElementNS('http://www.w3.org/1999/xhtml', el); };
                }
                if (typeof document.createElement != 'undefined') {
                    self.createElement = function(el) { return document.createElement(el); };
                }
            }
            return self.createElement(el);
        },

        replaceChildNodes: function(parent, nodes) {
            while(parent.firstChild)
                parent.removeChild(parent.firstChild);
            return this.appendChildNodes(parent, nodes);
        },
        appendChildNodes: function(parent, nodes) {
            for (var i=0; i<nodes.length; i++) {
                var node = nodes[i];
                if (node.nodeType)
                    parent.appendChild(node);
                else if ( (typeof(node) == 'object') && node.length)
                    this.appendChildNodes(parent, node);
                else
                    parent.appendChild(document.createTextNode(''+node));
            }
        },

        /**
         * @fn createDOM(name, attributes, child_nodes)
         */
        createDOM: function(name, attrs, nodes) {
            var elem = null;

            if (YAHOO.env.ua.ie && attrs['name']) {

                // IE hates setting names and making radio buttons via DOM
                // See: http://cf-bill.blogspot.com/2006/03/another-ie-gotcha-dynamiclly-created.html
                // See: http://msdn.microsoft.com/workshop/author/dhtml/reference/properties/name_2.asp
                var tag = '<'+this.escapeHTML(name);
                if (attrs) for (k in attrs) {
                    if (YAHOO.lang.hasOwnProperty(attrs, k) && attrs[k]!==null) {
                        tag += ' '+k+'="'+this.escapeHTML(attrs[k])+'"';
                    }
                }
                tag += ' />';
                elem = document.createElement(tag);

            } else {

                // If no other hack created an element, create one in the usual way.
                elem = this.createElement(name);

                // Update the element with attributes
                if (attrs) for (k in attrs) {
                    if (YAHOO.lang.hasOwnProperty(attrs, k) && attrs[k]!==null) {
                        var v = attrs[k];
                        elem.setAttribute(k, v);
                        if (YAHOO.env.ua.ie && k=='class') {
                            elem.className = v;
                        }
                    }
                }

            }
            if (nodes) this.appendChildNodes(elem, nodes);
            return elem;
        },

        createDOMFunc: function(name) {
            return function(attrs) {
                var nodes = [];
                for (var i=1; i<arguments.length; i++)
                    nodes[nodes.length] = arguments[i];
                return this.createDOM(name, attrs, nodes);
            }.bind(this);
        }

    }

}();

// Generate some shortcut functions for the DOM builder.
forEach([
    'A', 'BUTTON', 'BR', 'CANVAS', 'DIV', 'EMBED', 'FIELDSET', 'FORM', 'H1', 'H2', 'H3',
    'H4', 'H5', 'H6', 'HR', 'IMG', 'INPUT', 'LABEL', 'LEGEND', 'LI', 'OBJECT', 'OL',
    'OPTGROUP', 'OPTION', 'P', 'PARAM', 'PRE', 'SELECT', 'SPAN', 'STRONG', 'EM', 'TABLE',
    'TBODY', 'TD', 'TEXTAREA', 'TFOOT', 'TH', 'THEAD', 'TR', 'TT', 'UL'
], function(n) { window[n] = Delicious.DOM.createDOMFunc(n); });
window.EL = Delicious.DOM.createDOM.bind(Delicious.DOM);






/**
 * At the moment, all this does is handle cookies
 */
Delicious.util = function() {

    return {

        cookies: [],

        init: function() {
            // parse cookies
            this.parseCookies();
        },

        /********************
         ** COOKIE METHODS **
         ********************/
        addCookie: function(name, value, expires) {
            if (expires == 'perm') {
                var _nextYear = new Date();
                _nextYear.setFullYear(_nextYear.getFullYear() +1);
                var expDate = _nextYear.toGMTString();
            } else {
                var expDate = false;
            };
            var _cookieString = name + '=' + value + ';path=/';

            if (expDate != false) {
                _cookieString += ';expires=' + expDate;
            };
            
            // Bug 3133136. Delete old cookie from delicous.com domain
            //Delicious.util.removeCookie(name, 'delicious.com');
            
            document.cookie = _cookieString;
        },

        removeCookie: function(name, domain) {
            if (!domain) {
                domain = 'delicious.com';
            }
            document.cookie = name + '=removed; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain=' + domain;
        },

        getCookie: function(name) {
          return this.cookies[name];
        },

        parseCookies: function() {
          for (var cur = 0; cur < document.cookie.length; )
          {
            var name = '';
            var value = '';

            var delim = document.cookie.indexOf('=', cur);
            var marker = document.cookie.indexOf(';', cur);

            if (marker == -1)
              marker = document.cookie.length;

            if ((delim > marker) || (delim == -1)) {
              name = document.cookie.substring(cur, marker);
            } else {
              name = document.cookie.substring(cur, delim);
              value = document.cookie.substring(delim + 1, marker);
            };

            this.cookies[name] = unescape(value);
            cur = marker + 2;
          }
        },

        /********************
         ** REMOVE LINKS   **
         ********************/
        /*
         * @fn: removeAjaxLinks(links)
         * @description: this prepends "javascript: return false;" statement
         *               to the beginning of each link, to prevent it from
         *               firing on JS-enabled sites. this is really a fallback
         *               method and is only necessary the odd time something
         *               goes wrong with the normal method for supressing links
         */
        removeAjaxLinks: function(links) {
            // if node
            if (links && (links.nodeType && links.nodeName.toLowerCase()=='a')) {
                this.removeThisAjaxLink(links);
            };
            // if String (eg: ID)
            if (YAHOO.lang.isString(links) || !links) {
                link = document.getElementByID(links);
                this.removeThisAjaxLink(link);
            };
            // if array of links
            if (links.length !== undefined) {
                for (var i=0; i<links.length; i++) {
                    this.removeThisAjaxLink(links[i]);
                };
            };
        },

        removeThisAjaxLink: function(link) {
            // make sure we have something to work with
            if (!link || link.nodeName.toLowerCase()!='a') return;
            // replace link with empty return
            if (link.href!='') {
                link.href = 'javascript:return false; '+ link.href;
            };
        },

        EOF:null
    };
}();
Delicious.util.init();





/* USED to Initialize any common UI requirements */
/* this goes here instead of in del-ui.js because it is shared with the popup */
Delicious.Display = function() {

    return {
        init: function() {
            this.wireUpFrameBusting();
            this.wireUpJSEnable();
        },

        // security feature -- no buttons are displayed by default,
        // they must be enabled here in order to work
        wireUpFrameBusting: function() {
            // check to see if we're the top frame
            try {
                if (top.location.hostname != self.location.hostname) {
                    throw 1;
                };
                // we're fine, enable buttons
                Dom.addClass('doc', 'enableButtons');
                Dom.addClass('doc3', 'enableButtons');
            } catch (e) {
               // possible clickjack attack, leave content hidden
            };
        },

        // some CSS needs to know if JS is enabled or not
        wireUpJSEnable: function() {
            // add class 'jsEnabled' to the 'doc3' element
            Dom.addClass('doc', 'jsEnabled');
            Dom.addClass('doc3', 'jsEnabled');
        },

        EOF: null
    };
}();






/**
 * UI code for Common module pages.
 * @class Delicious.Common
 */
Delicious.Common = function() { 

    return {
    
        // Valid bookmark list styles with UI selection hooks
        bookmark_list_styles: [ 'full', 'list', 'grid' ],

        /**
         * @fn init()
         * Initialize elements on the page
         */
        init: function() {
            // Wire up the tag scope nav menu.
            // Evt.onContentReady("tagscopenav", this.wireUpTagScopeNav, this, true);
            
            Evt.onContentReady("siteNotice", this.wireUpSiteNotification, this, true);

            // Catchall block for things to be done upon page load.
            Evt.on(window, 'load', function() {
                
                // Wire up the View actuator (switching views)
                this.wireUpViewSort();

                // Wire up the items per page actuator
                this.wireUpItemsPerPage();

                // Wire up bookmarks shown
                this.wireUpBookmarksShown();

                // Last ditch effort to init tags for autocomplete.
                //if (!Delicious.MagicTags.data_source.data.length)
                //    Delicious.MagicTags.initTags();
                
            }, this, true);

            // Wire up unload event for final cleanup.
            Evt.on(window, 'unload', this.destroy, this, true);
        },

        /**
         * @fn getParamsFromURL
         * Given a URL, pluck off the query parameters in an object.
         */
        getParamsFromURL: function(url) {
            var params = {};
            var qpos = url.indexOf('?');
            if (qpos != -1) {
                var param_str = url.substring(qpos+1);
                var parts = param_str.split('&');
                for (var i=0, part; part=parts[i]; i++) {
                    var name_val = part.split('=');
                    params[name_val[0]] = name_val[1];
                }
            }
            return params;
        },

        /**
         * @fn wireUpTagScopeNav()
         * Wire up the menu and magic box functionality needed by the tag scope nav bar.
        wireUpTagScopeNav: function() {
            // Bail if there's no tag scope nav on the page.
            if (!Dom.get('tagscopenav')) return;

            Evt.on('currscope', 'click', function(ev) {
                Delicious.UI.toggleVisibility('scopechoices');
                return Evt.stopEvent(ev);
            }, this, true);
        },
         */
        
        /**
         * @fn wireUpAlerts()
         * Wire up the close link on alerts.
         */
        wireUpSiteNotification: function() {

            // Bail if there's no alert on the page.
            if (!Dom.get('siteNotice')) return;

            var a = Dom.getElementsByClassName('hideAction', 'a');
            Evt.on(a[0], 'click', this.alertCloseHandler, this, true);
        },
        
        
        /**
         * @fn alertCloseHandler()
         * Hide the display of the alert and cookie the id
         */
        alertCloseHandler: function(ev) {
            var oTrg = Evt.getTarget(ev);
            
            //Move up the dom until we get to the link (rather than the image)
            while (oTrg.id == '') {
                oTrg = oTrg.parentNode;
            }
            
            //Hide the alert box						
            var oTrgDiv = Dom.get('siteNotice');
            oTrgDiv.style.display='none';

            var alert_id = oTrg.id;
            var _currentCookie = document.cookie;

            var ids = Array();
            var pos = _currentCookie.indexOf('del_alerts=');
            if (pos != -1) {
                var start = pos + 11;
                var end = _currentCookie.indexOf(';', start);
                if (end == -1) {
                    end = _currentCookie.length;
                }
                var value = _currentCookie.substring(start, end);
                
                ids = value.split('%2c');
            }
            
            //Add the id of the alert just dismissed to the list
            if (alert_id != '') {            
                ids.push(alert_id);
                
                //If there are already 10 cookies, pop off the first one.
                if (ids.length > 10) {
                    ids.shift();
                }
            
                var idsString = '';
                if (ids.length == 1) {
                    idsString = ids[0];
                }
                else {
                    idsString = ids.join('%2c');
                }
    
                var _nextYear = new Date();
                _nextYear.setFullYear(_nextYear.getFullYear() +1);
    
                var _cookieString = "del_alerts=";
                _cookieString += idsString; 
                _cookieString += "; path=/; domain=delicious.com; expires="+ _nextYear.toGMTString();
                document.cookie = _cookieString;
                
                // Bug 3133136. Delete old cookie from delicous.com domain
                //Delicious.util.removeCookie('del_alerts', 'delicious.com');
            }
            return Evt.stopEvent(ev);

        },
                
        /**
         * When present on the page, open an options list when this is clicked
         */
         wireUpViewSort: function() {
            // make sure we can add event
            if (! Dom.get('sortOpts')) return;
            // add event
            Evt.on("viewact", "click", this.openViewOptions, this, true); 
         },

        /**
         * open view options menu
         */
        openViewOptions: function(ev, obj) {
            // cancel out default behaviour
            Evt.stopEvent(ev)
            // blur out clicked event (removes nasty dotted border in FF)
            var targetObj = Evt.getTarget(ev);
            if (targetObj.blur) targetObj.blur();
            // make changes
            var listOptionsObj = Dom.get('viewlistoptions');
            var onOff = (listOptionsObj.style.display!='block') ? true : false;
            if (listOptionsObj && onOff) {
                listOptionsObj.style.display = 'block';
                window.setTimeout(function() {Evt.on(document.body, 'click', Delicious.Common.globalCloseNav, Delicious.Common, true);}, 100);
            } else {
                listOptionsObj.style.display = 'none';
                Evt.removeListener(document.body, 'click', obj.globalCloseNavs);
            };
        },

        /**
         * Add event for items per page drop down
         */
         wireUpItemsPerPage: function() {
            // make sure we can add event
            if (! Dom.get('bookmark-display')) return;
            // add event
            Evt.on("ippact", "click", this.openItemsPerPage, this, true); 
         },

        /**
         * Add event for bookmarks shown drop down
         */
         wireUpBookmarksShown: function() {
            // make sure we can add event
            if (! Dom.get('bookmarks-shown-list')) return;
            // add event
            Evt.on("bookmarks-shown-button", "click", this.openBookmarksShown, this, true); 
         },

        /**
         * Open items per page drop down
         */
        openItemsPerPage: function(ev, obj) {
            // cancel out default behaviour
            Evt.stopEvent(ev)
            // blur out clicked event (removes nasty dotted border in FF)
            var targetObj = Evt.getTarget(ev);
            if (targetObj.blur) targetObj.blur();
            // make changes
            var listOptionsObj = Dom.get('ipplistoptions');
            var onOff = (listOptionsObj.style.display!='block') ? true : false;
            if (listOptionsObj && onOff) {
                listOptionsObj.style.display = 'block';
                window.setTimeout(function() {Evt.on(document.body, 'click', Delicious.Common.globalCloseNav, Delicious.Common, true);}, 100);
            } else {
                listOptionsObj.style.display = 'none';
                Evt.removeListener(document.body, 'click', obj.globalCloseNavs);
            };
        },        

        /**
         * Open items per page drop down
         */
        openBookmarksShown: function(ev, obj) {
            // cancel out default behaviour
            Evt.stopEvent(ev);
            // blur out clicked event (removes nasty dotted border in FF)
            var targetObj = Evt.getTarget(ev);
            if (targetObj.blur) targetObj.blur();
            // make changes
            var listOptionsObj = Dom.get('bookmarks-shown-list');
            var onOff = (listOptionsObj.style.display!='block') ? true : false;
            if (listOptionsObj && onOff) {
                listOptionsObj.style.display = 'block';
                window.setTimeout(function() {Evt.on(document.body, 'click', Delicious.Common.globalCloseNav, Delicious.Common, true);}, 100);
            } else {
                listOptionsObj.style.display = 'none';
                Evt.removeListener(document.body, 'click', obj.globalCloseNavs);
            };
        },        
        
        globalCloseNav: function(ev, obj) {
            var targetObj = YAHOO.util.Event.getTarget(ev);
            var listOptionsObj = Dom.get('viewlistoptions');
            if (listOptionsObj && targetObj.className.indexOf('listoption-item') < 0 && targetObj.id!='viewlistoptions')  {
                Evt.removeListener(document.body, 'click', obj.globalCloseNavs);
                listOptionsObj.style.display = 'none';
            }
            var listOptionsObj = Dom.get('ipplistoptions');
            if (listOptionsObj && targetObj.className.indexOf('ippoption-item') < 0 && targetObj.id!='ipplistoptions')  {
                Evt.removeListener(document.body, 'click', obj.globalCloseNavs);
                listOptionsObj.style.display = 'none';
            }
            var listOptionsObj = Dom.get('bookmarks-shown-list');
            if (listOptionsObj && targetObj.className.indexOf('bookmarks-shown-item') < 0 && targetObj.id!='bookmarks-shown-list')  {
                Evt.removeListener(document.body, 'click', obj.globalCloseNavs);
                listOptionsObj.style.display = 'none';
            }
        },

        /**
         * Given a url, pull it apart, create a form post from the pieces and submit it
         */
        linkToPostConverter: function(url, targetName) {
            var linkToForm = document.createElement('form');
            linkToForm.method = 'post';
            //split the url into two pieces. form action, and URI
            parts = url.split('?');

            // if the form should be submitted to another window or iframe or frame:
            if (targetName)
                linkToForm.target = targetName;
            
            linkToForm.action = parts[0];

            //Now we need to build up the inputs for the form
            if (parts[1] != null) {
                var inputs = parts[1].split('&');
                if (inputs != null) {
                    for (var i=0; i < inputs.length; i++) {
                        var pieces = inputs[i].split('=');
                        //assuming there are a key and a value, build a hidden input and append to the form
                        if (pieces.length == 2) {
                            var formInput = INPUT({'type':'hidden', 'name':pieces[0], 'value':pieces[1]});
                            linkToForm.appendChild(formInput);
                        }
                    }
                }
            }
            //Submit the form
            document.body.appendChild(linkToForm);
            linkToForm.submit();
        },
        
        isInArray: function(arrayObj, strObj) {
            var isInArray = false;
            for (var i=0; i<arrayObj.length; i++) {
                if (strObj.toLowerCase() == arrayObj[i].toLowerCase()) {
                    isInArray = true;
                    break;
                };
            };
            return isInArray;
        },

        /**
         * Alert message box for dangerous urls
         */
        warnDangerousURL: function(url) {
            alert(del_text.msgs.MSG_ALERT_URL_DANGEROUS);
            return false;
        },        
        
        /**
         * Make sure to release any memory-leaky element references at
         * page-unload.
         */
        destroy: function () {
        },

        EOF:null
    }

}();
Delicious.Common.init();





/**
 * AUTO COMPLETE
 */
Delicious.AutoCompleteManager = function() {
    return {
        ACForms: {},
        add: function(formID, inputID, ACModID, dataSource) {
            // don't add any forms that don't exist
            if (!Dom.get(formID) || !Dom.get(inputID))
                return false;
            // add form
            //YAHOO.log("Adding AutoComplete to input: "+ inputID +" in element: "+formID);
            this.ACForms[ACModID] = new Delicious.AutoComplete();
            this.ACForms[ACModID].init(formID, inputID, ACModID, dataSource);
        },
        get: function(ACModID) {
            if (ACModID && this.ACForms[ACModID] && this.ACForms[ACModID].autoCompleteObj) 
                return this.ACForms[ACModID].autoCompleteObj;
        },
        EOF:null
    };
}();


Delicious.AutoComplete = function() {

    return {

        formID: false,
        formObj: false,
        inputID: false,
        inputObj: false,
        ACResultsModID: false,
        autoCompleteObj: false,

        init: function(formID, inputID, ACResultsModID, tags_dataSource) {
            // store args
            this.formID = formID;
            this.inputID = inputID;
            this.ACResultsModID = ACResultsModID;
            this.formObj = Dom.get(formID);
            this.inputObj = Dom.get(inputID);
            // wire up form
            this.wireUpAutoComplete(tags_dataSource);
        },

        /**
         * @fn wireUpAutoComplete()
         * @description: 
         */
        wireUpAutoComplete: function(tags_dataSource) {
            // draw and initialize AC
            // Inject a div to contain the autocomplete results for magic box.
            this.addtagACMod = DIV({'id':this.ACResultsModID}, []);
            this.inputObj.parentNode.insertBefore(this.addtagACMod, this.inputObj);

            // Hook up the autocomplete code to the magic box.
            this.autoCompleteObj = new AutoComplete(
                this.inputID,
                this.ACResultsModID,
                tags_dataSource,
                {
                    queryDelay : 0.1, //seconds to start parsing
                    prehighlightClassName : "yui-ac-prehighlight",
                    autoHighlight : false,
                    maxResultsDisplayed : 10,
                    useShadow : false,
                    useIFrame : false,
                    typeAhead : false,
                    allowBrowserAutocomplete : false,
                    alwaysShowContainer : false,
                    forceSelection : false,
                    animHoriz : false,
                    animVert : false,
                    delimChar : " "
                }
            );
            // customize the format of all AC list-items
            this.autoCompleteObj.formatResult = function(aResultItem, sQuery) {
                var sCount, sResult, sType, sName;

                //debug('Delicious.AutoComplete.formatResult()');

                // get string
                var sResult = aResultItem[0].replace(/&/, '&amp;');
                sResult = sResult.replace('>', '&gt;');
                sResult = sResult.replace(/</, '&lt;');
                // get count
                if (aResultItem[1])
                    sCount = aResultItem[1];
                else
                    sCount = (aResultItem[2]=='del') ? '0' : '';
                // get name for send
                sName = (aResultItem[3] && (aResultItem[3].toLowerCase() != aResultItem[0].toLowerCase())) ? ' ('+aResultItem[3]+')' : '';
                // get type
                //debug(aResultItem);
                sType = (aResultItem[2]) ? aResultItem[2] : 'tag';

                // highlight the matching part of the tag
                var tagMatchIndex = sResult.toLowerCase().indexOf(sQuery);
                if (tagMatchIndex > -1)
                    var displayTag = this.highlightMatch(sResult, sQuery, tagMatchIndex);
                else
                    var displayTag = sResult;

                // highlight the matching part of the name
                var nameMatchIndex = sName.toLowerCase().indexOf(sQuery);
                if (nameMatchIndex > -1)
                    var displayName = this.highlightMatch(sName, sQuery, nameMatchIndex);
                else
                    var displayName = sName;

                // assemble the string
                var displayName = displayTag + displayName ;

                // draw result
                if (sResult && sCount) {
                    // ONLY USE THIS IF AUTOCOMPLETE LIV IS MODIFIED TO ACCEPT OBJECTS
                    // return SPAN({'class':type}, [ sResult,  STRONG({'class':'numSaves'}, sCount) ]);
                    return '<strong class="'+sType+'">'+ displayName +'<em class="numSaves">'+ sCount +'<\/em><\/strong>';
                };
                if (sResult) {
                    // ONLY USE THIS IF AUTOCOMPLETE DIV IS MODIFIED TO ACCEPT OBJECTS
                    // return SPAN({'class':type}, [ sResult, STRONG({'class':'numSaves'}, '') ]);
                    return '<strong class="'+sType+'">'+ displayName +'<em class="numSaves"><\/em><\/strong>';
                };

                //return document.createTextNode('');
                return '';
            };

            this.autoCompleteObj.highlightMatch = function(full, snippet, matchindex) {
                return full.substring(0, matchindex) +
                    "<b>" +
                    full.substr(matchindex, snippet.length) +
                    "<\/b>" +
                    full.substring(matchindex + snippet.length);
            };

        },

        EOF:null
    };
};






// TODO - place in new OOP style format
Delicious.FormManager = function() {
    return {
        formHandlers: [],
        add: function(inputID, submitID) {
            var counter = this.formHandlers.length;
            this.formHandlers[counter] = new Delicious.FormHandler();
            this.formHandlers[counter].init(inputID, submitID);
        },
        EOF: null
    };
}();

Delicious.FormHandler = function() {
    return {
        inputObj: false,
        submitObj: false,
        defaultVal: false,
        defaultColor: false,

        init: function(inputID, submitID) {
            // get Submit & Input objects from form
            this.submitObj = Dom.get(submitID);
            this.inputObj = Dom.get(inputID);
            if (!this.inputObj)
                return false;

            // get default value of form input
            this.defaultVal   = this.inputObj.value;
            this.defaultColor = this.inputObj.style.color;

            // add event listeners
            Evt.on(this.submitObj,  'click', this.handleClick, this, true);
            Evt.on(this.inputObj, 'focus',  this.handleFocus,  this, true);
        },

        handleClick: function(ev) {
            if (this.inputObj.value == this.defaultVal || this.inputObj.value=='') {
                Evt.stopEvent(ev);
                this.inputObj.value = this.defaultVal;
                this.inputObj.style.color = this.defaultColor;
                Evt.on(this.inputObj, 'focus',  this.handleFocus,  this, true);
            }
        },

        handleFocus: function(ev) {
            this.inputObj.style.color = '#333';
            this.inputObj.value = '';
            Dom.addClass(this.inputObj.parentNode, 'on');
            Evt.removeListener(this.inputObj, 'focus', this.handleFocus);
        },

        EOF:null
    };
};



/**
 * AUTO COMPLETE
 */
Delicious.AutoCompleteManager = function() {
    return {
        ACForms: {},
        add: function(formID, inputID, ACModID, dataSource, callback) {
            //debug('Delicious.AutoCompleteManager.add('+formID+', '+inputID+ ', '+ACModID+', '+ callback +')');
            // don't add any forms that don't exist
            if (!Dom.get(formID) || !Dom.get(inputID))
                return false;
            // add form
            //YAHOO.log("Adding AutoComplete to input: "+ inputID +" in element: "+formID);
            this.ACForms[ACModID] = new Delicious.AutoComplete();
            this.ACForms[ACModID].init(formID, inputID, ACModID, dataSource, callback);
            //debug(this.ACForms);
        },
        get: function(ACModID) {
            //debug('Delicious.AutoCompleteManager.get('+ACModID+')');
            if (ACModID && this.ACForms[ACModID] && this.ACForms[ACModID].autoCompleteObj)
                return this.ACForms[ACModID].autoCompleteObj;
        },
        EOF:null
    };
}();



Delicious.AutoComplete = function() {

    return {

        formID: false,
        formObj: false,
        inputID: false,
        inputObj: false,
        ACModID: false,
        autoCompleteObj: false,

        init: function(formID, inputID, ACModID, tags_dataSource, callback) {
            //debug('Delicious.AutoComplete.init('+formID+', '+inputID+ ', '+ACModID+')');
            // store args
            this.formID = formID;
            this.inputID = inputID;
            this.ACModID = ACModID;
            this.formObj = Dom.get(formID);
            this.inputObj = Dom.get(inputID);
            // wire up form
            this.wireUpAutoComplete(tags_dataSource, callback);
        },

        /**
         * @fn wireUpAutoComplete()
         * @description:
         */
        wireUpAutoComplete: function(tags_dataSource, callback) {
            //debug('wireUpAutoComplete()');
            //debug(callback);
            // draw and initialize AC
            // Inject a div to contain the autocomplete results for magic box.
            this.addtagACMod = DIV({'id':this.ACModID}, []);
            this.inputObj.parentNode.insertBefore(this.addtagACMod, this.inputObj);

            // Hook up the autocomplete code to the magic box.
            this.autoCompleteObj = new AutoComplete(
                this.inputID,
                this.ACModID,
                tags_dataSource,
                {
                    queryDelay : 0.1, //seconds to start parsing
                    prehighlightClassName : "yui-ac-prehighlight",
                    maxResultsDisplayed : Delicious.Config.get('ACResults'),
                    useShadow : false,
                    useIFrame : false,
                    typeAhead : false,
                    allowBrowserAutocomplete : false,
                    alwaysShowContainer : false,
                    forceSelection : false,
                    animHoriz : false,
                    animVert : false,
                    delimChar : " "
                }
            );

            // apply specified callback function on selectEvent completion
            if (this.autoCompleteObj.itemSelectEvent && callback) {
                this.autoCompleteObj.itemSelectEvent.subscribe(callback);
            };
            // customize the format of all AC list-items
            this.autoCompleteObj.formatResult = function(aResultItem, sQuery) {
                var sCount, sResult, sType, sName;

                //debug('Delicious.AutoComplete.formatResult()');

                // get string
                var sResult = aResultItem[0].replace(/&/, '&amp;');
                sResult = sResult.replace('>', '&gt;');
                sResult = sResult.replace(/</, '&lt;');
                // get count
                if (aResultItem[1])
                    sCount = aResultItem[1];
                else
                    sCount = (aResultItem[2]=='del') ? '0' : '';
                // get name for send
                sName = (aResultItem[3] && (aResultItem[3].toLowerCase() != aResultItem[0].toLowerCase())) ? ' ('+aResultItem[3]+')' : '';
                // get type
                //debug(aResultItem);
                sType = (aResultItem[2]) ? aResultItem[2] : 'tag';

                // highlight the matching part of the tag
                var tagMatchIndex = sResult.toLowerCase().indexOf(sQuery);
                if (tagMatchIndex > -1)
                    var displayTag = this.highlightMatch(sResult, sQuery, tagMatchIndex);
                else
                    var displayTag = sResult;

                // highlight the matching part of the name
                var nameMatchIndex = sName.toLowerCase().indexOf(sQuery);
                if (nameMatchIndex > -1)
                    var displayName = this.highlightMatch(sName, sQuery, nameMatchIndex);
                else
                    var displayName = sName;

                // assemble the string
                var displayName = displayTag + displayName ;

                // draw result
                if (sResult && sCount) {
                    // ONLY USE THIS IF AUTOCOMPLETE LIV IS MODIFIED TO ACCEPT OBJECTS
                    // return SPAN({'class':type}, [ sResult,  STRONG({'class':'numSaves'}, sCount) ]);
                    return '<strong class="'+sType+'">'+ displayName +'<em class="numSaves">'+ sCount +'<\/em><\/strong>';
                };
                if (sResult) {
                    // ONLY USE THIS IF AUTOCOMPLETE DIV IS MODIFIED TO ACCEPT OBJECTS
                    // return SPAN({'class':type}, [ sResult, STRONG({'class':'numSaves'}, '') ]);
                    return '<strong class="'+sType+'">'+ displayName +'<em class="numSaves"><\/em><\/strong>';
                };

                //return document.createTextNode('');
                return '';
            };

            this.autoCompleteObj.highlightMatch = function(full, snippet, matchindex) {
                return full.substring(0, matchindex) +
                    "<b>" +
                    full.substr(matchindex, snippet.length) +
                    "<\/b>" +
                    full.substring(matchindex + snippet.length);
            };


        },

        EOF:null
    };
};


Delicious.TagsDataObj = function() {

    var disabled = false;

    return {
        tags_dataSource: false, // tags data, for use in AutoComplete objects
        dynamicTagsURL: false,  // if this is set, it will grab tag data via AJAX, instead of from the DOM
        forceDOMTags: false,    // set this to force the app to use DOM data, instead of dynamic data
        parentNode: 'bd',
        objName: '',

        /**
         * @fn: useDOMTags()
         * @description: set this before init(); if you want the app to force itself to use the DOM
         * tags instead of grabbing via AJAX
         */
        useDOMTags: function() {
            this.forceDOMTags = true;
        },

        /**
         * @fn: setDOMParent()
         * @description: Send this function the ID of the node you wish to cull the list of DOM tags from
         */
        setDOMParent: function(parentNode) {
            this.parentNode = parentNode;
        },

        /**
         * @fn: setDynamicTags()
         * @description: set this before you call init(). It forces tags_dataSource to be fetched via an AJAX call
         * instead of being culled from the DOM.
         */
        setDynamicTags: function(dynamicURL) {
            if (dynamicURL)
                this.dynamicTagsURL = dynamicURL;
        },

        /**
         * @fn: disable()
         * @description: calling this method will disable gathering and storing tags for this object
         */
        disable: function() {
            disabled = true;
        },

        /**
         * @fn: isDisabled()
         * @description: returns false
         */
        isDisabled: function() {
            return disabled;
        },

        /**
         * @fn: isDynamicCall()
         * @description: Checks whether or not the call being made should be dynamic or not (ie. static).
         * If the call has a dynamicTagsURL and has NOT been forced to use DOM Tags, it will return true,
         * and therefore be dynamic.
         */
        isDynamicCall: function() {
            if (this.dynamicTagsURL && !this.forceDOMTags)
                return true;
            else
                return false;
        },

        /** @fn: addTags()
         *  @description: appends tags (MUST be from a dataSource obj) onto this objects
         *  internal dataSource file. First arg is the dataSourceObj, second arg is true | false
         *  depending on whether you want it sorted (true) or not (false).
         *  tagsData is an array of objects = {'tag', 'count', 'type'}
         */
        addTags: function(tagsData, orderTags, dedupe) {
            //debug(this.objName +'.addTags()');
            // make sure we have data to work with
            if (!tagsData || !(tagsData.length>0) ) return;

            // merge with any data currently in dataSource
            if (this.tags_dataSource && this.tags_dataSource.liveData.length > 0) {
                tagsData = tagsData.concat(this.tags_dataSource.liveData);
            };

            // sort
            if (orderTags)
                tagsData.sort(this.tagSort);

            // dedupe
            if (dedupe)
                tagsData = this.dedupeTags(tagsData);

            // create new dataobject
            this.tags_dataSource = new YAHOO.util.LocalDataSource(tagsData); 
            this.tags_dataSource.responseSchema = {fields:["tag", 'count', 'type']}; 
        },

        tagSort: function(x, y) {
            var aNum = x.count*1;
            var bNum = y.count*1;
            var aAlpha = x.tag.toLowerCase();
            var bAlpha = y.tag.toLowerCase();
            // first, try and sort by number
            if (aNum > bNum) {
                return -1;
            } if (aNum < bNum) {
                return 1;
            } else {
                // if the numbers are equal, sort alphabetically
                if (aAlpha > bAlpha) {
                    return 1;
                } if (aAlpha < bAlpha) {
                    return -1;
                } else {
                    return 0
                };
            };
        },


        /**
         * @fn: dedupeTagsInDataSource
         * @description: Ensures that the autocomplete data source contains only unique tags.
         * This method is only ever called internally
         */
        dedupeTags: function(tagsData) {
            //debug(this.objName +'dedupeTags()');

            var t, i=0, tag='', tags_seen={}, new_data=[];
            // make a pass of all the tags
            for (i=0; t=tagsData[i]; i++) {
                tag = t.tag;
                if (tag) {
                    // only push onto array if it isn't there already
                    if (!tags_seen[tag.toLowerCase()]) {
                        tags_seen[tag.toLowerCase()] = 1;
                        new_data.push(t);
                    };
                };
            };
            return new_data;
        },

        /**
         * @fn: countTags()
         * @description: returns a value for how many tags are in the dataObject
         */
        countTags: function() {
            if (this.tags_dataSource && this.tags_dataSource.liveData)
                return this.tags_dataSource.liveData.length;
            else
                return 0;
        },

        EOF: null
    };
};
Delicious.UserTagsData = new Delicious.TagsDataObj;
Delicious.MagicTagsData = new Delicious.TagsDataObj;
Delicious.UserSendData = new Delicious.TagsDataObj;
Delicious.UserTagsData.objName = 'Delicious.UserTagsData';
Delicious.MagicTagsData.objName = 'Delicious.MagicTagsData';
Delicious.UserSendData.objName = 'Delicious.UserSendData';









Delicious.TagsData = function() {

    // vars to decide if we should duplicate calls
    var dynamicCallsAreIdentical = false;
    var domCallsAreIdentical = false;
    var moduleType = 'userposts';

    // we only want to add AC when all timers are complete
    var _timer = {};
    _timer['user'] = 0;
    _timer['send'] = 0;
    _timer['magic'] = 0;

    return {

        areDynamicTagCallsIdentical: function() {
            var magicTagsData='';
            var userTagsData='';
            // need to split calls because callbacks & privacy settings will be different
            if (Delicious.MagicTagsData.dynamicTagsURL)
                magicTagsData = Delicious.MagicTagsData.dynamicTagsURL.split('?callback')[0];
            if (Delicious.UserTagsData.dynamicTagsURL)
                userTagsData = Delicious.UserTagsData.dynamicTagsURL.split('?callback')[0];
            // check if same
            if (magicTagsData == userTagsData) {
                return true;
            }
            return false;
        },

        /**
         * @fn: init()
         * @description: calls various TagsData objects to initialize them. The only reason we do
         * it here is because IF two objects have the same dynamic/DOM data source, there's no need
         * for the fetching -- just copy the data over from one to the other
         */
        init: function(modType) {
            var i=0;

            // this is here just in case we need it later
            moduleType = modType;

            // both data lists are grabbed via the DOM
            domCallsAreIdentical = (
                   !Delicious.MagicTagsData.isDynamicCall() && !Delicious.UserTagsData.isDynamicCall()
               ) ? true : false ;

            // both data lists are Dynamically fetched, and the call is the same
            dynamicCallsAreIdentical = (this.areDynamicTagCallsIdentical()) ? true : false ;

            // Here's the deal with Dynamic Tags: We fetch dynamic tags & names for both AC and Magic Tags.
            // If the dynamic tags for AC & Magic are the same, we mark them identical and only fetch
            // tags & names for the User. The Callback function will handle copying identical User data over
            // to the Magic data object.

            // gather USER TAGS
            if (!Delicious.UserTagsData.isDisabled()) {
                if (Delicious.UserTagsData.isDynamicCall()) {
                    //debug('NOTE: userTags: dynamic');
                    // get dynamically (callback happens onload of these calls)
                    this.getDynamicTags(Delicious.UserTagsData.dynamicTagsURL, 'tags');
                } else {
                    //debug('NOTE: userTags: scrape DOM');
                    // scrape the DOM and store
                    Delicious.UserTagsData.addTags(Delicious.TagsData.gatherDOMTags('m', Delicious.UserTagsData.parentNode), true, true);
                    // callback happens now
                    Evt.onDOMReady(function() {
                        this.addUserTagsAC();
                      }, this, true);
                };
            };

            // gather SEND
            if (!Delicious.UserSendData.isDisabled()) {
                if (Delicious.UserSendData.isDynamicCall()) {
                    //debug('NOTE: sendTags: dynamic');
                    // get dynamically (callback happens onload of these calls)
                    this.getDynamicTags(Delicious.UserSendData.dynamicTagsURL, 'send');
                } else {
                    //debug('NOTE: sendTags: scrape DOM');
                    // scrape the DOM and store
                    Delicious.UserSendData.addTags(Delicious.TagsData.gatherDOMTags('m-for', Delicious.UserSendData.parentNode), true, true);
                    // callback happens now
                    Evt.onDOMReady(function() {
                        this.addUserSendAC();
                      }, this, true);
                };
            };

            // gather MAGIC TAGS
            if (!Delicious.MagicTagsData.isDisabled()) {
                if (Delicious.MagicTagsData.isDynamicCall()) {
                    // get dynamically (callback happens onload of these calls)
                    if (dynamicCallsAreIdentical) {
                        // this is usually done in getDynamicTags(), but since we're not calling that...
                        if (Delicious.UserTagsData.dynamicTagsURL)
                            this.addTimer('magic');
                    } else {
                        this.getDynamicTags(Delicious.MagicTagsData.dynamicTagsURL, 'magic');
                    };
                } else {
                    // scrape the DOM and store
                    if (domCallsAreIdentical) {
                        //debug('NOTE: MagicTags should just use UserTags');
                        // they're the same as for UserTags, just use those
                        Delicious.MagicTagsData.addTags(Delicious.UserTagsData.tags_dataSource.liveData, false, false);
                    } else {
                        //debug('NOTE: magicTags: scrape DOM');
                        // nope, we actually have to scrape the DOM
                        Delicious.MagicTagsData.addTags(Delicious.TagsData.gatherDOMTags('m', Delicious.MagicTagsData.parentNode), true, true);
                        Delicious.MagicTagsData.addTags(Delicious.TagsData.gatherDOMTags('m-name', Delicious.MagicTagsData.parentNode), true, true);
                    };
                    // callback happens now
                    Delicious.MagicTags.init();
                };
            };
        },


        /**
         * @fn: gatherDOMTags()
         * @description: Fetches tags for autocomplete from the DOM.  This is done by finding all elements
         * with class <nodeClassName> within <parentNode> and lifting out the tags listed there.
         */
        gatherDOMTags: function(nodeClassName, parentNode) {
            //debug('Delicious.TagData.gatherDOMTags("'+nodeClassName +'")');
            var tag, type, tmpCount, count, ele, i, isFor;
            var tags = [];

            // make sure we have a root node to work with
            if (!Dom.get(parentNode))
                parentNode = '';

            // get tags
            var nodes = Dom.getElementsByClassName(nodeClassName, '', parentNode);
            //debug(nodes);
            if (!nodes.length>0) return;

            // go through each tag, and put each tag into this.data_source.data;
            for (ele,i=0; ele=nodes[i]; i++) {
                if (ele.innerHTML) {
                    type = 'tag';
                    if (nodeClassName == 'm') {
                        tag = ele.getAttribute('title').trim();
                        // strip any sub-nodes
                        if (tag.lastIndexOf('(')>-1) {
                            tag = tag.split('(')[0];
                        };
                        // for tag stuff
                        //isFor = (tag.substr(0, 4)=='for:') ? 1 : 0;
                        if (Dom.hasClass(ele, 'for')) {
                            type = 'for';
                            tag = 'for:'+tag;
                        };
                    } else if (nodeClassName == 'm-name') {
                        tag = (ele.getAttribute('title').trim());
                    } else {
                        tag = (ele.getAttribute('title').trim());
                        type = 'del';
                        if (Dom.hasClass(ele, 'm-for-email')) type = 'email';
                        if (Dom.hasClass(ele, 'm-for-twitter')) type = 'twitter';
                    };
                    //debug(tag);
                    tmpCount = ele.getElementsByTagName('em');
                    count = (tmpCount && tmpCount.length>0 && tmpCount[0]) ? tmpCount[0].innerHTML : '';
                    if (tag) tags.push( {'tag':tag, 'count':count, 'type':type} );
                };
            };

            //debug(tags);

            return tags;
        },


        /**
         * @fn: getDynamicTags()
         * @description: fetches tags via scriptNode
         */
        getDynamicTags: function(dynamicTagsURL, userType) {
            //debug('Delicious.TagData.getDynamicTags('+userType+')');
            //debug(dynamicTagsURL);

            if (!dynamicTagsURL) return;
            // set a timer,
            this.addTimer(userType);
            // get script, add as scriptNode
            Evt.onDOMReady(function() {
                //YAHOO.log("Loading tags feed: "+ dynamicTagsURL);
                var scr = document.createElement("script");
                scr.setAttribute("type", "text/javascript");
                scr.setAttribute("src", dynamicTagsURL);
                document.getElementsByTagName("head").item(0).appendChild(scr);
            }, this, true);
        },


        /* ****************************************** *
         * CALLBACK FUNCTIONS FROM DYNAMIC TAGS CALLS *
         * ****************************************** */

        callbackDynamicUserTags: function(tags) {
            //debug('Delicious.TagsData.callbackDynamicUserTags()');
            // add tags, remove the timer, and wireUp AC
            Delicious.UserTagsData.addTags(this.processTagsFeed(tags), true, false);
            this.removeTimer('user');
            this.addUserTagsAC();
            // if these apply to Magic Tags, do the same for them
            if (dynamicCallsAreIdentical) {
                this.callbackDynamicMagicTags(tags);
            };
        },

        callbackDynamicMagicTags: function(tags) {
		    //debug('Delicious.TagsData.callbackDynamicMagicTags()');
            Delicious.MagicTagsData.addTags(this.processTagsFeed(tags), true, false);
            this.removeTimer('magic');
            Delicious.MagicTags.init();
        },

        callbackDynamicSocialSend: function(data) {
            //debug('Delicious.TagsData.callbackDynamicSocialSend()');
            // add tags, remove timer and wireUp AC
            //debug(data);			
            Delicious.UserSendData.addTags(this.processSocialFeed(data), true, false);
            this.removeTimer('send');
            this.addUserSendAC();
        },

        processTagsFeed: function(tags) {
            // go through names, and put them in tag format
            var tag, count, newTags = [], counter=0, type;
            for (var i in tags) {
                //debug(i);
                type = (i.substr(0,4)!=='for:') ? 'tag' : 'for';
                newTags.push( {'tag':i, 'count':tags[i], 'type':type} );
                counter++;
            };
            //debug(newTags);
            return newTags;
        },


        processSocialFeed: function(data) {
            // go through data, and put them in tag format
            var user, newTags = [];
            for (var i in data) {
                user = data[i].user;
                if (!user && data[i].type == 'twitter') {
                    user = '@twitter';
                }
                
                if (user) {
                    newTags.push( {'tag':user, 'count':data[i].count, 'type':data[i].type} );
                };
            };
            return newTags;
        },




        /* ******************************* *
         * START SOME AUTOCOMPLETE OBJECTS *
         * ******************************* */

        addUserTagsAC: function() {
            //debug("*** Delicious.TagData.addUserTagsAC()");
            //debug(Delicious.UserTagsData.tags_dataSource);
            if (Delicious.UserTagsData.countTags() > 0) {
                if (this.checkTimer('user')) {

                    // figure out what object we're using for save stuff
                    var sendObj = false;
                    if (Delicious.Post && Delicious.Post.isRegistered('send')) {
                        sendObj = Delicious.Post;
                    } else if (Delicious.Opera && Delicious.Opera.isRegistered('send')) {
                        sendObj = Delicious.Opera;
                    };

                    // tagBundles AC
                    Delicious.AutoCompleteManager.add(
                          'bundleInput', 
                          'tagsInput', 
                          'magicbox-ac-results', 
                          Delicious.UserTagsData.tags_dataSource
                        );
                    // POST page AC
                    Delicious.AutoCompleteManager.add(
                          'saveitem', 
                          'tags', 
                          'tags-ac-results', 
                          Delicious.UserTagsData.tags_dataSource, 
                          sendObj.ACTagsCallback
                        );
                };
            };
        },

        addUserSendAC: function() {
            //debug("*** Delicious.TagData.addUserSendAC()");
            //debug(Delicious.UserSendData.tags_dataSource);
            if (Delicious.UserSendData.countTags() > 0) {
                if (this.checkTimer('send')) {

                    // figure out what object we're using for save stuff
                    var sendObj = false;
                    if (Delicious.Post && Delicious.Post.isRegistered('send')) {
                        sendObj = Delicious.Post;
                    } else if (Delicious.Opera && Delicious.Opera.isRegistered('send')) {
                        sendObj = Delicious.Opera;
                    };

                    // POST page AC
                    if (sendObj && sendObj.isRegistered('send')) {
                        Delicious.AutoCompleteManager.add(
                            'saveitem', 
                            sendObj.SendEditor.newTagInput.id, 
                            'send-ac-results', 
                            Delicious.UserSendData.tags_dataSource,
                            sendObj.ACSendCallback
                          );
                    };
                };
            };
        },




        /* TIMERS -- we need to use these to make sure all dynamic data
                     is in before we start adding AutoComplete features */

        addTimer: function(userType) {
            _timer[userType] = 1;
        },

        removeTimer: function(userType) {
            _timer[userType] = 0;
        },

        checkTimer: function(userType) {
            if (!_timer[userType]) return true;
            else return false;
        },


        EOF:null
    }
}();



Delicious.MagicTags = function() {

    var _input = false;

    return {

        init: function() {
            //debug('*** Delicious.MagicTags.init()');
            if (Delicious.MagicTagsData.countTags() > 0) {
                Delicious.AutoCompleteManager.add('magicboxform', 'addtag', 'magicbox-ac-results', Delicious.MagicTagsData.tags_dataSource, Delicious.MagicTags.ACCallback);
            };

            _input = Dom.get('addtag');

            Evt.on(_input, 'keyup', this.handleKeyDown, this, true);
        },

        handleKeyUp: function(ev) {
            //debug('Delicious.MagicTags.handleKeyUp()');
            var thisKey = ev.keyCode;

            if (thisKey == 13) {
                window.setTimeout(Delicious.MagicTags.submit, 200);
            };
        },

        ACCallback: function() {
            //debug('Delicious.MagicTags.ACCallback()');
            var type = 'tag';
            var tag = '';
            try {
                type = arguments[1][2][2].trim();
                tag  = arguments[1][2][0].trim();
            } catch (e) {};
            // since we don't know which SEND editor might have just completed, let's just complete them all :)
            _input.value = _input.value.trim();
            if (type == 'for') {
                var inputTags = _input.value.split(' ');
                for (var i=0; i<inputTags.length; i++) {
                    if (inputTags[i].trim() == tag.trim()) {
                        inputTags[i] = tag;
                    };
                };
                _input.value = inputTags.join(' ');
            };
        },

        EOF: null
    };
}();


/**
 * UI code for handling events when user types in the tag input
 * If user types a tag that matches a suggested tag, then we highlight that tag
 * If they start deleting a tag that's already highlighted, we remove the highlighting
 */
Delicious.InputTags = function() {
    return {

        inputObj: false,
        objName: false, 
        objType: false,
        caller: false,
        inlineID: false,

        /** INITIALIZATION STUFF
         ** Args: inputObj: the uniqueID, or Obj for the input field we want to work with
         **       objType:
         **       objName: global namespace 4 this object, use with window calls where we need global names
         **       caller: the JS Obj that called this object
         */
        init: function(inputObj, objType, objName, caller, inlineID) {
            //debug('Delicious.InputTags.init("'+inputObj+'", "'+objType+'", "'+objName+'", "'+inlineID+'")');
            // inputObj can be either object or string
            if (typeof inputObj == "string")
                this.inputObj = Dom.get(inputObj);
            else 
                this.inputObj = inputObj;
            if (!this.inputObj) return;

            // save caller for use later
            this.objName = objName;
            this.objType = objType;
            this.caller = caller;
            this.inlineID = inlineID;

            // handle any existing tags that were pre-populated
            //this.exeSpaceKey();

            // add eventListener
            if (this.caller.isRegistered('suggestions', this.inlineID) || (this.caller.isRegistered('send', this.inlineID))) {
                Evt.on(this.inputObj, 'keyup', this.handleKeyUp, this, true);
            };
        },

        handleKeyUp: function(ev) {
            //debug('Delicious.InputTags.handleKeyUp()');
            // get tags
            var tagsArray = this.getTags();

            // handle suggestions
            if (this.caller.isRegistered('suggestions', this.inlineID)) {
                this.caller.getRegisteredObject('suggestions', this.inlineID).updateTags('tags', tagsArray);
            };

            // if the space key is hit, see if there are any 'send' tags in here
            if (ev && this.caller.isRegistered('send', this.inlineID)) {
                var thisKey = ev.keyCode;
                if (thisKey == 32)   // space key
                    this.exeSpaceKey(tagsArray);
            };
        },

        // this fires on completion on an AutoComplete event
        exeAC: function(tagToLookFor) {
            //debug('Delicious.InputTags.exeAC()');
            window.setTimeout(this.objName + '.exeSpaceKey(false, "'+tagToLookFor+'")', 10);
        },

        // tagToLookFor: this is set if it's from AC from a for: tag
        exeSpaceKey: function(tagsArray, tagToLookFor) {
            //debug('Delicious.InputTags.exeSpaceKey()');
            if (this.caller.isRegistered('send', this.inlineID)) {
                if (!tagsArray)
                    tagsArray = this.getTags();
                this.handleForTags(tagsArray, tagToLookFor);
            };
        },

        // tagToLookFor: this is set if it's from AC from a for: tag
        handleForTags: function(tagsArray, tagToLookFor) {
            //debug('Delicious.InputTags.handleForTags()');
            //debug(tagsArray);
            var cleanArray = [];
            var atLeast1ForTag = false;
            for (var i=0; i<tagsArray.length; i++) {
                if (tagsArray[i].substr(0,4)=='for:') {
                    // add tag to SEND input
                    this.handleForTag(tagsArray[i].substr(4));
                    atLeast1ForTag = true;
                    // remove it from TAGS input
                } else {
                    // check to see if it's a for: tag, just without the "for:" prefix
                    if (tagToLookFor && tagsArray[i] == tagToLookFor) {
                        // add tag to SEND input
                        this.handleForTag(tagsArray[i]);
                        atLeast1ForTag = true;
                    } else {
                        if (tagsArray[i] && tagsArray[i] != ' ') {
                            cleanArray.push(tagsArray[i]);
                        };
                    };
                };
            };
            if (atLeast1ForTag) {
                cleanTags = cleanArray.join(' ');
                this.inputObj.value = cleanTags + ' ';
            };
        },

        handleForTag: function(tag) {
            //debug('Delicious.InputTags.handleForTag('+tag+')');
            this.caller.getRegisteredObject('send', this.inlineID).addTag(tag);
        },

        getTags: function() {
            //debug('Delicious.InputTags.getTags()');
            var tagsValue = this.inputObj.value;
            var tagsArray = [];
            if (tagsValue && tagsValue!=' ') {
                tagsArray = tagsValue.split(' ');
            };
            return tagsArray;
        },

        checkIfTagExists: function(tag) {
            //debug('Delicious.InputTags.checkIfTagExists('+tag+')');
            tag = tag.toLowerCase();
            var currentTags = this.getTags();
            for (var i=0; i<currentTags.length; i++) {
                if (tag == currentTags[i].toLowerCase()) {
                    return true;
                };
            };
            return false;
        },

        /**
         ** TAG ADDING METHODS
         */

        addTag: function(tag) {
            tag = tag;
            //debug('Delicious.InputTags.addTag('+tag+')');
            // get current tags
            var currentTags = this.inputObj.value.trim()
            this.inputObj.value = currentTags +' '+ tag + ' ';
            // update suggestion highlights
            if (this.caller.isRegistered('suggestions', this.inlineID))
                this.caller.getRegisteredObject('suggestions', this.inlineID).highlightTag('tags', tag);
        },

        removeTag: function(tag) {
            tag = tag;
            //debug('Delicious.InputTags.removeTag('+tag+')');
            var cleanTags = [];
            var currentTags = this.getTags();
            for (var i=0; i<currentTags.length; i++) {
                if (tag.toLowerCase()!=currentTags[i].toLowerCase())
                    cleanTags.push(currentTags[i]);
            };
            this.inputObj.value = cleanTags.join(' ');
            // update suggestion highlights
            if (this.caller.isRegistered('suggestions', this.inlineID))
                this.caller.getRegisteredObject('suggestions', this.inlineID).clearTag('tags', tag);
        },

        updateTag: function(tag) {
            tag = tag;
            //debug('Delicious.InputTags.updateTag('+tag+')');
            // check to see if this tag exists
            if (this.checkIfTagExists(tag))
                this.removeTag(tag);
            else
                this.addTag(tag);
            // focus on input
            //this.focus();
        },

        focus: function() {
            if (this.objType != 'bundle') 
                this.inputObj.focus();
        },

        EOF:null
    };
};



/**
 ** UI code for TagLines DHTML interaction
 **/
Delicious.TagLines = function() {
    return {
        // local vars
        objName: false,                 // name of the object, for global window calls
        objType: false,                 // type of tag-chain (tag, share, etc)
        oldTagInput: false,             // the original tag input object
        formRow: false,                 // the parent div in the form that holds all this goodness
        uniqueID: 0,                    // since this is replicated, we need a uniqueID to identify 
        inlineID: false,

        tagInputClass: 'newTagInput',
        tagsClearClass: 'clearNewTags',
        tagInputItemClass: 'newTagInputWrapper',
        tagLinesItemClass: 'newTagItem',
        tagLinesShareItemClass: 'newShareItem',
        tagLinesClass: 'newTagsList tagLines',
        tagLinesEditorClass: 'newTagsEditor',
        formRowClass: 'tagLinesEnabled',

        autoComplete: false,         //  AutoComplete wrapper DIV
        tagsForm: false,             // form object
        newTagInput: false,          // tags field
        tagInputSize: 0,             // tags field
        tagInputUL: false,           // tag form field use to display tags to the user
        tagDelimiterCode: 32,        // tag delimiter
        tagDelimiterCharacter: ' ',  // tag delimiter
        tagsArray: [],               // array of tags
        controlKeyIsDown: false,     // true/false -- used to determine if CNTL is being applied, before the V key (for paste)

        blurTimer: false,            // onBlur actions are delayed
        ACTimer: false,              // AC actions should use a timer

        offset: 0,                   // offset
        
        /**
         ** INITIALIZATION STUFF
         ** Args: inputObj: the DOM id for the input field we want to work with
         **       objType:
         **       objName:  global namespace 4 this object, use with window calls where we need global names
         **       caller:   the JS Obj that called this object
         */
        init: function(inputObj, objType, objName, caller, inlineID, offset) {
            //debug('Delicious.TagLines.init("'+inputObj+'", "'+objType+'", "'+objName+'", [object], "'+inlineID+'", "'+ offset +'")');
            
            // store local vars
            // tagsInput can be either object or string
            if (typeof inputObj == "string")
                inputObj = Dom.get(inputObj);
            //debug(inputObj);
            if (!inputObj) return;
    
            this.oldTagInput = inputObj;

            this.objType = (objType) ? objType : 'Tags';
            this.objName = objName;
            this.caller = caller;
            this.inlineID = inlineID;
            if (offset)
                this.offset = offset;
            
            // get parent div for this form "row"
            this.formRow = this.getFormRow();
            //debug(this.formRow);
            if (!this.formRow) return;

            this.formRowPadding = this.formRow.style.paddingLeft;

            // for when we need a unique ID, generate a rand # between 1,000,000 and 9,999,999
            this.uniqueID = Math.floor(Math.random() * (9999999 - 1000000 + 1)) + 1000000;
            //debug(this.uniqueId);

            // create the HTML for the UI
            this.createUI();

            // resize
            this.resize();

            // prepopulate any tags in the existing tag Input Field, and make new tags out of 'em
            this.prePopulateTags();

        },

        // gets the parentDiv that this tag entry is going to be in
        getFormRow: function() {
            //debug('Delicious.TagLines.getformRow()');
            // can't do this without the oldTagInput Object
            if (!this.oldTagInput)
                return false;

            // loop up through the DOM to find the form row div
            var formRow = this.oldTagInput;
            while (!Dom.hasClass(formRow, 'field')) {
                formRow = formRow.parentNode;
            };

            // add a class, to let CSS know this row is now being used for tagLines display
            Dom.addClass(formRow, this.formRowClass);
            // return obj
            return formRow;
        },

        // this draws the DHTML Tag Editor stuff
        createUI: function() {
            //debug('Delicious.TagLines.createUI()');

            // replace the old tag input with a hidden one 
            // (IE7 bug won't let you change an inputType once it's been created)
            var tmpInput = document.createElement('input');
            tmpInput.type = 'text';
            tmpInput.type = 'hidden'
            tmpInput.name = this.oldTagInput.name;
            tmpInput.id = this.oldTagInput.id;
            tmpInput.classname = this.oldTagInput.className;
            tmpInput.value = this.oldTagInput.value;
            this.formRow.removeChild(this.oldTagInput);
            this.formRow.appendChild(tmpInput);
            this.oldTagInput = tmpInput;

            // create new tag input
            this.newTagInput = document.createElement('input');
              this.newTagInput.name = 'new'+ this.objType;
              this.newTagInput.id = 'new'+this.objType+'Input-'+this.uniqueID;
              this.newTagInput.className = this.tagInputClass;
              this.newTagInput.type = 'text';
              this.newTagInput.value = '';

            // delete all button
            this.clearAll = A({'class':this.tagsClearClass, 'title':'Clear this field'}, [SPAN({}, '(clear)')]);

            // place new tag input into a list-item
            this.newTagItem = LI({'class':this.tagInputItemClass}, this.newTagInput);
            this.newTagsList = UL({'class':this.tagLinesClass}, [this.newTagItem, LI({'class':'clr'}, [])]);
            this.newTagsEditor = DIV({'class':this.tagLinesEditorClass}, [this.newTagsList]);
            this.formRow.appendChild(this.newTagsEditor);
            this.formRow.appendChild(this.clearAll);

            // move info span to end of formRow, REALLY should use one classname for this!
            var infoObj = Dom.getElementsByClassName('info', 'span', this.formRow);
            if (infoObj[0]) {
                this.formRow.removeChild(infoObj[0]);
                this.formRow.appendChild(infoObj[0]);
            };
            var infoObj = Dom.getElementsByClassName('fieldMsg', 'em', this.formRow);
            if (infoObj[0]) {
                this.formRow.removeChild(infoObj[0]);
                this.formRow.appendChild(infoObj[0]);
            };

            // add event listeners
            Evt.on(this.newTagInput, 'keydown',  this.handleKeyDown,  this, true);
            Evt.on(this.newTagInput, 'keyup',    this.handleKeyUp,    this, true);
            Evt.on(this.newTagsList, 'click',    this.handleTagClick, this, true);
            Evt.on(this.clearAll,    'click',    this.handleClearAll, this, true);
            Evt.onBlur(this.newTagInput, this.handleBlur, this, true);
            if (!Delicious.isChromeExt)
                Evt.on(window, 'resize', this.handleResize, this, true);
        },
        
        // takes any tags that are in the original Tag input field, and makes them UI Tags
        prePopulateTags: function() {
            //debug('Delicious.TagLines.prePopulateTags()');
            // grab existing tags, and place in array
            var tagsValue = this.oldTagInput.value;

            // display tags to user
            if (tagsValue && tagsValue!=' ') {
                var tags = tagsValue.split(this.tagDelimiterCharacter);
                // clear field
                this.oldTagInput.value = '';
                // write out tags
                for (var i=0; i<tags.length; i++) {
                    this.addTag(tags[i]);
                };
            };
        },

        


        /**
         ** EVENT HANDLERS
         */

        handleBlur: function(ev) {
            //debug('Delicious.TagLines.handleBlur()');
            this.blurTimer = window.setTimeout(
                    this.objName + '.handleBlurTimer()'
            , 200);
        },

        handleBlurTimer: function(ev) {
            //debug('Delicious.TagLines.handleBlurTimer()');
            if (this.blurTimer) {
                this.exeSpaceKey(ev);
            };
        },

        // listens for a window resize, so we can resize the DHTML display
        handleResize: function(ev) {
            //debug('Delicious.TagLines.handleResize()');
            // set width to 100% again
            this.formRow.style.width = '100%';
            // reset tagEditorWidth
            this.tagEditorWidth = false;
            // resize
            this.resize();
        },

        handleClearAll: function() {
            //debug('Delicious.TagLines.handleClearAll()');
            // remove visible tags
            this.removeAllTags();
            // clear input value
            this.newTagInput.value = '';
            this.newTagInput.focus();
            // clear Tag Suggestions
            if (this.caller.isRegistered('suggestions', this.inlineID)) {
                this.caller.getRegisteredObject('suggestions', this.inlineID).updateTags('send', []);
            };
            // resize
            this.resize();
        },

        // listens for tag entry as well as enter, space, right, tab and control keys
        handleKeyDown: function(ev) {
            //debug('Delicious.TagLines.handleKeyDown()');
            // get key that was clicked
            var thisKey = ev.keyCode;
            this.controlKeyIsDown = false;
            switch (thisKey) {
                case 13:   // enter key
                    if (ev.preventDefault) ev.preventDefault();
                    else ev.returnValue = false;
                    //this.exeAC();
                    break;
                case 32:   // space key
                    if (ev.preventDefault) ev.preventDefault();
                    else ev.returnValue = false;
                    this.exeSpaceKey(ev);
                    break;
                case 39:   // right key
                    //this.exeAC();
                    break;
                case 8:
                    this.exeBackspaceKey(ev);
                    break;
                case 9:   // tab key
                    //this.exeAC();
                    break;
                case 224:  // control key (keep track for cut-and-paste operations)
                    this.controlKeyIsDown = true;
                    break;
            };
        },

        /* listens specifically for the backspace key
        handleKeyPress: function(ev) {
            var thisKey = ev.keyCode;
            //debug('Delicious.TagLines.handleKeyPress('+thisKey+')');
            if (thisKey == 8) {    // backspace key
                this.exeBackspaceKey(ev); 
            }; 
        },
        */

        // listens specifically for the "V" key, when control is already pressed in
        handleKeyUp: function(ev) {
            //debug('Delicious.TagLines.handleKeyUp()');
            var thisKey = ev.keyCode;
            if (thisKey == 86 && this.controlKeyIsDown) {    // paste key 
                this.exeSpaceKey(ev);
            };
        },

        // listens for 'clicks' on completed tags
        handleTagClick: function(ev) {
            //debug('Delicious.TagLines.handleTagClick()');

            // get tag that was clicked
            var target = Evt.getTarget(ev);
            var nodeName = target.nodeName.toLowerCase();

            // don't need to fire things onBlur
            window.clearTimeout(this.blurTimer);
            this.blurTimer = null;

            // delete tag
            if (nodeName=='span' && Dom.hasClass(target, 'rm')) {
                // remove tag
                Evt.stopEvent(ev);
                target = target.parentNode.parentNode;
                var tag = this.getUITagValue(target);
                this.removeTag(target, tag);
                // resize and return
                this.resize();
                return;
            };
            
            // edit tag
            if (nodeName=='em' || nodeName=='a') {
                // edit tag
                Evt.stopEvent(ev);
                target = (nodeName=='em') ? target.parentNode.parentNode : target.parentNode;
                this.editTag(target);
                // resize and return
                //this.resize();
            };
        },




        /**
         ** EXECUTE (based on Event Handlers)
         */

        // execute if backspace key was pressed, via this.handleKeyPress()
        exeBackspaceKey: function() {
            //debug('Delicious.TagLines.exeBackspaceKey()');
            if (this.newTagInput.value=='') {
                this.editTag();
            };
        },

        // runs it the spacebar was pressed, via this.handleKeyDown()
        exeSpaceKey: function(ev) {
            var value = this.newTagInput.value.trim();
            //debug('Delicious.TagLines.exeSpaceKey('+ value +')');

            // make sure latest tag has no spaces in it already (cut & paste error??)
            var tags = value.split(' ');
            // Add tag, and clear value
            for (var i=0; i<tags.length; i++) {
                if (tags[i] && tags[i]!=' ') {
                    this.addTag(tags[i]);
                };
            };

            // clear tag input value
            this.newTagInput.value = '';
        },
        
        // fired by the AutoComplete object, whenever a completion is done
        exeAC: function() {
            //debug('Delicious.TagLines.exeAC()');
            this.ACTimer = window.setTimeout(this.objName + '.exeSpaceKey()', 10)
        },




        /**
         ** TAG ADDING METHODS
         */
        addTag: function(tag) {
            //debug('Delicious.TagLines.addTag('+tag+')');
            
            if (!tag) return;

            // check to see if this is already in the list
            var tagIndex = this.getTagIndexData(tag)
            if (tagIndex > -1 ) {
                this.flashUITag(tagIndex);
                return;
            };

            // add tag to data array
            this.addTagToData(tag);

            // add new tag to UI
            this.addUITag(tag);

            // highlight any suggestions, that match the tag
            if (this.caller.isRegistered('suggestions', this.inlineID)) {
                this.caller.getRegisteredObject('suggestions', this.inlineID).highlightTag('send', tag);
            };

            // resize input field
            this.resize();
        },

        // just an alias
        addOutsideTag: function(tag) {
            //debug('Delicious.TagLines.addOutsideTag('+tag+')');
            this.addTag(tag);
        },

        // EDIT TAGS 
        //selectAll: true,
        editTag: function(tagObj) {
            //debug('Delicious.TagLines.editTag()');
            //debug(tagObj);

            // if there is currently content in the input field, save it as a tag
            if (this.newTagInput.value && this.newTagInput.value!=' ') {
                this.addTag(this.newTagInput.value);
            };

            // if no tag specified, get last tag item instead
            if (!tagObj) {
                tagObj = this.getLastUITag();
            };
            
            // get tag value
            var tag = this.getUITagValue(tagObj);    

            // remove the tag
            this.removeTag(tagObj, tag);
            
            // add the tag        
            if (tag)
                window.setTimeout(this.objName + '.editTagTimeout(\''+tag+'\')', 10);
        },

        // this is in a seperate function because it needs to execute on Timeout after calling editTags()        
        editTagTimeout: function(tag) {
            //debug('Delicious.TagLines.editTagTimeout('+ tag +')');
            this.newTagInput.value = tag;
            this.newTagInput.select();

            this.resize();
        },
        
        removeTag: function(tagObj, tag) {    
            //debug('Delicious.TagLines.removeTag('+tag+')');
            // get tag vlue, if not present
            if (!tag)
                tag = this.getUITagValue(tagObj);
            // remove from YUI
            if (tagObj && tagObj.parentNode)
                tagObj.parentNode.removeChild(tagObj);
            // remove tag from Data
            this.removeTagFromData(tag);
            // highlight any suggestions, that match the tag
            if (this.caller.isRegistered('suggestions', this.inlineID))
                this.caller.getRegisteredObject('suggestions', this.inlineID).clearTag('send', tag);
        },

        removeOutsideTag: function(tag) {
            //debug('Delicious.TagLines.removeOutsideTag('+tag+')');
            var tagObj = this.getUITag(tag);
            this.removeTag(tagObj, tag);
        },
        
        removeAllTags: function(tagObj, tag) {  
            //debug('Delicious.TagLines.removeAllTags()');
            // get tags
            var tags = this.getUITags();
            // hide input, so it doesn't flash to the next line before resize() can get to it
            this.newTagInput.style.display = 'none';
            // remove from UI
            for (var i=0; i<tags.length; i++) {
                // remove visible 
                this.removeTag(tags[i]);
            };
            // update tag data
            this.clearTagData();
            // show the tag input again
            this.newTagInput.style.display = 'block';
            // resize
            this.resize();
        },

        // use this when you don't know whether you're adding or deleting a tag from the line
        // IF the tag is present in the input, delete it. If it is absent, add it
        updateTag: function(tag) {
            //debug('Delicious.TagLines.updateTag('+tag+')');
            // check to see if this tag exists
            tag = (tag.substr(0, 4)=='for:') ? tag.substr(4) : tag;
            //debug(tag);
            var currentTag = this.getUITag(tag)
            //debug(currentTag);
            if (currentTag)
                this.removeTag(currentTag, tag);
            else 
                this.addTag(tag);
            // focus on field
            //this.newTagInput.focus();
        },


        removeAllProviders: function() {
            //debug('Delicious.TagLines.removeAllProviders()');
            // get tags
            var tags = this.getUITags();
            // hide input, so it doesn't flash to the next line before resize() can get to it
            this.newTagInput.style.display = 'none';
            // remove from UI
            var tagValue = '';
            for (var i=0; i<tags.length; i++) {
                tagValue = this.getUITagValue(tags[i]);
                if (tagValue.substr(0, 1) == '@') {
                    this.removeTag(tags[i], tagValue);
                };
            };
            // update tag data
            this.clearTagData();
            // resize
            this.resize();
        },




        /**
        ** TAG-DATA MANAGEMENT
        ** All completed tags are stored in the this.tagsArray array(), as well as the hidden 'tags' input
        **/

        // everytime a tag is added (via spacekey, or AC), the tag is added
        // to this.tagsArray, as well as the hidden 'tags' input
        addTagToData: function(tag) {
            //debug('Delicious.TagLines.addTagToData('+ tag +')');
            // let's only deal with lowercase here
            tag = tag.toLowerCase();
            // add to string
            Dom.addClass(this.oldTagInput, tag);
            this.oldTagInput.value = this.oldTagInput.className;
            // add to array
            this.tagsArray = this.oldTagInput.value.split(' ');
            //debug(this.tagsArray);
        },

        // everytime a tag is deleted (via backspace, or click), the tag is removed
        // from this.tagsArray, as well as the hidden 'tags' input
        removeTagFromData: function(tag) {
            //debug('Delicious.TagLines.removeTagFromData('+ tag +')');
            // let's only deal with lowercase here
            tag = tag.toLowerCase();
            // remove from hidden form field
            Dom.removeClass(this.oldTagInput, tag);
            this.oldTagInput.value = this.oldTagInput.className;
            // remove fom array
            this.tagsArray = this.oldTagInput.value.split(' ');
            //debug(this.tagsArray);
        },
        
        // removes all Tag Data
        clearTagData: function() {
            //debug('Delicious.TagLines.clearTagData()');
            this.tagsArray = [];
            this.oldTagInput.className = '';
            this.oldTagInput.value = '';
        },
        
        // returns the index of the desired tag in this.tagsArray
        getTagIndexData: function(tag) {
            //debug('Delicious.TagLines.getTagIndexData('+tag+')');
            for (var i=0; i<this.tagsArray.length; i++) {
                if (this.tagsArray[i].toLowerCase() === tag.toLowerCase()) {
                    return i;
                };
            };
            return -1;
        },

        // count number of tags currently in data
        countTagData: function() {
            //debug('Delicious.TagLines.countTagData()');
            return this.tagsArray.length;
        },




       /**
        ** TAG-UI MANAGEMENT
        ** Handles accessing, creating and deleting the tags we display in the UI
        **/

        // returns a list of the displayed tags
        getUITags: function() {
            //debug('Delicious.TagLines.getUITags()');
            return Dom.getElementsByClassName(this.tagLinesItemClass ,'li', this.newTagsList);
        },

        // returns the last UI tag obj (used when the user hits the backspace)
        // accepts the 'tagList' arg, simply so you don't have to go fetch these
        // again if you already have it
        getLastUITag: function(tagList) {
            //debug('Delicious.TagLines.getLastUITag()');
            if (!tagList) {
                tagList = this.getUITags();
            };
            var last = tagList.length;
            if (last > 0) {
                return tagList[last-1];
            } else {
                return false;
            }
        },

        // returns a UI tag obj, by tag string (used when a user clicks on a tag)
        getUITag: function(tag) {
            //debug('Delicious.TagLines.getUITag('+tag+')');
            // find out which index the tag is at
            var tagIndex = this.getTagIndexData(tag);
            if (tagIndex < 0) return false;   // make sure this tag actually exists
            // get tag UI object
            var tags = this.getUITags();
            if (tagIndex > tags.length) return false;   // make sure this tagIndex actually exists
            // return whatever we have
            return tags[tagIndex];
        },

        // returns a UI tag obj, by index position
        getUITagByIndex: function(tagIndex) {
            //debug('Delicious.TagLines.getUITagByIndex('+tagIndex+')');
            // get a list of tags
            var tags = this.getUITags();
            if (tagIndex > tags.length) return false;   // make sure this tagIndex is represented by a real tag
            // return whatever is in the right position
            return tags[tagIndex];
        },

        // returns the tag (string) from a tagObj
        getUITagValue: function(tagObj) {
            //debug('Delicious.TagLines.getUITagValue()');
            if (!tagObj) return '';
            var tags = tagObj.getElementsByTagName('em');
            if (!tags || tags.length <1) return '';
            return tags[0].innerHTML.trim();
        },

        // adds a tag to the UI
        addUITag: function(tag) {
            //debug('Delicious.TagLines.addUITag()');
            // determine what class to use, if it's a "share" or "tag" item
            var className = this.tagLinesItemClass;
            if (this.objType=='Send') {
                className +=  ' '+ this.tagLinesShareItemClass;
                
                // If the string is a for: tag, strip for:
                if (tag.substr(0,4)=='for:') {
                    tag = tag.substr(4);
                }
            };
            // create the tag and add it to the DOM
            var tagObj = LI({'class':className}, A({}, [EM({}, tag), SPAN({'class':'rm'}, '')]))
            this.newTagsList.insertBefore(tagObj, this.newTagItem);
        },

        // adds a temporary className to an existing UI tag
        // to give a visual clue that the tag already exists
        flashUITag: function(tagIndex) {
            //debug('Delicious.TagLines.flashUITag('+tagIndex+')');
            var tag = this.getUITagByIndex(tagIndex);
            Dom.addClass(tag, 'flash');
            window.setTimeout(this.objName + '.unFlashUITag('+tagIndex+')', 100)
        },
        
        // removes a temporary className to an existing UI tag
        unFlashUITag: function(tagIndex) {
            //debug('Delicious.TagLines.unFlashUITag('+tagIndex+')');
            var tag = this.getUITagByIndex(tagIndex);
            Dom.removeClass(tag, 'flash');
        },




        /**
         ** RESIZE UI STUFF
         ** Note: This is VERY specific to the CSS being used
         */
        resize: function(tag) {
            //debug('Delicious.TagLines.resize()');

            // first, we need to clear all widths, to allow the elements to auto-flow
            this.formRow.style.width = 'auto';
            this.newTagsEditor.style.width = 'auto';
            this.newTagsList.style.width = 'auto';
            this.newTagItem.style.width = '100px';

            // get the objects we need
            var tagsList = this.getUITags();
            var lastTag = this.getLastUITag(tagsList);

            // tells us how much total room we have to play with
            var formRowWidth = this.getTagEditorWidth();

            // if this is 0, it means the module is closed and we don't need to do it
            if (formRowWidth < 1) return;

            // account for any padding
            var tagEditorWidth = (Delicious.isChromeExt) ? formRowWidth : formRowWidth+4;

            // hard-code in the widths of the parent nodes, so we don't
            // get confused with 100% widths + padding...
            this.formRow.style.width = (formRowWidth) + 'px';
            this.newTagsEditor.style.width = (tagEditorWidth) + 'px';
            this.newTagsList.style.width = (tagEditorWidth-6) + 'px';

            // tells us what line the last tag is on
            var lastTagOffsetWidth, lastTagOffsetLeft;
            if (lastTag) {
                lastTagOffsetWidth = lastTag.offsetWidth;
                lastTagOffsetLeft  = lastTag.offsetLeft;
            } else {
                lastTagOffsetWidth = 0;
                lastTagOffsetLeft  = 0;
            };

            // calculate the remaining space left over
            var remainingWidth = (tagEditorWidth - (lastTagOffsetWidth + lastTagOffsetLeft));
            //debug('remainingWidth: '+ remainingWidth);

            // make a new line if there isn't enough space
            var isNewLine = false;
            if (tagsList.length<1 || remainingWidth < 100) {
                //debug('*** NEW LINE!!!');
                var isNewLine = true;
                remainingWidth = tagEditorWidth;
            };

            // define size of input
            var inputSize = (remainingWidth- this.offset) + 'px';
            this.newTagItem.style.width = inputSize;

            // change AC position
            var ACResults = Dom.get('send-ac-results');
            if (ACResults) {
                if (isNewLine) 
                    ACResults.style.left = '0px';
                else
                    ACResults.style.left = (lastTagOffsetWidth + lastTagOffsetLeft +2)+'px';
            };


            // decide whether to show message field or not
            if (this.caller.isRegistered('message', this.inlineID)) {
                if (tagsList.length > 0) {
                    this.caller.getRegisteredObject('message', this.inlineID).toggleMessage(true);
                } else {
                    this.caller.getRegisteredObject('message', this.inlineID).toggleMessage(false);
                };
            };

            // decide whether to show the clear-all button
            this.clearAll.style.display = (tagsList.length > 0) ? 'block' : 'none';

            // if this is the popup, we need to resize that too:
            if (Delicious.BookmarkletVersion && Delicious.BookmarkletVersion.isActive)
                Delicious.BookmarkletVersion.resize();

        },


        focus: function() {
            this.newTagInput.focus();
        },
        
        //tagEditorWidth: false,
        getTagEditorWidth: function() {
            // simply return value, if user hasn't resized (don't need to calculate every time!)
            return this.formRow.offsetWidth;
        },

        EOF: null
    };
};






/**
 * UI code for Url module pages.
 */
Delicious.Post = function() { 
    //  suggestions, tags, send
    var _registered = {};

    return {

        /**
         * Initialize elements on the page
         */
        init: function() {
            //debug('Delicious.Post.init()');

            // initialize tag/send suggestions
            this.SuggestionsManager = new Delicious.SuggestionsManager;
            this.SuggestionsManager.init('recs', Delicious.Post);
            this.setRegisteredObject('suggestions', this.SuggestionsManager);

            // initialize message editor
            this.MessageEditor = new Delicious.MessageEditor;
            this.MessageEditor.init('messageField', 'Delicious.Post.MessageEditor', Delicious.Post);
            this.setRegisteredObject('message', this.MessageEditor);

            // initialize send editor
            this.SendEditor = new Delicious.TagLines;
            this.SendEditor.init('send', 'Send', 'Delicious.Post.SendEditor', Delicious.Post, 8);
            this.setRegisteredObject('send', this.SendEditor);

            // initialize tags editor
            this.TagsEditor = new Delicious.InputTags;
            this.TagsEditor.init('tags', 'Tags', 'Delicious.Post.TagsEditor', Delicious.Post);
            this.setRegisteredObject('tags', this.TagsEditor);

            // initialize Suggestions Tabbed-Panel support
            this.SuggestionsPanel = new Delicious.SuggestionsPanel;
            this.SuggestionsPanel.init(Delicious.Post);
            this.setRegisteredObject('panel', this.SuggestionsPanel);

            // initialize scrollable panels
            this.ScrollPanel = new Delicious.ScrollPanels;
            this.ScrollPanel.init('sendPanelBd', 'panel-list', 'recs', 'Delicious.Post.ScrollPanel', Delicious.Post);
            this.setRegisteredObject('scrollpanels', this.ScrollPanel);

            // initialize twitter account
            this.TwitterSettings = new Delicious.SendSettings;
            this.TwitterSettings.init('twitter', 'Twitter');

            // initialize 'mark private' checkbox
            this.Private = new Delicious.MarkPrivate;
            this.Private.init('share', 'Delicious.Post.Private', Delicious.Post);
            this.setRegisteredObject('markprivate', this.Private);

            // handle 'cancel' button
            Evt.on('cancel', 'click', this.handleCancelClick, this, true);

            // handle sort controls
            this.Sort = new Delicious.SortSuggestions;
            this.Sort.init();
            this.setRegisteredObject('sort', this.Sort);

            // focus on the tag input
            var tagsObj = Dom.get('tags');
            if (tagsObj && tagsObj.focus)
                tagsObj.focus();

            // add notes input counter
            this.notesCounter = new Delicious.textareaCounter;
            this.notesCounter.init('notes', 'notescount', 1000);

            // add message input counter
            this.msgCounter = new Delicious.textareaCounter;
            this.msgCounter.init('messageField', 'messagecount', 116);

            // bookmarklet delete (BUG #2117179)
            if (Dom.get('popupDelete')) {
                Evt.on('savedon', 'click', this.handleDeleteClick, this, true);
            };
        },

       /*
        * OUTSIDE AC callback-funcitons
        */
        ACTagsCallback: function() {
            //debug('Delicious.Post.ACTagsCallback()');
            var type = 'tag';
            var tag = '';
            try {
                type = arguments[1][2][2];
                tag  = arguments[1][2][0];
            } catch (e) {};
            if (type=='for') {
                if (Delicious.Post.isRegistered('tags') ) {
                    Delicious.Post.getRegisteredObject('tags').exeAC(tag);
                };
            };
        },

        ACSendCallback: function() {
            //debug('Delicious.Post.ACSendCallback()');
            if (Delicious.Post.isRegistered('send') ) {
                // do post AC stuff
                Delicious.Post.getRegisteredObject('send').exeAC();
                // clear the onBlur timer, since we have to blur to do this via a mouse-click
                Delicious.Post.getRegisteredObject('send').blurTimer = false;
                Window.clearTimeout(Delicious.Post.getRegisteredObject('send').blurTimer);
            };
        },


       /*
        * JS OBJECT REGISTRATION
        */
        isRegistered: function(type) {
            if (_registered[type]) return true;
            else return false;
        },
        setRegisteredObject: function(type, jsObj) {
            _registered[type] = jsObj;
        },
        getRegisteredObject: function(type) {
            if (_registered[type]) return _registered[type];
            else return false;
        },

        handleCancelClick: function(ev) {
            if (Evt.getTarget(ev)==Dom.get('cancel') && Dom.get('oldurl').value!='new') {
                Evt.stopEvent(ev);
                history.back();
            };

        },

       /*
        * EVENT HANDLERS
        */
        handleDeleteClick: function(ev) {
            Evt.stopEvent(ev);
            var target = Evt.getTarget(ev);
            // hide actuator
            if (target.id == 'delete') {
                this.handleDelete();
            } else if (target.id == 'deleteconfirm') {
                this.handleDeleteConfirm();
            } else if (target.id == 'deletecancel') {
                this.handleDeleteCancel();
            };
        },

        handleDelete: function() {
            // get confirmation
            Dom.removeClass('deleteconfirmation', 'hidden');
            // hide delete link
            Dom.addClass('delete', 'hidden');
            // hide date
            Dom.addClass('saveMsg', 'hidden'); 
        },

        handleDeleteCancel: function() {
            // get confirmation
            Dom.addClass('deleteconfirmation', 'hidden');
            // hide delete link
            Dom.removeClass('delete', 'hidden');
            // hide date
            Dom.removeClass('saveMsg', 'hidden');
        },

        handleDeleteConfirm: function() {
            // add 'doing something' icon
            Dom.addClass('deleteconfirmation', 'deleting');

            // Grab the item data from the form and package as a JSON string.
            var deleteConf = Dom.get('deleteconfirm');
            var params = Delicious.BookmarkList.getParamsFromURL(deleteConf.href);

            var data_json = JSONstring.make({
                'time': params['time'],
                'key':  params['key'],
                'hash': params['hash'],
                'url':  decodeURIComponent(params['url'])
            });

            // Fire off the AJAX POST with the new bookmark data.
            Conn.asyncRequest('POST', '/ajax/item/delete', {
                argument: [],
                success:  this.handleItemDeleteSuccess,
                failure:  this.handleItemDeleteFailure,
                scope:    this
            }, data_json);
        },

        handleItemDeleteSuccess: function(o) {
            window.close();
        },

        handleItemDeleteFailure: function(o) {
            // get confirmation
            Dom.addClass('deleteconfirmation', 'hidden');
            // hide delete link
            Dom.addClass('delete', 'hidden');
            // hide date
            Dom.removeClass('saveMsg', 'hidden');
            // message user of problem
            alert('there has been an error.\nPlease close this window and try again,\nor delete directly from www.delicious.com.');
            window.close();
        },
       
        EOF: null
	};
}();




    
Delicious.SortSuggestions = function() {
    return {

        sortObj: false,
        sortOptionsObj: false,
        alphaObj: false,
        frequencyObj: false,
        tagsRecObj: false,
        urlStr: '',

        init: function() {
            //debug('Delicious.SortSuggestions.init()');

            this.sortOptionsObj = Dom.get('sortByOptions');
            this.alphaObj = Dom.get('alphaSort');
            this.frequencyObj = Dom.get('frequencySort');
            this.tagsRecObj = Dom.get('tags-rec');

            this.sortObj = Dom.get('sortBy');
            Evt.on(this.sortObj, 'click', this.handleClick, this, true);
        },

        destroy: function() {
            Evt.removeListener(this.sortObj, 'click', this.handleClick);
        },

        handleClick: function(ev) {
            //debug('Delicious.SortSuggestions.handleClick()');
            // prevent link from firing
            Evt.stopEvent(ev);
            // determine which action to take
            var target = Evt.getTarget(ev);
            if (target.nodeName=='A') {
                if (!this.urlStr) {
                    var tmp = target.href.split('?url=');
                    if (tmp[1])
                        this.urlStr = tmp[1];
                };
                // do AJAX sort
                var sortType = (target==this.alphaObj) ? 'alpha' : 'frequency';
                // display 'load' notice
                this.displayLoadMsg();
                // do the sorting
                Conn.asyncRequest('GET', '/ajax/post/getAjaxTags?sort='+ sortType +'&url='+ this.urlStr, {
                    argument: sortType,
                    success:  this.getTagsSuccess,
                    failure:  this.getTagsFailure,
                    scope:    this
                });
            };
        },

        displayLoadMsg: function() {
            this.sortObj.innerHTML = '<p><strong>'+ del_text.msgs.TXT_LOADING +'<\/strong><\/p>';
        },

        getTagsSuccess: function(o) {
            //debug('Delicious.SortSuggestions.getTagsSuccess()');
            // set cookie
            Delicious.util.addCookie('post-sort', o.argument, 'perm');
            // remove existing tags
            if (this.tagsRecObj) {
                this.tagsRecObj.innerHTML = '';
            };
            // remove eventListener
            this.destroy();
            // add new tags
            var text = o.responseText;
            this.tagsRecObj.innerHTML = text;
            // re-init
            this.init();
            // re-init Tag Suggestions & highlighting
            if (Delicious.Post.isRegistered('suggestions')) {
                Delicious.Post.getRegisteredObject('suggestions').init('recs', Delicious.Post);
                if (Delicious.Post.isRegistered('tags'))
                    Delicious.Post.getRegisteredObject('tags').handleKeyUp();
            };
        },

        getTagsFailure: function(o) {
            // display error message
            this.sortObj.innerHTML = '';
            var errMsg = P({'class':'error'}, 'There has been an error sorting your tags. Please try again later.');
            this.sortObj.appendChild(errMsg);
        },

        EOF:null
    };
};



Delicious.SuggestionsPanel = function() {
    return {

        /**
         * Given an element containing tabs, set up the click event handler.
         */
        init: function(caller) {
            this.tagsAct = Dom.get('act-tags-rec');
            this.tagsPanel = Dom.get('tags-rec');
            this.sendAct = Dom.get('act-send-rec');
            this.sendPanel = Dom.get('send-rec');

            this.sendNetworkList = Dom.get('sendNetworkList');

            this.caller = caller;

            // get current 'on' item
            this.currentlyOn = (Dom.hasClass(this.tagsAct.parentNode, 'selected')) ? 'tags' : 'send';

            if (this.caller.isRegistered('tags')) {
                var tagsInput = this.caller.getRegisteredObject('tags').tagsInput;
                Evt.on(tagsInput, 'focus', this.handleTagsFocus, this, true);
            };
            if (this.caller.isRegistered('send')) {
                var sendInput = this.caller.getRegisteredObject('send').newTagInput;
                Evt.on(sendInput, 'focus', this.handleSendFocus, this, true);
            };
            Evt.on('recTabs', 'click', this.handleTabClick, this, true);
            Evt.on('sendNetworkList', 'click', this.handleSendListClick, this, true);

            if (this.caller.isRegistered('tags'))
                this.caller.getRegisteredObject('tags').handleKeyUp();
        },

        handleTagsFocus: function() {
            this.togglePanel('tags');
        },

        handleSendFocus: function() {
            this.togglePanel('send');
        },

        handleTabClick: function(ev) {
            var target = Evt.getTarget(ev);
            Evt.stopEvent(ev);
            if (target == this.tagsAct) {
                this.togglePanel('tags')
            } else {
                this.togglePanel('send');
            };
        },

        togglePanel: function(type) {
            if (type == this.currentlyOn) return;
            if (type == 'tags') {
                this.currentlyOn = 'tags';
                // toggle tabs
                Dom.addClass(this.tagsAct.parentNode, 'selected');
                Dom.removeClass(this.sendAct.parentNode, 'selected');
                // toggle panels
                Dom.addClass(this.sendPanel, 'hidden');
                Dom.removeClass(this.tagsPanel, 'hidden');
                // place focus into tags input
                if (this.caller.isRegistered('tags'))
                    this.caller.getRegisteredObject('tags').focus();
            } else {
                this.currentlyOn = 'send';
                // toggle tabs
                Dom.addClass(this.sendAct.parentNode, 'selected');
                Dom.removeClass(this.tagsAct.parentNode, 'selected');
                // toggle panels
                Dom.addClass(this.tagsPanel, 'hidden');
                Dom.removeClass(this.sendPanel, 'hidden');
                // place focus into tags input
                if (this.caller.isRegistered('send'))
                    this.caller.getRegisteredObject('send').focus();
            };
        },

        handleSendListClick: function(ev) {
            //debug('handleSendListClick()');

            var target = Evt.getTarget(ev);
            Evt.stopEvent(ev);

            // make sure we just clicked on a psuedo-link
            if (!Dom.hasClass(target.parentNode, 'netAct')) return;

            // get ID for this 'link'
            target = target.parentNode;
            var typeID = target.id.substr(7).toLowerCase();
            

            this.toggleNetworkList(target, typeID);

            // move focus back up to SEND field
            if (this.caller.isRegistered('send'))
                this.caller.getRegisteredObject('send').focus();
        },

        toggleNetworkList: function(target, typeID) {
            //debug('toggleNetworkList('+typeID+')');
            // get list of actuators, and hide
            var actuators =  Dom.getElementsByClassName('netAct', 'li', 'sendNetworkList');
            Dom.removeClass(actuators, 'selected');

            // get list of panels, and hide
            var panels =  Dom.getElementsByClassName('sendPanel', 'div', 'sendOptions');
            Dom.removeClass(panels, 'visible');

            // make visible
            Dom.addClass(target, 'selected');
            Dom.addClass(typeID+'SendPanel', 'visible');
        },

        EOF: null
    };
};



/**
 ** This basically keeps track of when users click on suggestions,
 ** as well as turning them on/off via tag/send input 
 */
Delicious.SuggestionsManager = function() {

    /* PRIVATE PROPERTIES & METHODS */
    var _tagData = {};
    var _sendData = {};
    var _activeTags = {};
    var _activeSends = {};

    // this takes an array of suggested tags, 
    // and populates an internal associative array
    // where each tag acts as an array index 
    // (so it's easy to retrieve all suggestions for a specific tag)
    _addAllSuggestions = function(type, suggestions) {
        //debug('Delicious.SuggestionsManager._addAllSuggestions("'+type+'")');
        var data = _getAllSuggestions(type);
        for (var i=0; i<suggestions.length; i++) {
            _addSuggestion(type, suggestions[i], suggestions[i].title.toLowerCase(), data);
        };
        //debug(data);
    };

    // this adds a suggested tag object
    // to an associative array of suggestion
    _addSuggestion = function(type, obj, key, data) {
        if (data[key] && typeof(data[key])!='function') {
            try {
                data[key].push(obj);
            } catch(err) {};
        } else {
            data[key] = [obj];
        };
    };

    // returns the entire array of suggestion 
    // based on type ('tags' or 'send');
    _getAllSuggestions = function(type) {
        var suggestionsArray = (type=='tags') ? _tagData : _sendData;
        return suggestionsArray;
    };

    // gets all the suggested tag objects 
    // for a specific tag
    _getSuggestions = function(type, key) {
        //debug('_getSuggestions("'+type+'", "'+key+'")');
        var data = _getAllSuggestions(type);
        if (data[key]) {
            return data[key];
        } else if (data['for:'+key]) {
            return data['for:'+key];
        } else {
            return [];
        };
    };

    _addActiveSuggestion = function(type, key) {
        //debug('_addActiveSuggestion("'+type+'", "'+key+'")');
        var activeSuggestions = _getActiveSuggestions(type);
        //debug(activeSuggestions);
        activeSuggestions[key] = 1;
        //debug(activeSuggestions);
    };

    _removeActiveSuggestion = function(type, key) {
        //debug('_removeActiveSuggestion("'+type+'", "'+key+'")');
        var activeSuggestions = _getActiveSuggestions(type);
        //debug(activeSuggestions);
        if (activeSuggestions[key])
            delete activeSuggestions[key];
            //debug(activeSuggestions);
    };

    _getActiveSuggestions = function(type) {
        //debug('_getActiveSuggestions("'+type+'")');
        var activeSuggestions = (type=='tags') ? _activeTags : _activeSends;
        var cleanArray = {};
        return activeSuggestions;
    };


    /* PUBLIC PROPERTIES & METHODS */
    return {

        rootObj: false,
        caller: false,

        /**
         ** INITIALIZATION
         */

        init: function(rootNodeID, caller) {
            //debug('Delicious.SuggestionsManager.init("'+rootNodeID+'")');
            this.rootObj = Dom.get(rootNodeID);
            if (!this.rootObj) return;

            // scrape the DOM to get all the visible tags/sends on the page
            var suggestedTags = Dom.getElementsByClassName('m', '', this.rootObj);
            var suggestedSends = Dom.getElementsByClassName('m-for', '', this.rootObj);
  
            this.caller = caller;
           
            // add each tag to the base objects
            _addAllSuggestions('tags', suggestedTags);
            _addAllSuggestions('send', suggestedSends);

            // add eventListeners
            Evt.on(this.rootObj, 'click', this.handleClick, this, true);
        },



        /**
         ** LISTENING TO USER-INTERACTION
         */

        handleClick: function(ev) {
            //debug('Delicious.SuggestionsManager.handleClick()');
            var target = Evt.getTarget(ev);
            // sometimes we use some a SPAN in there
            if (target.nodeName == 'SPAN') 
                target = target.parentNode;
            // cancel out click
            if (Dom.hasClass(target, 'm') || Dom.hasClass(target, 'm-for')) {
                Evt.stopEvent(ev);
                var type = (Dom.hasClass(target, 'm')) ? 'tags' : 'send';
                this.exeTagClick(target, type);
            };
        },

        exeTagClick: function(target, type) {
            var tag = target.title;
            //debug('Delicious.SuggestionsManager.exeTagClick('+tag+', '+ type +')');
            if (type=='tags') 
                this.caller.getRegisteredObject('tags').updateTag(tag);
            else
                this.caller.getRegisteredObject('send').updateTag(tag);
        },




        /**
         ** TAG HIGHLIGHTING
         */

        // this adds highlighting to a tag
        highlightTag: function(type, key) {
            //debug('Delicious.SuggestionsManager.highlightTag('+type+', '+key+')');

            key = key.toLowerCase();
            // do the highlighting
            var suggestions = _getSuggestions(type, key);
            var suggestionToHighlight = false;
            if (!suggestions) return;
            for (var i=0; i<suggestions.length; i++) {
                Dom.addClass(suggestions[i].parentNode, 'on');
                suggestionToHighlight = true;
            };
            // keep track of what's active
            if (suggestionToHighlight)
                _addActiveSuggestion(type, key);
        },

        // this removed the highlighting from any active tags
        clearTag: function(type, key) {
            //debug('Delicious.SuggestionsManager.clearTag('+type+', '+key+')');
            key = key.toLowerCase();
            // clear any highlighting
            var suggestions = _getSuggestions(type, key);
            for (var i=0; i<suggestions.length; i++) {
                Dom.removeClass(suggestions[i].parentNode, 'on');
            };
            // keep track of what's active
            _removeActiveSuggestion(type, key);
        },

        // NOTE: might want to rewrite this.
        // It's less efficient but visually nicer, to only clear
        // the tags you don't want to highlight, and then add it in the
        // ones you DO. But this will do for now.
        updateTags: function(type, keys) {
            //debug('Delicious.SuggestionsManager.updateTags('+type+')');
            // first, clear tags
            var activeSuggestions = _getActiveSuggestions(type);
            for (var i in activeSuggestions) {
                this.clearTag(type, i);
            };
            // second, add tags
            for (var i=0; i<keys.length; i++) {
                 this.highlightTag(type, keys[i]);
            };
        },
 
        EOF: null    
    };
};



Delicious.ScrollPanels = function() {
    return {

        init: function(className, innerClassName, parentObj, objName, caller) {
            //debug('Delicious.ScrollPanels.init()');
            this.parentObj = (typeof parentObj == "string") ? Dom.get(parentObj) : parentObj;
            if (!this.parentObj) return; 

            this.objName = objName;
            this.innerClassName = innerClassName;

            var scrollMods = Dom.getElementsByClassName(className, '', this.parentObj);
            if (scrollMods.length > 0) {
                this.wireUp(scrollMods);
            };
        },

        wireUp: function(scrollMods) {
            //debug('Delicious.ScrollPanels.wireUp()');
            var i, scrollers;
            for (i=0; i<scrollMods.length; i++) {
                scrollers = this.createScrollers();
                Evt.on(scrollers, 'mousedown', this.handleMouseDown, this, true);
                Evt.on(scrollers, 'mouseup', this.handleMouseUp, this, true);
                scrollMods[i].appendChild(scrollers);
            };
        },

        createScrollers: function() {
            var scrollUp = SPAN({'class':'scroll-up'}, []);
            var scrollDown = SPAN({'class':'scroll-down'}, []);
            var scrollArea = DIV({'class':'panel-scrollers'}, [scrollUp, scrollDown]);
            return scrollArea;
        },

        handleMouseDown: function(ev) {
            //debug('Delicious.ScrollPanels.handleMouseDown()');
            this.target = Evt.getTarget(ev);
            Evt.stopEvent(ev);
            // scroll
            this.firedOnce = 0;
            this.scrollMod = this.getScrollMod(this.target);
            this.parent =  this.target.parentNode.parentNode;
            this.maxHeight = -(this.scrollMod.offsetHeight - this.parent.offsetHeight);
            if (Dom.hasClass(this.target, 'scroll-up')) {
                this.scrollAmount = 18;
                this.scroll();
                this.scrollAmount = 5;
                this.timer = window.setTimeout(this.objName + '.handleTimer()', 200);
            } else if (Dom.hasClass(this.target, 'scroll-down')) {
                this.scrollAmount = -18; 
                this.scroll();
                this.scrollAmount = -5;
                this.timer = window.setTimeout(this.objName + '.handleTimer()', 200);
            };
        },

        handleMouseUp: function(ev) {
            //debug('Delicious.ScrollPanels.handleMouseUp()');
            window.clearTimeout(this.timer);
            window.clearInterval(this.interval);
            this.timer = false;
            this.interval = false;
        },

        handleTimer: function() {
           this.interval = window.setInterval(this.objName + '.scroll()', 20);
        },

        scroll: function() {
            if (this.scrollMod) {
                // get current top:
                var currentTop = this.scrollMod.offsetTop;
                var minHeight = 0;
                var proposedTop= currentTop + this.scrollAmount;
                var top = (proposedTop > 0) ? 0 : (proposedTop);
                top = (top < this.maxHeight) ? this.maxHeight : top;
                this.scrollMod.style.top = top + 'px';
            };
        },

        getScrollMod: function() {
            this.firedOnce++;
            var parent = this.target.parentNode.parentNode;
            var scrollMods = Dom.getElementsByClassName(this.innerClassName, '', parent);
            if (scrollMods.length)
                return scrollMods[0];
            else
                return false;
        },

        EOF:null
    };
};


Delicious.SendSettings = function() {
    return {

        prefix: false,
        initialCheckboxState: false,
        checkbox: false,
        buttons: false,
        message: false,

        init: function(prefix, service) {
            //debug('Delicious.SendSettings.init("'+prefix+'")');

            // save which element this is for
            if (!prefix) return false;
            this.prefix = prefix;
            this.service = service;

            // only do this if it's a save dialog
            //debug(Dom.get(prefix+'SendPanel'));
            if (Dom.get(prefix+'SendPanel')) {
                this.initRemember();
                this.initAuth();
            };
        },

        /**
         ** REMEMBER INPUT
         **/
        initRemember: function() {
            //debug('Delicious.SendSettings.initRemember()');

            // initialize vars
            this.form       = Dom.get(this.prefix +'Form');
            this.checkbox   = Dom.get(this.prefix +'PostAll');
            this.label      = Dom.get(this.prefix +'Label');
            this.buttons    = Dom.get(this.prefix +'Bttns');
            this.saveBtn    = Dom.get(this.prefix +'Save');
            this.cancelBtn  = Dom.get(this.prefix +'Cancel');
            this.message    = Dom.get(this.prefix +'Msg');
            this.deleteLink = Dom.get(this.prefix + 'Delete');
            this.contentArea = Dom.get(this.prefix + 'SendStatus');
            if (this.checkbox)
                this.initialCheckboxState = this.checkbox.checked

            // add event listeners
            Evt.on(this.form, 'click', this.handleClick, this, true);
        },

        handleClick: function(ev) {
            //debug('Delicious.SendSettings.handleClick()');
            var target = Evt.getTarget(ev);

            switch (target) {
                case this.saveBtn: this.exeSave(ev); break;
                case this.cancelBtn: this.exeCancel(ev); break;
                case this.deleteLink: this.exeDelete(ev); break;
                case this.checkbox: 
                case this.label: this.exeCheck(ev); break;
            };
        },

        handleError: function(target) {
            if (target.href) {
				var authHref = 'http://delicious.com'+ target.href.substr(target.href.indexOf('/settings/bookmarks/sharing'));
                var sendAuthWindow = window.open(authHref, "sendUuthWindow", "width=800, height=400");
            };
        },

        exeDelete: function(ev) {
            //debug('Delciious.SendSettings.exeDelete()');
            Evt.stopEvent(ev);

            // post delete form
            Delicious.Common.linkToPostConverter(this.deleteLink.href);

            // remove activation stuff
            this.contentArea.innerHTML = '';
            var msg = DIV({'class':'msg'}, ['A request has been made to remove your credentials from '+this.service+'.']);
            this.contentArea.appendChild(msg);
        },

        exeCheck: function(ev) {
            //debug('Delicious.SendSettings.exeCheck()');
            // if change in state, show buttons
            if (this.checkbox.checked != this.initialCheckboxState) {
                this.buttons.style.display = 'block';
                this.message.innerHTML = '';
            };
        },

        exeCancel: function(ev) {
            //debug('Delicious.SendSettings.exeCancel()');
            Evt.stopEvent(ev);
            this.buttons.style.display = 'none';
            this.checkbox.checked = this.initialCheckboxState;
        },

        exeSave: function(ev) {
            //debug('Delicious.SendSettings.exeSave()');
            Evt.stopEvent(ev);

            // add cylon-slider
            Dom.addClass(this.saveBtn.parentNode, 'loading');

            // submit form
            Conn.setForm(this.form);
            Conn.asyncRequest('POST',  '/ajax/social/subscribechannel', {
                success:  this.callbackSaveSuccess,
                failure:  this.callbackSaveFailure,
                scope:    this
            });
        },

        callbackSaveSuccess: function(o) {
            //debug('Delicious.SendSettings.callbackSaveSuccess()');

            // show save message
            this.message.innerHTML = '<div class="success">Saved!<\/div>';

            // remove cylon-slider & hide buttons
            Dom.removeClass(this.saveBtn.parentNode, 'loading');
            this.buttons.style.display = 'none';

            // reset state
            this.initialCheckboxState =  this.checkbox.checked;
        },

        callbackSaveFailure: function(o) {
            //debug('Delicious.SendSettings.callbackSaveFailure()');
            
            // remove cylon-slider
            Dom.removeClass(this.saveBtn.parentNode, 'loading');
            this.buttons.style.display = 'none';

            // error msg
            this.message.innerHTML = '<div class="error">Error. Please try again later.<\/div>';

            // reset state
            this.initialCheckboxState =  this.checkbox.checked;
        },


        /*
         * AUTH BUTTON
         */
        initAuth: function() {
            //debug('Delicious.SendSettings.initAuth()');

            // get vars
            this.authForm = Dom.get(this.prefix +'AuthForm');
            this.authBtn = Dom.get(this.prefix +'AuthBtn');

            // add event listener
            if (this.authForm)
                Evt.on(this.authBtn, 'click', this.handleAuth, this, true);
        },

        handleAuth: function(ev) {
            //debug('Delicious.SendSettings.handleAuth()');
            // cancel button
            Evt.stopEvent(ev);
            // open up window
            var authWindow = window.open('', 'authWindow', 'width=820,height=500');
            // submit form to window
            this.authForm.target = 'authWindow';
            this.authForm.submit();
        },


        EOF: null
    };

};





Delicious.textareaCounter = function() {

    var _textareaMaxChars = 1000;

    return {

        maxChars: _textareaMaxChars,
        formFieldObj: false,
        counterObj: false,
        timer: false,

        /**
         * Initialize elements on the page
         */
        init: function(formFieldID, counterID, maxChars) {
            // set max characters
            if (maxChars) {
                this.maxChars = maxChars;
            };

            // set objects
            this.formFieldObj = Dom.get(formFieldID);
            this.counterObj = Dom.get(counterID);
            if (!this.formFieldObj || !this.counterObj) return;

            // wire up object
            this.wireUpFormField();
        },

        wireUpFormField: function() {
            // do initial calc
            var charactersLeft = this.countCharactersRemaining();
            this.changeLabel(charactersLeft);

            // add event listeners
            Evt.on(this.formFieldObj, "keyup", this.handleKeyUp, this, true);
            Evt.on(this.formFieldObj, "keydown", this.handleKeyDown, this, true);
 
            // run calculation, form might be pre-populated
            this.calculate();
        },

        handleKeyDown: function(ev) {
            window.clearTimeout(this.timer);
            this.timer = false;
        },

        handleKeyUp: function(ev) {
            DeliciousTextAreaCounter = this;
            if (!this.timer)
                this.timer = window.setTimeout('DeliciousTextAreaCounter.checkTimer()', 200);
        },

        checkTimer:  function(ev) {
            this.handleKeyDown();
            this.calculate();
        },

        calculate: function(ev) {
            // change label
            var charactersLeft = this.countCharactersRemaining();
            this.changeLabel(charactersLeft);

            // provide error message
            if (charactersLeft<0 && !Dom.hasClass(this.counterObj, 'error'))
                Dom.addClass(this.counterObj, 'error');
            if (charactersLeft>=0 && Dom.hasClass(this.counterObj, 'error'))
                Dom.removeClass(this.counterObj, 'error');

        },

        changeLabel: function(charactersLeft) {
            // NOTE: Can't do simple innerHTML here, IE is choking
            var labelTxt = (charactersLeft==1) ? del_text.msgs.TXT_CHAR_LEFT : del_text.msgs.TXT_CHARS_LEFT;
            var label = document.createTextNode(' '+labelTxt);
            var counter = EM({}, [charactersLeft]);
            this.counterObj.innerHTML = '';
            this.counterObj.appendChild(counter);
            this.counterObj.appendChild(label);
        },

        countCharactersRemaining: function (ev) {
            var charCount = false;
            var inputVal = this.formFieldObj.value.trim();
            charCount = inputVal.length;
            var charactersLeft = (this.maxChars-charCount);
            return charactersLeft;
        },

        getCount: function(countMe) {
            var escapedStr = encodeURI(countMe);
            if (escapedStr.indexOf("%") != -1) {
                var count = escapedStr.split("%").length - 1;
                if (count == 0) count++  //perverse case; can't happen with real UTF-8
                var tmp = escapedStr.length - (count * 3);
                count = count + tmp;
            } else {
                count = escapedStr.length;
            };
            return count;
        },

        countBytesRemaining: function(valueToCount) {
            var escapedStr, count, tmp;
            escapedStr = encodeURI(valueToCount);
            if (escapedStr.indexOf("%") != -1) {
                count = escapedStr.split("%").length - 1
                if (count == 0) count++  //perverse case; can't happen with real UTF-8
                tmp = escapedStr.length - (count * 3)
                count = count + tmp
            } else {
                count = escapedStr.length
            };
            return(count)
         },

        EOF:null
    };

};



Delicious.TagCounter = function() {
    var Dom  = YAHOO.util.Dom;

    return {

        tagObjs: {},

        showError: function(thisInputObj) {
            //debug('Delicious.TagCounter.showError()');
            var thisCounterObj = Dom.getElementsByClassName('tagCounter', '', thisInputObj.parentNode)[0];
            if (thisCounterObj) {
                var thisIndex = thisCounterObj.id;
                // make sure it's not already on
                if (!this.tagObjs[thisIndex]) {
                    // change object
                    Dom.addClass(thisCounterObj, 'error');
                    this.tagObjs[thisIndex] = true;
                };
            };
        },

        hideError: function(thisInputObj) {
            //debug('Delicious.TagCounter.hideError()');
            var thisCounterObj = Dom.getElementsByClassName('tagCounter', '', thisInputObj.parentNode)[0];
            if (thisCounterObj) {
                var thisIndex = thisCounterObj.id;
                if (this.tagObjs[thisIndex]) {
                    Dom.removeClass(thisCounterObj, 'error');
                    delete this.tagObjs[thisIndex];
                };
            };
        },

        EOF: null
    };
}();






Delicious.MessageEditor = function() {
    return {
        inlineID: false,

        init: function(messageInput, thisObj, caller, inlineID) {
            //debug('Delicious.MessageEditor.init("'+ messageInput +'", "'+ thisObj +'", "'+ caller +'", "'+ inlineID  +'")');

            // messageInput can be either object or string
            this.messageInput = (typeof messageInput == "string") ? Dom.get(messageInput) : messageInput;

            // get caller, and name of own object
            this.thisObj = thisObj;
            this.caller = caller;
            this.inlineID = inlineID;
        },

        toggleMessage: function(trueOrFalse) {
            //debug('Delicious.MessageEditor.toggleMessage('+trueOrFalse+')');
            this.messageInput.parentNode.style.display = (trueOrFalse) ? 'block' : 'none';
        },

        EOF: null

    };
};




/**
 * UI code for save/edit 'mark private' checkbox
 * @class Delicious.MarkPrivate
 */
Delicious.MarkPrivate = function() {

    var _active = true;

    return {

        thisObj: false,
        caller: false,
        inlineID: false,

        /**
         * @method init()
         * @description: initializes the privateCheckbox, adds eventListener
         */
        init: function(privateCheckbox, thisObj, caller, inlineID) {
            //debug('Delicious.MarkPrivate.init()');
            // make sure we've got an object to work with
            if (typeof privateCheckbox == "string")
                this.privateCheckbox = Dom.get(privateCheckbox);
            if (!this.privateCheckbox) return;

            this.caller = caller;
            this.thisObj = thisObj;
            this.inlineID = inlineID;

            // add event listener to checkbox
            Evt.on(this.privateCheckbox, 'click', this.handleClick, this, true);
        },


        /**
         * @method handleClick()
         * @description: fires when user clicks on 'mark private' checkbox.
         * It checks whether or not there are any "@" tags in the SEND field, and strips those
         */
        handleClick: function() {
            //debug('Delicious.MarkPrivate.handleClick()');
            //debug(this.privateCheckbox);
            //debug(this.caller.isRegistered('send', this.inlineID));
            if (this.privateCheckbox.checked && this.caller.isRegistered('send', this.inlineID)) {
                var sendObject = this.caller.getRegisteredObject('send', this.inlineID);
                sendObject.removeAllProviders();
            };
        },

        deActivate: function() {
            _active = false;
        },

        reActivate: function() {
            _active = true;
        },

        EOF: null
    };
};
</script>

</body>
</html>

